<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AutoScheduling3.Views.Settings.SettingsPage"
    x:Name="Root"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:AutoScheduling3.Models"
    xmlns:converters="using:AutoScheduling3.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Themes/ThemeResources.xaml"/>
                <ResourceDictionary Source="/Themes/AnimationResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:BoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" Inverted="True"/>
            <converters:BoolToBrushConverter x:Key="BoolToBrushConverter"/>
        </ResourceDictionary>
    </Page.Resources>

    <ScrollViewer>
        <StackPanel Margin="24" Spacing="24" MaxWidth="800">
            
            <!-- 页面标题 -->
            <TextBlock Text="设置" 
                       Style="{StaticResource TitleTextStyle}"
                       AutomationProperties.HeadingLevel="Level1"/>

            <!-- 外观设置 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="外观" 
                               Style="{StaticResource SubtitleTextStyle}"
                               AutomationProperties.HeadingLevel="Level2"/>
                    
                    <!-- 主题选择 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="主题" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ComboBox x:Name="ThemeComboBox"
                                  MinWidth="200"
                                  SelectionChanged="ThemeComboBox_SelectionChanged"
                                  AutomationProperties.Name="选择应用主题">
                            <ComboBoxItem Content="跟随系统" Tag="Default"/>
                            <ComboBoxItem Content="浅色" Tag="Light"/>
                            <ComboBoxItem Content="深色" Tag="Dark"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- 高对比度模式 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="高对比度模式" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ToggleSwitch x:Name="HighContrastToggle"
                                      OnContent="开启"
                                      OffContent="关闭"
                                      Toggled="HighContrastToggle_Toggled"
                                      AutomationProperties.Name="切换高对比度模式"/>
                        <TextBlock Text="提高界面元素的对比度，便于视觉障碍用户使用"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 动画设置 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="动画与交互" 
                               Style="{StaticResource SubtitleTextStyle}"
                               AutomationProperties.HeadingLevel="Level2"/>
                    
                    <!-- 启用动画 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="启用动画效果" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ToggleSwitch x:Name="AnimationToggle"
                                      OnContent="开启"
                                      OffContent="关闭"
                                      Toggled="AnimationToggle_Toggled"
                                      AutomationProperties.Name="切换动画效果"/>
                        <TextBlock Text="关闭动画可以提高性能并减少干扰"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"/>
                    </StackPanel>

                    <!-- 动画速度 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="动画速度" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <Slider x:Name="AnimationSpeedSlider"
                                Minimum="0.5"
                                Maximum="2.0"
                                Value="1.0"
                                StepFrequency="0.1"
                                TickFrequency="0.5"
                                TickPlacement="BottomRight"
                                ValueChanged="AnimationSpeedSlider_ValueChanged"
                                AutomationProperties.Name="调整动画速度"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="慢" HorizontalAlignment="Left"
                                       Style="{StaticResource AccessibleTextStyle}"
                                       Foreground="{ThemeResource TextSecondaryBrush}"
                                       FontSize="12"/>
                            <TextBlock Grid.Column="1" x:Name="SpeedValueText" Text="1.0x"
                                       Style="{StaticResource AccessibleTextStyle}"
                                       FontWeight="Medium"/>
                            <TextBlock Grid.Column="2" Text="快" HorizontalAlignment="Right"
                                       Style="{StaticResource AccessibleTextStyle}"
                                       Foreground="{ThemeResource TextSecondaryBrush}"
                                       FontSize="12"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 无障碍设置 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="无障碍" 
                               Style="{StaticResource SubtitleTextStyle}"
                               AutomationProperties.HeadingLevel="Level2"/>
                    
                    <!-- 字体大小 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="字体大小" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ComboBox x:Name="FontSizeComboBox"
                                  MinWidth="200"
                                  SelectionChanged="FontSizeComboBox_SelectionChanged"
                                  AutomationProperties.Name="选择字体大小">
                            <ComboBoxItem Content="小 (12px)" Tag="12"/>
                            <ComboBoxItem Content="标准 (14px)" Tag="14" IsSelected="True"/>
                            <ComboBoxItem Content="大 (16px)" Tag="16"/>
                            <ComboBoxItem Content="特大 (18px)" Tag="18"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- 键盘导航提示 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="显示键盘导航提示" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ToggleSwitch x:Name="KeyboardHintsToggle"
                                      OnContent="显示"
                                      OffContent="隐藏"
                                      Toggled="KeyboardHintsToggle_Toggled"
                                      AutomationProperties.Name="切换键盘导航提示"/>
                        <TextBlock Text="显示键盘快捷键和导航提示"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"/>
                    </StackPanel>

                    <!-- 屏幕阅读器优化 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="屏幕阅读器优化" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ToggleSwitch x:Name="ScreenReaderToggle"
                                      OnContent="开启"
                                      OffContent="关闭"
                                      Toggled="ScreenReaderToggle_Toggled"
                                      AutomationProperties.Name="切换屏幕阅读器优化"/>
                        <TextBlock Text="为屏幕阅读器提供更详细的描述信息"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 性能设置 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="性能" 
                               Style="{StaticResource SubtitleTextStyle}"
                               AutomationProperties.HeadingLevel="Level2"/>
                    
                    <!-- 减少视觉效果 -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="减少视觉效果" 
                                   Style="{StaticResource AccessibleTextStyle}"
                                   FontWeight="Medium"/>
                        <ToggleSwitch x:Name="ReduceEffectsToggle"
                                      OnContent="开启"
                                      OffContent="关闭"
                                      Toggled="ReduceEffectsToggle_Toggled"
                                      AutomationProperties.Name="切换减少视觉效果"/>
                        <TextBlock Text="关闭阴影、透明度等效果以提高性能"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 重置设置 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <TextBlock Text="重置" 
                               Style="{StaticResource SubtitleTextStyle}"
                               AutomationProperties.HeadingLevel="Level2"/>
                    
                    <Button x:Name="ResetButton"
                            Content="重置所有设置"
                            Style="{StaticResource EnhancedButtonStyle}"
                            Background="{ThemeResource ErrorBrush}"
                            Click="ResetButton_Click"
                            AutomationProperties.Name="重置所有设置到默认值"/>
                    
                    <TextBlock Text="这将重置所有个性化设置到默认值"
                               Style="{StaticResource AccessibleTextStyle}"
                               Foreground="{ThemeResource TextSecondaryBrush}"
                               FontSize="12"/>
                </StackPanel>
            </ContentControl>

            <!-- 数据导入导出 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="数据导入导出" 
                                   Style="{StaticResource SubtitleTextStyle}"
                                   AutomationProperties.HeadingLevel="Level2"/>
                        <TextBlock Text="备份和恢复所有核心数据，包括人员、哨位、技能、排班模板和约束规则"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- 导出导入按钮 -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Style="{StaticResource EnhancedButtonStyle}"
                                Command="{x:Bind ViewModel.ExportDataCommand}"
                                AutomationProperties.Name="导出所有数据到文件">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE896;" FontSize="16"/>
                                    <TextBlock Text="导出数据"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>

                        <Button Style="{StaticResource EnhancedButtonStyle}"
                                Command="{x:Bind ViewModel.ImportDataCommand}"
                                AutomationProperties.Name="从文件导入数据">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8B5;" FontSize="16"/>
                                    <TextBlock Text="导入数据"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                    </StackPanel>

                    <!-- 操作进行中提示 -->
                    <StackPanel Orientation="Horizontal" 
                                Spacing="12"
                                Visibility="{x:Bind ViewModel.IsImportExportInProgress, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ProgressRing IsActive="True" Width="20" Height="20"/>
                        <TextBlock Text="正在处理，请稍候..."
                                   Style="{StaticResource AccessibleTextStyle}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 数据管理 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="数据管理" 
                                   Style="{StaticResource SubtitleTextStyle}"
                                   AutomationProperties.HeadingLevel="Level2"/>
                        <TextBlock Text="管理应用程序的所有数据，包括清空数据库等操作"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- 清空数据库按钮 -->
                    <StackPanel Spacing="8">
                        <Button Style="{StaticResource EnhancedButtonStyle}"
                                Command="{x:Bind ViewModel.ClearAllDatabaseCommand}"
                                Background="{ThemeResource ErrorBrush}"
                                AutomationProperties.Name="清空所有数据库内容">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                                    <TextBlock Text="清空所有数据"/>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                        
                        <TextBlock Text="⚠️ 此操作将删除所有人员、哨位、技能、排班记录等数据。系统会在清空前自动创建备份。"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource ErrorBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </StackPanel>
            </ContentControl>

            <!-- 存储文件路径 -->
            <ContentControl Style="{StaticResource EnhancedCardStyle}">
                <StackPanel Spacing="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="存储文件路径" 
                                   Style="{StaticResource SubtitleTextStyle}"
                                   AutomationProperties.HeadingLevel="Level2"/>
                        <TextBlock Text="查看应用程序数据文件的存储位置，便于数据管理和备份"
                                   Style="{StaticResource AccessibleTextStyle}"
                                   Foreground="{ThemeResource TextSecondaryBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- 加载指示器 -->
                    <ProgressRing IsActive="{x:Bind ViewModel.IsLoadingStorageInfo, Mode=OneWay}"
                                  Width="40"
                                  Height="40"
                                  Visibility="{x:Bind ViewModel.IsLoadingStorageInfo, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  AutomationProperties.Name="正在加载存储文件信息"/>

                    <!-- 文件列表 -->
                    <ItemsControl ItemsSource="{x:Bind ViewModel.StorageFiles, Mode=OneWay}"
                                  Visibility="{x:Bind ViewModel.IsLoadingStorageInfo, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="local:StorageFileInfo">
                                <Border Background="{ThemeResource CardBackgroundBrush}"
                                        BorderBrush="{ThemeResource CardBorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,0,0,12">
                                    <Grid RowSpacing="12">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- 文件名称和状态 -->
                                        <Grid Grid.Row="0" ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           FontWeight="SemiBold"
                                                           FontSize="14"/>
                                                <TextBlock Text="{x:Bind Description, Mode=OneWay}"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           Foreground="{ThemeResource TextSecondaryBrush}"
                                                           FontSize="12"
                                                           TextWrapping="Wrap"/>
                                            </StackPanel>

                                            <Border Grid.Column="1"
                                                    Background="{x:Bind Exists, Mode=OneWay, Converter={StaticResource BoolToBrushConverter}}"
                                                    CornerRadius="4"
                                                    Padding="8,4"
                                                    VerticalAlignment="Top">
                                                <TextBlock Text="{x:Bind StatusText, Mode=OneWay}"
                                                           Foreground="White"
                                                           FontSize="12"
                                                           FontWeight="Medium"/>
                                            </Border>
                                        </Grid>

                                        <!-- 文件路径 -->
                                        <StackPanel Grid.Row="1" Spacing="4">
                                            <TextBlock Text="路径"
                                                       Style="{StaticResource AccessibleTextStyle}"
                                                       Foreground="{ThemeResource TextSecondaryBrush}"
                                                       FontSize="11"
                                                       FontWeight="Medium"/>
                                            <TextBlock Text="{x:Bind FullPath, Mode=OneWay}"
                                                       Style="{StaticResource AccessibleTextStyle}"
                                                       FontSize="12"
                                                       TextWrapping="Wrap"
                                                       IsTextSelectionEnabled="True"
                                                       AutomationProperties.Name="{x:Bind FullPath, Mode=OneWay}"/>
                                        </StackPanel>

                                        <!-- 文件信息 -->
                                        <Grid Grid.Row="2" ColumnSpacing="24">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="大小"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           Foreground="{ThemeResource TextSecondaryBrush}"
                                                           FontSize="11"
                                                           FontWeight="Medium"/>
                                                <TextBlock Text="{x:Bind FormattedFileSize, Mode=OneWay}"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           FontSize="12"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1" Spacing="4">
                                                <TextBlock Text="最后修改"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           Foreground="{ThemeResource TextSecondaryBrush}"
                                                           FontSize="11"
                                                           FontWeight="Medium"/>
                                                <TextBlock Text="{x:Bind FormattedLastModified, Mode=OneWay}"
                                                           Style="{StaticResource AccessibleTextStyle}"
                                                           FontSize="12"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- 操作按钮 -->
                                        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8">
                                            <Button Style="{StaticResource EnhancedButtonStyle}"
                                                    Command="{Binding ElementName=Root, Path=ViewModel.CopyPathCommand}"
                                                    CommandParameter="{x:Bind FullPath, Mode=OneWay}"
                                                    AutomationProperties.Name="复制文件路径到剪贴板">
                                                <Button.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE8C8;" FontSize="14"/>
                                                        <TextBlock Text="复制路径"/>
                                                    </StackPanel>
                                                </Button.Content>
                                            </Button>

                                            <Button Style="{StaticResource EnhancedButtonStyle}"
                                                    Command="{Binding ElementName=Root, Path=ViewModel.OpenDirectoryCommand}"
                                                    CommandParameter="{x:Bind FullPath, Mode=OneWay}"
                                                    IsEnabled="{x:Bind Exists, Mode=OneWay}"
                                                    AutomationProperties.Name="在文件资源管理器中打开文件所在目录">
                                                <Button.Content>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="&#xE8DA;" FontSize="14"/>
                                                        <TextBlock Text="打开目录"/>
                                                    </StackPanel>
                                                </Button.Content>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- 刷新按钮 -->
                    <Button Style="{StaticResource EnhancedButtonStyle}"
                            Command="{x:Bind ViewModel.RefreshStorageInfoCommand}"
                            HorizontalAlignment="Left"
                            AutomationProperties.Name="刷新存储文件信息">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                                <TextBlock Text="刷新信息"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </ContentControl>

        </StackPanel>
    </ScrollViewer>
</Page>