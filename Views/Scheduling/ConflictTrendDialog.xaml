<ContentDialog
    x:Class="AutoScheduling3.Views.Scheduling.ConflictTrendDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="冲突趋势分析"
    CloseButtonText="关闭"
    DefaultButton="Close"
    MinWidth="800"
    MinHeight="600">

    <ContentDialog.Resources>
        <!-- 统计卡片样式 -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
        </Style>

        <!-- 图表容器样式 -->
        <Style x:Key="ChartContainerStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="MinHeight" Value="250"/>
        </Style>
    </ContentDialog.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="20" Padding="4">
            <!-- 时间范围选择器 -->
            <Border Style="{StaticResource StatCardStyle}">
                <StackPanel Spacing="12">
                    <TextBlock 
                        Text="时间范围" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        FontWeight="SemiBold"/>
                    
                    <Grid ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="200"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock 
                            Grid.Column="0" 
                            Text="开始日期:" 
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <DatePicker 
                            Grid.Column="1" 
                            x:Name="StartDatePicker"
                            HorizontalAlignment="Stretch"/>

                        <TextBlock 
                            Grid.Column="2" 
                            Text="结束日期:" 
                            VerticalAlignment="Center"
                            Margin="12,0,0,0"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <DatePicker 
                            Grid.Column="3" 
                            x:Name="EndDatePicker"
                            HorizontalAlignment="Stretch"/>

                        <Button 
                            Grid.Column="4" 
                            Content="应用"
                            Margin="12,0,0,0"
                            Click="OnApplyDateRangeClick"
                            Style="{StaticResource AccentButtonStyle}"/>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- 解决率统计 -->
            <Border Style="{StaticResource StatCardStyle}">
                <StackPanel Spacing="12">
                    <TextBlock 
                        Text="解决率统计" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        FontWeight="SemiBold"/>
                    
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 总冲突数 -->
                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock 
                                Text="总冲突数" 
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock 
                                x:Name="TotalConflictsText"
                                Text="0"
                                FontSize="24"
                                FontWeight="Bold"/>
                        </StackPanel>

                        <!-- 已解决 -->
                        <StackPanel Grid.Column="1" Spacing="4">
                            <TextBlock 
                                Text="已解决" 
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock 
                                    x:Name="ResolvedConflictsText"
                                    Text="0"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    Foreground="#10893E"/>
                                <TextBlock 
                                    x:Name="ResolvedPercentageText"
                                    Text="(0%)"
                                    FontSize="14"
                                    Foreground="#10893E"
                                    VerticalAlignment="Bottom"
                                    Margin="0,0,0,4"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- 已忽略 -->
                        <StackPanel Grid.Column="2" Spacing="4">
                            <TextBlock 
                                Text="已忽略" 
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock 
                                    x:Name="IgnoredConflictsText"
                                    Text="0"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    Foreground="#F7630C"/>
                                <TextBlock 
                                    x:Name="IgnoredPercentageText"
                                    Text="(0%)"
                                    FontSize="14"
                                    Foreground="#F7630C"
                                    VerticalAlignment="Bottom"
                                    Margin="0,0,0,4"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- 待处理 -->
                        <StackPanel Grid.Column="3" Spacing="4">
                            <TextBlock 
                                Text="待处理" 
                                FontSize="12"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock 
                                    x:Name="PendingConflictsText"
                                    Text="0"
                                    FontSize="24"
                                    FontWeight="Bold"
                                    Foreground="#C50F1F"/>
                                <TextBlock 
                                    x:Name="PendingPercentageText"
                                    Text="(0%)"
                                    FontSize="14"
                                    Foreground="#C50F1F"
                                    VerticalAlignment="Bottom"
                                    Margin="0,0,0,4"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- 冲突数量趋势图 -->
            <Border Style="{StaticResource ChartContainerStyle}">
                <StackPanel Spacing="16">
                    <TextBlock 
                        Text="冲突数量趋势" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        FontWeight="SemiBold"/>
                    
                    <!-- 趋势图占位符 -->
                    <Grid x:Name="TrendChartContainer" MinHeight="200">
                        <TextBlock 
                            x:Name="TrendChartPlaceholder"
                            Text="暂无趋势数据"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            FontSize="14"/>
                        
                        <!-- 简单的文本趋势显示 -->
                        <ScrollViewer 
                            x:Name="TrendChartScrollViewer"
                            Visibility="Collapsed"
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="TrendChartItemsControl">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="8"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Spacing="4" Width="80">
                                            <TextBlock 
                                                Text="{Binding Count}"
                                                FontSize="16"
                                                FontWeight="SemiBold"
                                                HorizontalAlignment="Center"/>
                                            <Rectangle 
                                                Fill="{ThemeResource SystemAccentColor}"
                                                Height="{Binding BarHeight}"
                                                VerticalAlignment="Bottom"/>
                                            <TextBlock 
                                                Text="{Binding DateLabel}"
                                                FontSize="10"
                                                HorizontalAlignment="Center"
                                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- 冲突类型分布 -->
            <Border Style="{StaticResource ChartContainerStyle}">
                <StackPanel Spacing="16">
                    <TextBlock 
                        Text="冲突类型分布" 
                        Style="{StaticResource SubtitleTextBlockStyle}"
                        FontWeight="SemiBold"/>
                    
                    <!-- 类型分布列表 -->
                    <ItemsControl x:Name="TypeDistributionItemsControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Spacing="8" Margin="0,0,0,12">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock 
                                            Grid.Column="0"
                                            Text="{Binding TypeName}"
                                            FontSize="14"/>
                                        <TextBlock 
                                            Grid.Column="1"
                                            FontSize="14"
                                            FontWeight="SemiBold">
                                            <Run Text="{Binding Count}"/>
                                            <Run Text=" (" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <Run Text="{Binding Percentage}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <Run Text="%)" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </TextBlock>
                                    </Grid>
                                    
                                    <ProgressBar 
                                        Value="{Binding Percentage}"
                                        Maximum="100"
                                        Height="8"
                                        Foreground="{Binding BarColor}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- 无数据提示 -->
                    <TextBlock 
                        x:Name="TypeDistributionPlaceholder"
                        Text="暂无类型分布数据"
                        HorizontalAlignment="Center"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        FontSize="14"
                        Visibility="Collapsed"/>
                </StackPanel>
            </Border>

            <!-- 导出按钮 -->
            <Button 
                Content="导出报告"
                Click="OnExportReportClick"
                HorizontalAlignment="Left"
                Style="{StaticResource AccentButtonStyle}">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE8E5;" FontSize="16"/>
                        <TextBlock Text="导出报告"/>
                    </StackPanel>
                </Button.Content>
            </Button>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
