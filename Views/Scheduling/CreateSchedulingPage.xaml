<Page
    x:Class="AutoScheduling3.Views.Scheduling.CreateSchedulingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:AutoScheduling3.ViewModels.Scheduling"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:dto="using:AutoScheduling3.DTOs"
    xmlns:models="using:AutoScheduling3.Models.Constraints"
    mc:Ignorable="d"
    x:Name="Root"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <Page.Resources>
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InvertedBooleanConverter x:Key="InvertedBooleanConverter"/>
        <converters:DateTimeFormatConverter x:Key="DateTimeFormatConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:EnumEqualsToVisibilityConverter x:Key="EnumEqualsToVisibilityConverter"/>

        <DataTemplate x:Key="PersonnelListViewTemplate" x:DataType="dto:PersonnelDto">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <SymbolIcon Symbol="Contact"/>
                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                <!-- Display skill count -->
                <TextBlock Text="{x:Bind SkillIds.Count, Mode=OneWay}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="PositionListViewTemplate" x:DataType="dto:PositionDto">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <SymbolIcon Symbol="MapPin"/>
                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                <!-- LocationName not present; use Location -->
                <TextBlock Text="{x:Bind Location}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="24,24,24,12">
            <TextBlock Text="åˆ›å»ºæŽ’ç­" Style="{ThemeResource TitleTextBlockStyle}"/>
            <TextBlock Text="é€šè¿‡åˆ†æ­¥å‘å¯¼å®ŒæˆæŽ’ç­å‚æ•°é…ç½®å¹¶æ‰§è¡ŒæŽ’ç­" Style="{ThemeResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            <InfoBar Title="ä»Žæ¨¡æ¿åŠ è½½" Message="å·²åŠ è½½æ¨¡æ¿ï¼Œè¯·ç¡®è®¤æ—¥æœŸå’Œåç§°åŽç›´æŽ¥è¿›å…¥ç¬¬5æ­¥æ‰§è¡ŒæŽ’ç­" Severity="Success"
                     IsOpen="{x:Bind ViewModel.TemplateApplied, Mode=OneWay}" Margin="0,12,0,0"/>
        </StackPanel>

        <!-- Wizard Steps Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="24,0,24,0">
            <StackPanel Spacing="16">
                <!-- Step 1: Basic Info -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=1, Mode=OneWay}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="æ­¥éª¤ 1: é€‰æ‹©æ—¶é—´èŒƒå›´å’Œåç§°" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        <TextBox Header="æŽ’ç­è¡¨åç§°" Text="{x:Bind ViewModel.ScheduleTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="ä¾‹å¦‚ï¼š2024å¹´5æœˆå¸¸è§„æŽ’ç­"/>
                        <CalendarDatePicker Header="å¼€å§‹æ—¥æœŸ" Date="{x:Bind ViewModel.StartDate, Mode=TwoWay}"/>
                        <CalendarDatePicker Header="ç»“æŸæ—¥æœŸ" Date="{x:Bind ViewModel.EndDate, Mode=TwoWay}"/>
                    </StackPanel>
                </Grid>

                <!-- Step 2: Select Positions -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=2, Mode=OneWay}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="æ­¥éª¤ 2: é€‰æ‹©å‚ä¸Žå“¨ä½" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <!-- Available -->
                            <ListView Grid.Column="0" Header="å¯ç”¨å“¨ä½" ItemsSource="{x:Bind ViewModel.AvailablePositions, Mode=OneWay}"
                                      SelectionMode="Multiple" ItemTemplate="{StaticResource PositionListViewTemplate}" MinHeight="300"
                                      x:Name="AvailablePositionsList" x:FieldModifier="public"/>
                            <!-- Buttons -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="8">
                                <Button Content="&gt;&gt;" ToolTipService.ToolTip="æ·»åŠ é€‰ä¸­"
                                        Click="AddPosition_Click"/>
                                <Button Content="&lt;&lt;" ToolTipService.ToolTip="ç§»é™¤é€‰ä¸­"
                                        Click="RemovePosition_Click"/>
                            </StackPanel>
                            <!-- Selected -->
                            <ListView Grid.Column="2" Header="å·²é€‰å“¨ä½" ItemsSource="{x:Bind ViewModel.SelectedPositions, Mode=OneWay}"
                                      SelectionMode="Multiple" ItemTemplate="{StaticResource PositionListViewTemplate}" MinHeight="300"
                                      x:Name="SelectedPositionsList" x:FieldModifier="public"/>
                        </Grid>
                    </StackPanel>
                </Grid>

                <!-- Step 3: Select Personnel (New Design) -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=3, Mode=OneWay}">
                    <StackPanel Spacing="16">
                        <TextBlock Text="æ­¥éª¤ 3: é€‰æ‹©å‚ä¸Žäººå‘˜" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        
                        <!-- Info Bar -->
                        <InfoBar Severity="Informational" IsOpen="True" 
                                 Title="æç¤º" 
                                 Message="å·²è‡ªåŠ¨ä»Žå·²é€‰å“¨ä½ä¸­æå–å¯ç”¨äººå‘˜ã€‚ä½ å¯ä»¥è¿›è¡Œä¸´æ—¶è°ƒæ•´æˆ–æ‰‹åŠ¨æ·»åŠ ã€‚"/>
                        
                        <!-- Personnel Statistics -->
                        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                BorderThickness="1" 
                                Padding="16" 
                                CornerRadius="{StaticResource ControlCornerRadius}"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <StackPanel Spacing="8">
                                <TextBlock Text="ðŸ“Š å‚ä¸Žäººå‘˜ç»Ÿè®¡" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                                <Grid ColumnSpacing="24">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Spacing="4">
                                        <TextBlock Text="è‡ªåŠ¨æå–" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                        <TextBlock FontSize="24" FontWeight="SemiBold">
                                            <Run Text="{x:Bind ViewModel.AutoExtractedPersonnelCount, Mode=OneWay}"/>
                                            <Run Text="äºº" FontSize="14"/>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Spacing="4">
                                        <TextBlock Text="æ‰‹åŠ¨æ·»åŠ " Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                        <TextBlock FontSize="24" FontWeight="SemiBold">
                                            <Run Text="{x:Bind ViewModel.ManuallyAddedPersonnelCount, Mode=OneWay}"/>
                                            <Run Text="äºº" FontSize="14"/>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Spacing="4">
                                        <TextBlock Text="æ€»è®¡" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12"/>
                                        <TextBlock FontSize="24" FontWeight="SemiBold" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}">
                                            <Run Text="{x:Bind ViewModel.SelectedPersonnels.Count, Mode=OneWay}"/>
                                            <Run Text="äºº" FontSize="14"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Position Personnel List -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="ðŸ” æŒ‰å“¨ä½æŸ¥çœ‹å¯ç”¨äººå‘˜" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                            
                            <!-- Empty State -->
                            <TextBlock Text="è¯·å…ˆåœ¨æ­¥éª¤2ä¸­é€‰æ‹©å“¨ä½" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Visibility="{x:Bind ViewModel.PositionPersonnelViewModels.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0, Mode=OneWay}"/>
                            
                            <!-- Position List -->
                            <ItemsRepeater ItemsSource="{x:Bind ViewModel.PositionPersonnelViewModels, Mode=OneWay}">
                                <ItemsRepeater.Layout>
                                    <StackLayout Spacing="8"/>
                                </ItemsRepeater.Layout>
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="viewmodels:PositionPersonnelViewModel">
                                        <Expander HorizontalAlignment="Stretch" 
                                                  HorizontalContentAlignment="Stretch"
                                                  IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}"
                                                  Margin="0,0,0,8">
                                            <Expander.Header>
                                                <Grid ColumnSpacing="12">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <SymbolIcon Grid.Column="0" Symbol="MapPin"/>
                                                    <StackPanel Grid.Column="1" Spacing="4">
                                                        <TextBlock Text="{x:Bind PositionName}" FontWeight="SemiBold"/>
                                                        <TextBlock Text="{x:Bind Location}" 
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                                                   FontSize="12"/>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="2" Spacing="4" HorizontalAlignment="Right">
                                                        <TextBlock Text="{x:Bind AvailablePersonnel.Count, Mode=OneWay}" 
                                                                   FontWeight="SemiBold" 
                                                                   HorizontalAlignment="Right"/>
                                                        <TextBlock Text="å¯ç”¨äººå‘˜" 
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                                                   FontSize="12"
                                                                   HorizontalAlignment="Right"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Expander.Header>
                                            <Expander.Content>
                                                <StackPanel Spacing="12" Padding="0,8,0,0">
                                                    <!-- Personnel List -->
                                                    <ItemsRepeater ItemsSource="{x:Bind AvailablePersonnel, Mode=OneWay}">
                                                        <ItemsRepeater.Layout>
                                                            <StackLayout Spacing="0"/>
                                                        </ItemsRepeater.Layout>
                                                        <ItemsRepeater.ItemTemplate>
                                                            <DataTemplate x:DataType="viewmodels:PersonnelItemViewModel">
                                                                <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                                        BorderThickness="0,0,0,1"
                                                                        Padding="8,8,8,8">
                                                                    <Grid ColumnSpacing="12">
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="Auto"/>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="Auto"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        
                                                                        <CheckBox Grid.Column="0" 
                                                                                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                                                                  VerticalAlignment="Center"/>
                                                                        
                                                                        <StackPanel Grid.Column="1" Spacing="4">
                                                                            <TextBlock FontWeight="SemiBold">
                                                                                <Run Text="{x:Bind PersonnelName}"/>
                                                                            </TextBlock>
                                                                            <TextBlock Text="{x:Bind SkillsDisplay}" 
                                                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                                                                       FontSize="12"/>
                                                                        </StackPanel>
                                                                        
                                                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                                                            <!-- Source Type Badge -->
                                                                            <Border Padding="6,2" 
                                                                                    CornerRadius="4"
                                                                                    Background="{ThemeResource SystemFillColorSuccessBrush}"
                                                                                    Visibility="{x:Bind SourceType, Converter={StaticResource EnumEqualsToVisibilityConverter}, ConverterParameter=AutoExtracted, Mode=OneWay}">
                                                                                <TextBlock Text="è‡ªåŠ¨æå–" FontSize="10" Foreground="White"/>
                                                                            </Border>
                                                                            <Border Padding="6,2" 
                                                                                    CornerRadius="4"
                                                                                    Background="{ThemeResource SystemFillColorCautionBrush}"
                                                                                    Visibility="{x:Bind SourceType, Converter={StaticResource EnumEqualsToVisibilityConverter}, ConverterParameter=TemporarilyAdded, Mode=OneWay}">
                                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                                    <TextBlock Text="âž•" FontSize="10"/>
                                                                                    <TextBlock Text="ä¸´æ—¶æ·»åŠ " FontSize="10" Foreground="White"/>
                                                                                </StackPanel>
                                                                            </Border>
                                                                            <Border Padding="6,2" 
                                                                                    CornerRadius="4"
                                                                                    Background="{ThemeResource SystemFillColorCriticalBrush}"
                                                                                    Visibility="{x:Bind SourceType, Converter={StaticResource EnumEqualsToVisibilityConverter}, ConverterParameter=TemporarilyRemoved, Mode=OneWay}">
                                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                                    <TextBlock Text="âž–" FontSize="10"/>
                                                                                    <TextBlock Text="ä¸´æ—¶ç§»é™¤" FontSize="10" Foreground="White"/>
                                                                                </StackPanel>
                                                                            </Border>
                                                                            
                                                                            <!-- Shared Badge -->
                                                                            <Border Padding="6,2" 
                                                                                    CornerRadius="4"
                                                                                    Background="{ThemeResource SystemFillColorAttentionBrush}"
                                                                                    Visibility="{x:Bind IsShared, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                                    <TextBlock Text="ðŸ”—" FontSize="10"/>
                                                                                    <TextBlock FontSize="10" Foreground="White">
                                                                                        <Run Text="å…±äº«äºŽ"/>
                                                                                        <Run Text="{x:Bind SharedPositionCount, Mode=OneWay}"/>
                                                                                        <Run Text="ä¸ªå“¨ä½"/>
                                                                                    </TextBlock>
                                                                                </StackPanel>
                                                                            </Border>
                                                                        </StackPanel>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsRepeater.ItemTemplate>
                                                    </ItemsRepeater>
                                                    
                                                    <!-- Action Buttons -->
                                                    <StackPanel Orientation="Horizontal" Spacing="8" Padding="8,8,8,0">
                                                        <Button Command="{Binding ElementName=Root, Path=ViewModel.StartAddPersonnelToPositionCommand}"
                                                                CommandParameter="{x:Bind PositionDto}">
                                                            <Button.Content>
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <SymbolIcon Symbol="Add" FontSize="14"/>
                                                                    <TextBlock Text="ä¸ºæ­¤å“¨ä½æ·»åŠ äººå‘˜"/>
                                                                </StackPanel>
                                                            </Button.Content>
                                                        </Button>
                                                        <Button Style="{ThemeResource AccentButtonStyle}"
                                                                Command="{Binding ElementName=Root, Path=ViewModel.SavePositionChangesCommand}"
                                                                CommandParameter="{x:Bind PositionId}"
                                                                Visibility="{x:Bind HasChanges, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                                                            <Button.Content>
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <SymbolIcon Symbol="Save" FontSize="14"/>
                                                                    <TextBlock Text="ä¿å­˜ä¸ºæ°¸ä¹…"/>
                                                                </StackPanel>
                                                            </Button.Content>
                                                        </Button>
                                                        <Button Command="{Binding ElementName=Root, Path=ViewModel.RevertPositionChangesCommand}"
                                                                CommandParameter="{x:Bind PositionId}"
                                                                Visibility="{x:Bind HasChanges, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                                                            <Button.Content>
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <SymbolIcon Symbol="Undo" FontSize="14"/>
                                                                    <TextBlock Text="æ’¤é”€æ›´æ”¹"/>
                                                                </StackPanel>
                                                            </Button.Content>
                                                        </Button>
                                                    </StackPanel>
                                                    
                                                    <!-- Explanation -->
                                                    <TextBlock Text="è¯´æ˜Ž: æ·»åŠ çš„äººå‘˜åªå¯¹æ­¤å“¨ä½å¯ç”¨" 
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                                               FontSize="12"
                                                               Padding="8,0,8,8"/>
                                                </StackPanel>
                                            </Expander.Content>
                                        </Expander>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </StackPanel>
                        
                        <!-- Manually Added Personnel Section -->
                        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                BorderThickness="1" 
                                Padding="16" 
                                CornerRadius="{StaticResource ControlCornerRadius}"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <StackPanel Spacing="12">
                                <TextBlock Text="ðŸ‘¥ æ‰‹åŠ¨æ·»åŠ çš„äººå‘˜ï¼ˆä¸å±žäºŽä»»ä½•å“¨ä½ï¼‰" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                                
                                <!-- Empty State -->
                                <TextBlock Text="æš‚æ— æ‰‹åŠ¨æ·»åŠ çš„äººå‘˜" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Visibility="{x:Bind ViewModel.ManuallyAddedPersonnelIds.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0, Mode=OneWay}"/>
                                
                                <!-- Manually Added Personnel List -->
                                <StackPanel Spacing="8"
                                            Visibility="{x:Bind ViewModel.ManuallyAddedPersonnelIds.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='>0', Mode=OneWay}">
                                    <TextBlock FontWeight="SemiBold">
                                        <Run Text="å·²æ·»åŠ "/>
                                        <Run Text="{x:Bind ViewModel.ManuallyAddedPersonnelIds.Count, Mode=OneWay}"/>
                                        <Run Text="åäººå‘˜"/>
                                    </TextBlock>
                                    <TextBlock Text="è¿™äº›äººå‘˜å¯ä»¥è¢«åˆ†é…åˆ°ä»»ä½•å“¨ä½" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                               FontSize="12"/>
                                </StackPanel>
                                
                                <!-- Add Button -->
                                <Button Command="{x:Bind ViewModel.StartManualAddPersonnelCommand}"
                                        HorizontalAlignment="Stretch">
                                    <Button.Content>
                                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                            <SymbolIcon Symbol="Add"/>
                                            <TextBlock Text="æ·»åŠ å‚ä¸Žäººå‘˜ï¼ˆå¯¹æ‰€æœ‰å“¨ä½å¯ç”¨ï¼‰"/>
                                        </StackPanel>
                                    </Button.Content>
                                </Button>
                                
                                <!-- Explanation -->
                                <TextBlock Text="è¯´æ˜Ž: è¿™äº›äººå‘˜å¯ä»¥è¢«åˆ†é…åˆ°ä»»ä½•å“¨ä½ï¼Œä¸å—å“¨ä½å¯ç”¨äººå‘˜åˆ—è¡¨é™åˆ¶" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Step 4: Configure Constraints -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=4, Mode=OneWay}">
                    <StackPanel Spacing="24">
                        <TextBlock Text="æ­¥éª¤ 4: é…ç½®çº¦æŸ" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        
                        <!-- Loading Indicator -->
                        <StackPanel Spacing="12" HorizontalAlignment="Center" 
                                    Visibility="{x:Bind ViewModel.IsLoadingConstraints, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
                            <ProgressRing IsActive="True" Width="48" Height="48"/>
                            <TextBlock Text="æ­£åœ¨åŠ è½½çº¦æŸæ•°æ®..." Style="{ThemeResource BodyTextBlockStyle}"/>
                        </StackPanel>

                        <!-- Content -->
                        <StackPanel Spacing="12" 
                                    Visibility="{x:Bind ViewModel.IsLoadingConstraints, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}">
                            
                            <!-- Holiday Config -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                        BorderThickness="1" Padding="12" CornerRadius="{StaticResource ControlCornerRadius}">
                                <TextBlock Text="ä¼‘æ¯æ—¥é…ç½®" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                                <ToggleSwitch IsOn="{x:Bind ViewModel.UseActiveHolidayConfig, Mode=TwoWay}" 
                                              OffContent="ä½¿ç”¨è‡ªå®šä¹‰é…ç½®" OnContent="ä½¿ç”¨å½“å‰æ´»åŠ¨é…ç½®"/>
                                
                                <!-- Empty State for Holiday Configs -->
                                <InfoBar Severity="Warning" IsOpen="True" 
                                         Visibility="{x:Bind ViewModel.HolidayConfigs.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0, Mode=OneWay}"
                                         Message="æ²¡æœ‰æ‰¾åˆ°ä¼‘æ¯æ—¥é…ç½®ã€‚è¯·å‰å¾€è®¾ç½®é¡µé¢åˆ›å»ºä¼‘æ¯æ—¥é…ç½®ã€‚"/>
                                
                                <ComboBox Header="é€‰æ‹©ä¸€ä¸ªä¼‘æ¯æ—¥é…ç½®" 
                                          ItemsSource="{x:Bind ViewModel.HolidayConfigs, Mode=OneWay}"
                                          SelectedValue="{x:Bind ViewModel.SelectedHolidayConfigId, Mode=TwoWay, FallbackValue=-1}"
                                          SelectedValuePath="Id" DisplayMemberPath="ConfigName"
                                          IsEnabled="{x:Bind ViewModel.UseActiveHolidayConfig, Converter={StaticResource InvertedBooleanConverter}, Mode=OneWay}"
                                          Visibility="{x:Bind ViewModel.HolidayConfigs.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='&gt;0', Mode=OneWay}"/>
                            </StackPanel>

                            <!-- Fixed Position Rules -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                        BorderThickness="1" Padding="12" CornerRadius="{StaticResource ControlCornerRadius}">
                                <TextBlock Text="å®šå²—è§„åˆ™" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                                
                                <!-- Empty State for Fixed Rules -->
                                <TextBlock Text="æ²¡æœ‰æ‰¾åˆ°å®šå²—è§„åˆ™" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Visibility="{x:Bind ViewModel.FixedPositionRules.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0, Mode=OneWay}"/>
                                
                                <ListView ItemsSource="{x:Bind ViewModel.FixedPositionRules, Mode=OneWay}" 
                                          SelectionMode="None" MaxHeight="200"
                                          Visibility="{x:Bind ViewModel.FixedPositionRules.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='&gt;0', Mode=OneWay}">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="models:FixedPositionRule">
                                            <CheckBox Content="{x:Bind Description}" IsChecked="{x:Bind IsEnabled, Mode=TwoWay}"/>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </StackPanel>

                            <!-- Manual Assignments -->
                            <StackPanel Spacing="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                        BorderThickness="1" Padding="12" CornerRadius="{StaticResource ControlCornerRadius}">
                                <Grid>
                                    <TextBlock Text="æ‰‹åŠ¨æŒ‡å®š" Style="{ThemeResource BaseTextBlockStyle}" FontWeight="SemiBold"/>
                                    <Button Content="æ·»åŠ æ‰‹åŠ¨æŒ‡å®š" 
                                            Command="{x:Bind ViewModel.StartCreateManualAssignmentCommand}"
                                            HorizontalAlignment="Right"
                                            Style="{ThemeResource AccentButtonStyle}"/>
                                </Grid>
                                
                                <!-- Empty State for Manual Assignments -->
                                <TextBlock Text="æš‚æ— æ‰‹åŠ¨æŒ‡å®š" 
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           Visibility="{x:Bind ViewModel.AllManualAssignments.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=0, Mode=OneWay}"/>
                                
                                <!-- Manual Assignment List -->
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.AllManualAssignments, Mode=OneWay}"
                                               Visibility="{x:Bind ViewModel.AllManualAssignments.Count, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='&gt;0', Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="viewmodels:ManualAssignmentViewModel">
                                            <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                    BorderThickness="1" Padding="12" CornerRadius="4" Margin="0,4">
                                                <Grid ColumnSpacing="12">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/> <!-- Status Badge -->
                                                        <ColumnDefinition Width="*"/>    <!-- Content -->
                                                        <ColumnDefinition Width="Auto"/> <!-- Actions -->
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <!-- Status Badge -->
                                                    <Border Grid.Column="0" 
                                                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                                                            Padding="8,4" 
                                                            CornerRadius="4"
                                                            Visibility="{x:Bind IsTemporary, Mode=OneWay}">
                                                        <TextBlock Text="{x:Bind StatusBadge}" 
                                                                   FontSize="12"
                                                                   Foreground="White"/>
                                                    </Border>
                                                    
                                                    <!-- Content -->
                                                    <StackPanel Grid.Column="1" Spacing="4">
                                                        <TextBlock>
                                                            <Run Text="{x:Bind Date}" FontWeight="SemiBold"/>
                                                            <Run Text=" | "/>
                                                            <Run Text="{x:Bind TimeSlotDisplay}"/>
                                                        </TextBlock>
                                                        <TextBlock>
                                                            <Run Text="{x:Bind PersonnelName}" FontWeight="SemiBold"/>
                                                            <Run Text=" â†’ "/>
                                                            <Run Text="{x:Bind PositionName}" FontWeight="SemiBold"/>
                                                        </TextBlock>
                                                        <TextBlock Text="{x:Bind Remarks}" 
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   Visibility="{x:Bind Remarks, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Actions -->
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                                        <ToggleSwitch IsOn="{x:Bind IsEnabled, Mode=TwoWay}" 
                                                                      OnContent="" 
                                                                      OffContent=""
                                                                      MinWidth="40"/>
                                                        <Button Content="ç¼–è¾‘" 
                                                                Command="{Binding ElementName=Root, Path=ViewModel.StartEditManualAssignmentCommand}"
                                                                CommandParameter="{x:Bind}"
                                                                Visibility="{x:Bind CanEdit}"/>
                                                        <Button Content="åˆ é™¤" 
                                                                Command="{Binding ElementName=Root, Path=ViewModel.DeleteManualAssignmentCommand}"
                                                                CommandParameter="{x:Bind}"
                                                                Visibility="{x:Bind CanDelete}"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- Step 5: Summary -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=5, Mode=OneWay}">
                    <StackPanel Spacing="12">
                        <TextBlock Text="æ­¥éª¤ 5: ç¡®è®¤å‚æ•°å¹¶æ‰§è¡Œ" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.SummarySections, Mode=OneWay}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="viewmodels:SummarySection">
                                    <InfoBar Title="{x:Bind Header}" Severity="Informational" IsOpen="True" Margin="0,0,0,8">
                                        <InfoBar.Content>
                                            <ItemsRepeater ItemsSource="{x:Bind Lines}">
                                                <ItemsRepeater.ItemTemplate>
                                                    <DataTemplate x:DataType="x:String">
                                                        <TextBlock Text="{x:Bind}" Style="{ThemeResource BodyTextBlockStyle}"/>
                                                    </DataTemplate>
                                                </ItemsRepeater.ItemTemplate>
                                            </ItemsRepeater>
                                        </InfoBar.Content>
                                    </InfoBar>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ScrollViewer>

        <!-- Navigation Buttons -->
        <Grid Grid.Row="2" Padding="24" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderThickness="0,1,0,0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Content="å–æ¶ˆ" Command="{x:Bind ViewModel.CancelCommand}" Grid.Column="0"/>

            <StackPanel Orientation="Horizontal" Spacing="8" Grid.Column="2">
                <Button Content="ä¸Šä¸€æ­¥" Command="{x:Bind ViewModel.PreviousStepCommand}"
                        Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='&gt;1', Mode=OneWay}"/>
                <Button Content="ä¸‹ä¸€æ­¥" Command="{x:Bind ViewModel.NextStepCommand}" Style="{ThemeResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter='&lt;5', Mode=OneWay}"/>
                <Button Content="ä¿å­˜ä¸ºæ¨¡æ¿" Command="{x:Bind ViewModel.SaveAsTemplateCommand}"
                        Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=5, Mode=OneWay}"/>
                <Button Content="å¼€å§‹æŽ’ç­" Command="{x:Bind ViewModel.ExecuteSchedulingCommand}" Style="{ThemeResource AccentButtonStyle}"
                        Visibility="{x:Bind ViewModel.CurrentStep, Converter={StaticResource IntToVisibilityConverter}, ConverterParameter=5, Mode=OneWay}">
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel Spacing="8">
                                <TextBlock Text="æ­£åœ¨æ‰§è¡ŒæŽ’ç­..." Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                                <ProgressRing IsActive="{x:Bind ViewModel.IsExecuting, Mode=OneWay}"/>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Manual Assignment Create/Edit Dialog -->
        <ContentDialog x:Name="ManualAssignmentDialog"
                       Title="æ‰‹åŠ¨æŒ‡å®š"
                       PrimaryButtonText="æäº¤"
                       CloseButtonText="å–æ¶ˆ"
                       DefaultButton="Primary"
                       PrimaryButtonCommand="{x:Bind ViewModel.SubmitCreateManualAssignmentCommand}"
                       CloseButtonCommand="{x:Bind ViewModel.CancelCreateManualAssignmentCommand}">
            <ScrollViewer MaxHeight="500">
                <StackPanel Spacing="12">
                    <!-- Date Picker -->
                    <StackPanel Spacing="4">
                        <CalendarDatePicker Header="æ—¥æœŸ*" 
                                            Date="{x:Bind ViewModel.NewManualAssignmentDate, Mode=TwoWay}"
                                            MinDate="{x:Bind ViewModel.StartDate, Mode=OneWay}"
                                            MaxDate="{x:Bind ViewModel.EndDate, Mode=OneWay}"
                                            PlaceholderText="é€‰æ‹©æ—¥æœŸ"/>
                        <TextBlock Text="{x:Bind ViewModel.DateValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.DateValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Personnel Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="äººå‘˜*"
                                  ItemsSource="{x:Bind ViewModel.SelectedPersonnels, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.NewManualAssignmentPersonnelId, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Id"
                                  DisplayMemberPath="Name"
                                  PlaceholderText="é€‰æ‹©äººå‘˜"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.PersonnelValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.PersonnelValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Position Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="å“¨ä½*"
                                  ItemsSource="{x:Bind ViewModel.SelectedPositions, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.NewManualAssignmentPositionId, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Id"
                                  DisplayMemberPath="Name"
                                  PlaceholderText="é€‰æ‹©å“¨ä½"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.PositionValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.PositionValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Time Slot Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="æ—¶æ®µ*"
                                  ItemsSource="{x:Bind ViewModel.TimeSlotOptions, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.NewManualAssignmentTimeSlot, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Index"
                                  DisplayMemberPath="DisplayText"
                                  PlaceholderText="é€‰æ‹©æ—¶æ®µ"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.TimeSlotValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.TimeSlotValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Remarks -->
                    <TextBox Header="æè¿°ï¼ˆå¯é€‰ï¼‰"
                             Text="{x:Bind ViewModel.NewManualAssignmentRemarks, Mode=TwoWay}"
                             MaxLength="200"
                             PlaceholderText="è¾“å…¥æè¿°ä¿¡æ¯"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             Height="80"/>
                    
                    <!-- Enabled Toggle -->
                    <ToggleSwitch Header="å¯ç”¨"
                                  IsOn="{x:Bind ViewModel.NewManualAssignment.IsEnabled, Mode=TwoWay}"/>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>

        <!-- Manual Assignment Edit Dialog -->
        <ContentDialog x:Name="ManualAssignmentEditDialog"
                       Title="ç¼–è¾‘æ‰‹åŠ¨æŒ‡å®š"
                       PrimaryButtonText="æäº¤"
                       CloseButtonText="å–æ¶ˆ"
                       DefaultButton="Primary"
                       PrimaryButtonCommand="{x:Bind ViewModel.SubmitEditManualAssignmentCommand}"
                       CloseButtonCommand="{x:Bind ViewModel.CancelEditManualAssignmentCommand}">
            <ScrollViewer MaxHeight="500">
                <StackPanel Spacing="12">
                    <!-- Date Picker -->
                    <StackPanel Spacing="4">
                        <CalendarDatePicker Header="æ—¥æœŸ*" 
                                            Date="{x:Bind ViewModel.EditingManualAssignmentDate, Mode=TwoWay}"
                                            MinDate="{x:Bind ViewModel.StartDate, Mode=OneWay}"
                                            MaxDate="{x:Bind ViewModel.EndDate, Mode=OneWay}"
                                            PlaceholderText="é€‰æ‹©æ—¥æœŸ"/>
                        <TextBlock Text="{x:Bind ViewModel.DateValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.DateValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Personnel Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="äººå‘˜*"
                                  ItemsSource="{x:Bind ViewModel.SelectedPersonnels, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.EditingManualAssignmentPersonnelId, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Id"
                                  DisplayMemberPath="Name"
                                  PlaceholderText="é€‰æ‹©äººå‘˜"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.PersonnelValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.PersonnelValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Position Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="å“¨ä½*"
                                  ItemsSource="{x:Bind ViewModel.SelectedPositions, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.EditingManualAssignmentPositionId, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Id"
                                  DisplayMemberPath="Name"
                                  PlaceholderText="é€‰æ‹©å“¨ä½"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.PositionValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.PositionValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Time Slot Selection -->
                    <StackPanel Spacing="4">
                        <ComboBox Header="æ—¶æ®µ*"
                                  ItemsSource="{x:Bind ViewModel.TimeSlotOptions, Mode=OneWay}"
                                  SelectedValue="{x:Bind ViewModel.EditingManualAssignmentTimeSlot, Mode=TwoWay, FallbackValue=-1}"
                                  SelectedValuePath="Index"
                                  DisplayMemberPath="DisplayText"
                                  PlaceholderText="é€‰æ‹©æ—¶æ®µ"
                                  HorizontalAlignment="Stretch"/>
                        <TextBlock Text="{x:Bind ViewModel.TimeSlotValidationError, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}"
                                   FontSize="12"
                                   Visibility="{x:Bind ViewModel.TimeSlotValidationError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse, Mode=OneWay}"/>
                    </StackPanel>
                    
                    <!-- Remarks -->
                    <TextBox Header="æè¿°ï¼ˆå¯é€‰ï¼‰"
                             Text="{x:Bind ViewModel.EditingManualAssignmentRemarks, Mode=TwoWay}"
                             MaxLength="200"
                             PlaceholderText="è¾“å…¥æè¿°ä¿¡æ¯"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             Height="80"/>
                    
                    <!-- Enabled Toggle -->
                    <ToggleSwitch Header="å¯ç”¨"
                                  IsOn="{x:Bind ViewModel.EditingManualAssignmentDto.IsEnabled, Mode=TwoWay}"/>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>

        <!-- Add Personnel to Position Dialog -->
        <ContentDialog x:Name="AddPersonnelToPositionDialog"
                       Title="ä¸ºå“¨ä½æ·»åŠ äººå‘˜"
                       PrimaryButtonText="æ·»åŠ ï¼ˆä¸´æ—¶ï¼‰"
                       CloseButtonText="å–æ¶ˆ"
                       DefaultButton="Primary"
                       PrimaryButtonCommand="{x:Bind ViewModel.SubmitAddPersonnelToPositionCommand}"
                       CloseButtonCommand="{x:Bind ViewModel.CancelAddPersonnelToPositionCommand}">
            <ScrollViewer MaxHeight="500">
                <StackPanel Spacing="12">
                    <!-- Position Info -->
                    <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            Padding="12"
                            CornerRadius="{StaticResource ControlCornerRadius}"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                        <StackPanel Spacing="4">
                            <TextBlock Text="å“¨ä½ä¿¡æ¯" FontWeight="SemiBold"/>
                            <TextBlock>
                                <Run Text="å“¨ä½: " Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Run Text="{x:Bind ViewModel.CurrentEditingPosition.Name, Mode=OneWay}" FontWeight="SemiBold"/>
                            </TextBlock>
                            <TextBlock>
                                <Run Text="åœ°ç‚¹: " Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <Run Text="{x:Bind ViewModel.CurrentEditingPosition.Location, Mode=OneWay}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Search Box -->
                    <AutoSuggestBox PlaceholderText="ðŸ” æœç´¢äººå‘˜..."
                                    QueryIcon="Find"
                                    x:Name="PersonnelSearchBox"/>

                    <!-- Filter Option -->
                    <CheckBox Content="ä»…æ˜¾ç¤ºå…·å¤‡æ‰€éœ€æŠ€èƒ½çš„äººå‘˜"
                              x:Name="FilterBySkillsCheckBox"/>

                    <!-- Personnel List -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="å¯ç”¨äººå‘˜åˆ—è¡¨ (ä»Žæ‰€æœ‰äººå‘˜ä¸­é€‰æ‹©):" FontWeight="SemiBold"/>
                        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="{StaticResource ControlCornerRadius}"
                                MaxHeight="300">
                            <ListView ItemsSource="{x:Bind ViewModel.AvailablePersonnelForPosition, Mode=OneWay}"
                                      SelectionMode="Multiple"
                                      x:Name="AddPersonnelListView"
                                      SelectionChanged="AddPersonnelListView_SelectionChanged">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="dto:PersonnelDto">
                                        <StackPanel Orientation="Horizontal" Spacing="12" Padding="8">
                                            <SymbolIcon Symbol="Contact"/>
                                            <StackPanel Spacing="4">
                                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                                                <TextBlock FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                    <Run Text="æŠ€èƒ½: "/>
                                                    <Run Text="{x:Bind SkillIds.Count}"/>
                                                    <Run Text="é¡¹"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>

        <!-- Manual Add Personnel Dialog -->
        <ContentDialog x:Name="ManualAddPersonnelDialog"
                       Title="æ‰‹åŠ¨æ·»åŠ å‚ä¸Žäººå‘˜"
                       PrimaryButtonText="æ·»åŠ "
                       CloseButtonText="å–æ¶ˆ"
                       DefaultButton="Primary"
                       PrimaryButtonCommand="{x:Bind ViewModel.SubmitManualAddPersonnelCommand}"
                       CloseButtonCommand="{x:Bind ViewModel.CancelManualAddPersonnelCommand}">
            <ScrollViewer MaxHeight="500">
                <StackPanel Spacing="12">
                    <!-- Info Message -->
                    <InfoBar Severity="Informational"
                             IsOpen="True"
                             Message="ä»Žæ‰€æœ‰äººå‘˜ä¸­é€‰æ‹©ä¸åœ¨ä»»ä½•å·²é€‰å“¨ä½å¯ç”¨äººå‘˜åˆ—è¡¨ä¸­çš„äººå‘˜"/>

                    <!-- Search Box -->
                    <AutoSuggestBox PlaceholderText="ðŸ” æœç´¢äººå‘˜..."
                                    QueryIcon="Find"
                                    x:Name="ManualPersonnelSearchBox"/>

                    <!-- Personnel List -->
                    <StackPanel Spacing="4">
                        <TextBlock Text="å¯ç”¨äººå‘˜åˆ—è¡¨ (ä»Žæ‰€æœ‰äººå‘˜ä¸­é€‰æ‹©):" FontWeight="SemiBold"/>
                        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="{StaticResource ControlCornerRadius}"
                                MaxHeight="300">
                            <ListView ItemsSource="{x:Bind ViewModel.AvailablePersonnelForManualAdd, Mode=OneWay}"
                                      SelectionMode="Multiple"
                                      x:Name="ManualAddPersonnelListView"
                                      SelectionChanged="ManualAddPersonnelListView_SelectionChanged">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="dto:PersonnelDto">
                                        <StackPanel Orientation="Horizontal" Spacing="12" Padding="8">
                                            <SymbolIcon Symbol="Contact"/>
                                            <StackPanel Spacing="4">
                                                <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                                                <TextBlock FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                    <Run Text="æŠ€èƒ½: "/>
                                                    <Run Text="{x:Bind SkillIds.Count}"/>
                                                    <Run Text="é¡¹"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>

                    <!-- Explanation -->
                    <TextBlock TextWrapping="Wrap"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               FontSize="12">
                        <Run Text="è¯´æ˜Ž: è¿™äº›äººå‘˜å°†è¢«æ·»åŠ åˆ°å‚ä¸Žäººå‘˜åˆ—è¡¨ï¼Œä½†ä¸ä¼šè¢«æ·»åŠ åˆ°ä»»ä½•å“¨ä½çš„å¯ç”¨äººå‘˜åˆ—è¡¨ä¸­"/>
                    </TextBlock>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>
    </Grid>
</Page>
