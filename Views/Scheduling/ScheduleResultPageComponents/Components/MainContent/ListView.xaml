<UserControl
    x:Class="AutoScheduling3.Views.Scheduling.ScheduleResultPageComponents.Components.MainContent.ListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:local="using:AutoScheduling3.Views.Scheduling.ScheduleResultPageComponents.Components.MainContent"
    mc:Ignorable="d"
    Background="Transparent">

    <UserControl.Resources>
        <converters:ConflictTypeToColorConverter x:Key="ConflictTypeToColorConverter"/>
        <converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        
        <!-- 列表项模板 -->
        <DataTemplate x:Key="ShiftItemTemplate" x:DataType="local:ShiftListItem">
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="8"
                  Margin="0,0,0,8"
                  Padding="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 冲突指示器 -->
                <Border Grid.Column="0"
                        Width="4"
                        Background="{x:Bind ConflictColor, Mode=OneWay}"
                        CornerRadius="2"
                        Margin="0,0,12,0"
                        Visibility="{x:Bind HasConflict, Mode=OneWay}"/>
                
                <!-- 班次信息 -->
                <StackPanel Grid.Column="1" Spacing="4">
                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                        <TextBlock Text="{x:Bind Date, Mode=OneWay}" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"/>
                        <TextBlock Text="{x:Bind TimeSlot, Mode=OneWay}" 
                                   FontSize="14" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Text="{x:Bind PositionName, Mode=OneWay}" 
                                   FontSize="14" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                        <TextBlock Text="{x:Bind PersonnelName, Mode=OneWay}" 
                                   FontSize="14"/>
                        <TextBlock Text="{x:Bind Status, Mode=OneWay}" 
                                   FontSize="12" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>
                
                <!-- 操作按钮 -->
                <Button Grid.Column="2"
                        Content="详情"
                        Style="{ThemeResource TextBlockButtonStyle}"
                        Margin="12,0,0,0"/>
            </Grid>
        </DataTemplate>
        
        <!-- 排序头模板 -->
        <DataTemplate x:Key="SortHeaderTemplate" x:DataType="local:SortableColumn">
            <Button Command="{x:Bind SortCommand, Mode=OneWay}"
                    CommandParameter="{x:Bind ColumnName, Mode=OneWay}"
                    Style="{ThemeResource TextBlockButtonStyle}">
                <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="{x:Bind Header, Mode=OneWay}"/>
                    <TextBlock Text="{x:Bind SortIndicator, Mode=OneWay}" 
                               Visibility="{x:Bind HasSortIndicator, Mode=OneWay}"/>
                </StackPanel>
            </Button>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 排序和筛选栏 -->
        <Border Grid.Row="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="12">
            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                <!-- 排序选项 -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <ItemsRepeater ItemsSource="{x:Bind SortableColumns, Mode=OneWay}"
                                   ItemTemplate="{StaticResource SortHeaderTemplate}">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="12"/>
                        </ItemsRepeater.Layout>
                    </ItemsRepeater>
                </StackPanel>
                
                <!-- 占位符，将筛选按钮推到右侧 -->
                <Grid HorizontalAlignment="Stretch"/>
                
                <!-- 筛选按钮 -->
                <Button Content="筛选" 
                        Style="{ThemeResource ButtonStyle}"
                        Margin="0,0,8,0"/>
                
                <!-- 视图选项 -->
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <ToggleButton Content="紧凑" 
                                  IsChecked="{x:Bind IsCompactView, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='True'}"
                                  Style="{ThemeResource ToggleButtonStyle}"/>
                    <ToggleButton Content="舒适" 
                                  IsChecked="{x:Bind IsCompactView, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='False'}"
                                  Style="{ThemeResource ToggleButtonStyle}"/>
                </StackPanel>
            </StackPanel>
        </Border>
        
        <!-- 列表内容 -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Hidden">
            <ItemsRepeater ItemsSource="{x:Bind ShiftItems, Mode=OneWay}"
                           ItemTemplate="{StaticResource ShiftItemTemplate}">
                <ItemsRepeater.Layout>
                    <StackLayout Spacing="0"/>
                </ItemsRepeater.Layout>
            </ItemsRepeater>
        </ScrollViewer>
    </Grid>
</UserControl>