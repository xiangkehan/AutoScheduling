<UserControl
    x:Class="AutoScheduling3.Views.Scheduling.ScheduleResultPageComponents.Components.MainContent.PersonnelView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:local="using:AutoScheduling3.Views.Scheduling.ScheduleResultPageComponents.Components.MainContent"
    mc:Ignorable="d"
    Background="Transparent">

    <UserControl.Resources>
        <converters:ConflictTypeToColorConverter x:Key="ConflictTypeToColorConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InvertedBooleanConverter x:Key="InvertedBooleanConverter"/>
        
        <!-- 人员分组模板 -->
        <DataTemplate x:Key="PersonnelGroupTemplate" x:DataType="local:PersonnelGroup">
            <Grid>
                <!-- 分组头 -->
                <Button x:Name="GroupHeaderButton"
                        Click="GroupHeaderButton_Click"
                        Style="{ThemeResource TextBlockButtonStyle}"
                        Padding="0"
                        HorizontalAlignment="Stretch">
                    <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                          BorderThickness="1"
                          CornerRadius="8"
                          Margin="0,0,0,8"
                          Padding="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 展开/折叠图标 -->
                        <FontIcon Grid.Column="0"
                                  Glyph="{x:Bind IsExpanded, Mode=OneWay, Converter={StaticResource BoolToGlyphConverter}, ConverterParameter='\uE76C,\uE70D'}"
                                  FontSize="16"
                                  Margin="0,0,12,0"/>
                        
                        <!-- 人员信息 -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind PersonnelName, Mode=OneWay}" 
                                       FontSize="16" 
                                       FontWeight="SemiBold"/>
                            <TextBlock Text="{x:Bind ShiftCount, Mode=OneWay}" 
                                       FontSize="14" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind ConflictCount, Mode=OneWay}" 
                                       FontSize="14" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                        
                        <!-- 统计信息 -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                            <TextBlock Text="{x:Bind TotalHours, Mode=OneWay}" 
                                       FontSize="14" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind NightShiftCount, Mode=OneWay}" 
                                       FontSize="14" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>
                </Button>
                
                <!-- 分组内容 -->
                <Border Grid.Row="1"
                        Padding="48,0,0,0"
                        Visibility="{x:Bind IsExpanded, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <ItemsRepeater ItemsSource="{x:Bind Shifts, Mode=OneWay}"
                                   ItemTemplate="{StaticResource ShiftItemTemplate}">
                        <ItemsRepeater.Layout>
                            <StackLayout Spacing="0"/>
                        </ItemsRepeater.Layout>
                    </ItemsRepeater>
                </Border>
            </Grid>
        </DataTemplate>
        
        <!-- 班次项模板 -->
        <DataTemplate x:Key="ShiftItemTemplate" x:DataType="local:PersonnelShiftItem">
            <Grid Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  BorderThickness="1"
                  CornerRadius="6"
                  Margin="0,0,0,8"
                  Padding="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 冲突指示器 -->
                <Border Grid.Column="0"
                        Width="4"
                        Background="{x:Bind ConflictColor, Mode=OneWay}"
                        CornerRadius="2"
                        Margin="0,0,12,0"
                        Visibility="{x:Bind HasConflict, Mode=OneWay}"/>
                
                <!-- 班次信息 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                    <TextBlock Text="{x:Bind Date, Mode=OneWay}" 
                               FontSize="14"/>
                    <TextBlock Text="{x:Bind TimeSlot, Mode=OneWay}" 
                               FontSize="14" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="{x:Bind PositionName, Mode=OneWay}" 
                               FontSize="14" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
                
                <!-- 操作按钮 -->
                <Button Grid.Column="2"
                        Content="详情" 
                        Style="{ThemeResource TextBlockButtonStyle}"
                        Margin="0,0,8,0"/>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 筛选和排序栏 -->
        <Border Grid.Row="0"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="16">
            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                <!-- 排序选项 -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Content="姓名" Style="{ThemeResource ButtonStyle}"/>
                    <Button Content="班次数量" Style="{ThemeResource ButtonStyle}"/>
                    <Button Content="冲突数量" Style="{ThemeResource ButtonStyle}"/>
                </StackPanel>
                
                <!-- 占位符，将筛选按钮推到右侧 -->
                <Grid HorizontalAlignment="Stretch"/>
                
                <!-- 筛选按钮 -->
                <Button Content="筛选" 
                        Style="{ThemeResource ButtonStyle}" 
                        Margin="0,0,8,0"/>
                
                <!-- 展开/折叠所有 -->
                <Button Content="展开所有" 
                        Click="ExpandAllButton_Click"
                        Style="{ThemeResource ButtonStyle}" 
                        Margin="0,0,8,0"/>
                <Button Content="折叠所有" 
                        Click="CollapseAllButton_Click"
                        Style="{ThemeResource ButtonStyle}"/>
            </StackPanel>
        </Border>
        
        <!-- 人员分组列表 -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Hidden"
                      Padding="16,16,16,0">
            <ItemsRepeater ItemsSource="{x:Bind PersonnelGroups, Mode=OneWay}"
                           ItemTemplate="{StaticResource PersonnelGroupTemplate}">
                <ItemsRepeater.Layout>
                    <StackLayout Spacing="0"/>
                </ItemsRepeater.Layout>
            </ItemsRepeater>
        </ScrollViewer>
    </Grid>
</UserControl>