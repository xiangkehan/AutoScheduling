<Page
    x:Class="AutoScheduling3.Views.Scheduling.ScheduleResultPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:AutoScheduling3.ViewModels.Scheduling"
    xmlns:controls="using:AutoScheduling3.Controls"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:dto="using:AutoScheduling3.DTOs"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    d:DataContext="{d:DesignInstance Type=viewmodels:ScheduleResultViewModel, IsDesignTimeCreatable=True}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:BoolToTextConverter x:Key="BoolToTextConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:DateTimeFormatConverter x:Key="DateTimeFormatConverter"/>
        <converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        <converters:AddOneConverter x:Key="AddOneConverter"/>
        <converters:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <converters:BoolToGlyphConverter x:Key="BoolToGlyphConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:ConflictSubTypeToTextConverter x:Key="ConflictSubTypeToTextConverter"/>
    </Page.Resources>

    <!-- ÈîÆÁõòÂø´Êç∑ÈîÆ -->
    <Page.KeyboardAccelerators>
        <!-- Ctrl+F: ÊâìÂºÄÁ≠õÈÄâ -->
        <KeyboardAccelerator Key="F" Modifiers="Control" Invoked="FilterAccelerator_Invoked"/>
        <!-- Ctrl+E: ÂØºÂá∫ -->
        <KeyboardAccelerator Key="E" Modifiers="Control" Invoked="ExportAccelerator_Invoked"/>
        <!-- Ctrl+S: ‰øùÂ≠òÊõ¥Êîπ -->
        <KeyboardAccelerator Key="S" Modifiers="Control" Invoked="SaveAccelerator_Invoked"/>
        <!-- Esc: ÂÖ≥Èó≠ÂÜ≤Á™ÅÈù¢Êùø -->
        <KeyboardAccelerator Key="Escape" Invoked="EscapeAccelerator_Invoked"/>
    </Page.KeyboardAccelerators>

    <Grid>
        <!-- Main content visible when Schedule not null -->
        <Grid Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header and Toolbar -->
            <StackPanel Grid.Row="0" Margin="24,24,24,12" Spacing="12">
                <!-- Title Section -->
                <StackPanel AutomationProperties.Name="ÊéíÁè≠ÁªìÊûúÊ†áÈ¢òÂå∫Âüü" AutomationProperties.HeadingLevel="Level1">
                    <!-- Ê†áÈ¢òÂíåÁä∂ÊÄÅÊ†áËØÜ -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="{x:Bind ViewModel.Schedule.Title, Mode=OneWay, FallbackValue='ÊéíÁè≠ÁªìÊûú'}" 
                                   Style="{ThemeResource TitleTextBlockStyle}"
                                   AutomationProperties.Name="ÊéíÁè≠Ê†áÈ¢ò"
                                   AutomationProperties.HeadingLevel="Level1"/>
                        <!-- ËçâÁ®ø/ÂéÜÂè≤Ê†áËØÜ -->
                        <Border VerticalAlignment="Center"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Visibility="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter='invert'}">
                            <TextBlock Text="ËçâÁ®ø" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                       AutomationProperties.Name="ËçâÁ®øÊ†áËØÜ"/>
                        </Border>
                        <Border VerticalAlignment="Center"
                                Background="{ThemeResource SystemFillColorSuccessBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Visibility="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                            <TextBlock Text="Â∑≤Á°ÆËÆ§" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="White"
                                       AutomationProperties.Name="Â∑≤Á°ÆËÆ§Ê†áËØÜ"/>
                        </Border>
                    </StackPanel>
                    <!-- Êó•ÊúüËåÉÂõ¥ -->
                    <TextBlock Style="{ThemeResource BodyTextBlockStyle}" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               AutomationProperties.Name="ÊéíÁè≠Êó•ÊúüËåÉÂõ¥">
                        <Run Text="{x:Bind ViewModel.Schedule.StartDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                        <Run Text=" Ëá≥ "/>
                        <Run Text="{x:Bind ViewModel.Schedule.EndDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                    </TextBlock>
                </StackPanel>

                <!-- Filter Toolbar -->
                <Grid x:Name="FilterToolbar"
                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                      BorderThickness="1" 
                      CornerRadius="8" 
                      Padding="16"
                      AutomationProperties.Name="Á≠õÈÄâÂ∑•ÂÖ∑Ê†è"
                      AutomationProperties.LandmarkType="Search">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Date Range Filter -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="Êó•Êúü:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="Êó•ÊúüÁ≠õÈÄâÊ†áÁ≠æ"/>
                        <CalendarDatePicker x:Name="FilterStartDatePicker"
                                            PlaceholderText="ÂºÄÂßãÊó•Êúü"
                                            DateChanged="FilterStartDatePicker_DateChanged"
                                            AutomationProperties.Name="Á≠õÈÄâÂºÄÂßãÊó•Êúü"
                                            AutomationProperties.HelpText="ÈÄâÊã©Á≠õÈÄâÁöÑÂºÄÂßãÊó•Êúü"/>
                        <TextBlock Text="Ëá≥" VerticalAlignment="Center"/>
                        <CalendarDatePicker x:Name="FilterEndDatePicker"
                                            PlaceholderText="ÁªìÊùüÊó•Êúü"
                                            DateChanged="FilterEndDatePicker_DateChanged"
                                            AutomationProperties.Name="Á≠õÈÄâÁªìÊùüÊó•Êúü"
                                            AutomationProperties.HelpText="ÈÄâÊã©Á≠õÈÄâÁöÑÁªìÊùüÊó•Êúü"/>
                    </StackPanel>

                    <!-- Position Filter -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="Âì®‰Ωç:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="Âì®‰ΩçÁ≠õÈÄâÊ†áÁ≠æ"/>
                        <ComboBox x:Name="PositionFilterComboBox"
                                  MinWidth="150"
                                  ItemsSource="{x:Bind ViewModel.SelectedPositionIds}"
                                  IsEditable="False"
                                  PlaceholderText="ÈÄâÊã©Âì®‰Ωç"
                                  AutomationProperties.Name="Âì®‰ΩçÁ≠õÈÄâ‰∏ãÊãâÊ°Ü"
                                  AutomationProperties.HelpText="ÈÄâÊã©Ë¶ÅÁ≠õÈÄâÁöÑÂì®‰ΩçÔºåÂèØÂ§öÈÄâ"/>
                    </StackPanel>

                    <!-- Personnel Search -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="‰∫∫Âëò:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="‰∫∫ÂëòÊêúÁ¥¢Ê†áÁ≠æ"/>
                        <AutoSuggestBox x:Name="PersonnelSearchBox"
                                        Text="{x:Bind ViewModel.PersonnelSearchText, Mode=TwoWay}"
                                        ItemsSource="{x:Bind ViewModel.PersonnelSuggestions, Mode=OneWay}"
                                        PlaceholderText="ÊêúÁ¥¢ÊàñÈÄâÊã©‰∫∫Âëò"
                                        MinWidth="200"
                                        QueryIcon="Find"
                                        TextChanged="PersonnelSearchBox_TextChanged"
                                        GotFocus="PersonnelSearchBox_GotFocus"
                                        SuggestionChosen="PersonnelSearchBox_SuggestionChosen"
                                        QuerySubmitted="PersonnelSearchBox_QuerySubmitted"
                                        AutomationProperties.Name="‰∫∫ÂëòÊêúÁ¥¢Ê°Ü"
                                        AutomationProperties.HelpText="ËæìÂÖ•‰∫∫ÂëòÂßìÂêçËøõË°åÊ®°Á≥äÊêúÁ¥¢ÔºåÊîØÊåÅÊãºÈü≥È¶ñÂ≠óÊØçÔºåÊàñ‰ªé‰∏ãÊãâÂàóË°®ÈÄâÊã©"
                                        ToolTipService.ToolTip="ÊîØÊåÅÊ®°Á≥äÊêúÁ¥¢ÂíåÊãºÈü≥È¶ñÂ≠óÊØçÂåπÈÖçÔºåÁÇπÂáªÂ±ïÂºÄÊòæÁ§∫ÊâÄÊúâ‰∫∫Âëò">
                            <AutoSuggestBox.ItemTemplate>
                                <DataTemplate x:DataType="dto:PersonnelDto">
                                    <TextBlock Text="{x:Bind Name}" 
                                              Padding="8,4"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </AutoSuggestBox.ItemTemplate>
                        </AutoSuggestBox>
                    </StackPanel>

                    <!-- Spacer -->
                    <Grid Grid.Column="4"/>

                    <!-- Filter Actions -->
                    <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="8">
                        <Button Content="Â∫îÁî®Á≠õÈÄâ" 
                                Command="{x:Bind ViewModel.ApplyFiltersCommand}" 
                                Style="{ThemeResource AccentButtonStyle}"
                                AutomationProperties.Name="Â∫îÁî®Á≠õÈÄâÊåâÈíÆ"
                                AutomationProperties.HelpText="Â∫îÁî®ÂΩìÂâçËÆæÁΩÆÁöÑÁ≠õÈÄâÊù°‰ª∂"
                                ToolTipService.ToolTip="Â∫îÁî®Á≠õÈÄâ (Ctrl+F)"/>
                        <Button Content="ÈáçÁΩÆ" 
                                Command="{x:Bind ViewModel.ResetFiltersCommand}"
                                AutomationProperties.Name="ÈáçÁΩÆÁ≠õÈÄâÊåâÈíÆ"
                                AutomationProperties.HelpText="Ê∏ÖÈô§ÊâÄÊúâÁ≠õÈÄâÊù°‰ª∂Âπ∂ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ"
                                ToolTipService.ToolTip="ÈáçÁΩÆÁ≠õÈÄâ"/>
                    </StackPanel>
                </Grid>

                <!-- View Mode and Actions Toolbar -->
                <CommandBar Background="Transparent" 
                            DefaultLabelPosition="Right" 
                            HorizontalAlignment="Stretch"
                            AutomationProperties.Name="ËßÜÂõæÊ®°ÂºèÂíåÊìç‰ΩúÂ∑•ÂÖ∑Ê†è"
                            AutomationProperties.LandmarkType="Navigation">
                    <CommandBar.Content>
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <!-- View Mode Selector -->
                            <StackPanel Orientation="Horizontal" 
                                        Spacing="8" 
                                        AutomationProperties.Name="ËßÜÂõæÊ®°ÂºèÈÄâÊã©"
                                        AutomationProperties.LandmarkType="Navigation">
                                <RadioButton x:Name="GridRadioButton" 
                                             Content="ÁΩëÊ†º" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='Grid'}"
                                             AutomationProperties.Name="ÁΩëÊ†ºËßÜÂõæÊ®°Âºè"
                                             AutomationProperties.HelpText="‰ª•Ë°®Ê†ºÂΩ¢ÂºèÂ±ïÁ§∫ÊéíÁè≠ÁªìÊûúÔºåË°å‰∏∫Êó•ÊúüÂä†Êó∂ÊÆµÔºåÂàó‰∏∫Âì®‰Ωç"
                                             ToolTipService.ToolTip="ÁΩëÊ†ºËßÜÂõæ"/>
                                <RadioButton x:Name="ListRadioButton" 
                                             Content="ÂàóË°®" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='List'}"
                                             AutomationProperties.Name="ÂàóË°®ËßÜÂõæÊ®°Âºè"
                                             AutomationProperties.HelpText="‰ª•ÂàóË°®ÂΩ¢ÂºèÂ±ïÁ§∫ÊâÄÊúâÁè≠Ê¨°ÂàÜÈÖç"
                                             ToolTipService.ToolTip="ÂàóË°®ËßÜÂõæ"/>
                                <RadioButton x:Name="ByPersonnelRadioButton" 
                                             Content="Êåâ‰∫∫Âëò" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='ByPersonnel'}"
                                             AutomationProperties.Name="‰∫∫ÂëòËßÜÂõæÊ®°Âºè"
                                             AutomationProperties.HelpText="Êåâ‰∫∫ÂëòÂàÜÁªÑÂ±ïÁ§∫ÊØè‰∏™‰∫∫ÁöÑÁè≠Ê¨°ÂÆâÊéí"
                                             ToolTipService.ToolTip="‰∫∫ÂëòËßÜÂõæ"/>
                                <RadioButton x:Name="ByPositionRadioButton" 
                                             Content="ÊåâÂì®‰Ωç" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='ByPosition'}"
                                             AutomationProperties.Name="Âì®‰ΩçËßÜÂõæÊ®°Âºè"
                                             AutomationProperties.HelpText="ÊåâÂì®‰ΩçÂàÜÂà´Â±ïÁ§∫ÊéíÁè≠Ë°®ÔºåÊØè‰∏™Âì®‰Ωç‰∏ÄÂº†Ë°®"
                                             ToolTipService.ToolTip="Âì®‰ΩçËßÜÂõæ"/>
                            </StackPanel>
                        </StackPanel>
                    </CommandBar.Content>
                    <AppBarButton Icon="Save" 
                                  Label="ÂØºÂá∫" 
                                  Command="{x:Bind ViewModel.ExportExcelCommand}"
                                  AutomationProperties.Name="ÂØºÂá∫ÊéíÁè≠Ë°®"
                                  AutomationProperties.HelpText="ÂØºÂá∫ÊéíÁè≠ÁªìÊûú‰∏∫Excel„ÄÅCSVÊàñPDFÊñá‰ª∂"
                                  ToolTipService.ToolTip="ÂØºÂá∫ (Ctrl+E)"/>
                    <AppBarButton x:Name="FullScreenButton" 
                                  Icon="FullScreen" 
                                  Label="ÂÖ®Â±è" 
                                  Command="{x:Bind ViewModel.ToggleFullScreenCommand}"
                                  AutomationProperties.Name="ÂÖ®Â±èÊü•Áúã"
                                  AutomationProperties.HelpText="Âú®ÂÖ®Â±èÊ®°Âºè‰∏ãÊü•ÁúãÊéíÁè≠Ë°®Ê†º"
                                  ToolTipService.ToolTip="ÂÖ®Â±èÊü•Áúã"/>
                    <AppBarButton x:Name="CompareButton" 
                                  Icon="TwoPage" 
                                  Label="ÊØîËæÉ" 
                                  Command="{x:Bind ViewModel.CompareSchedulesCommand}"
                                  AutomationProperties.Name="ÊØîËæÉÊéíÁè≠"
                                  AutomationProperties.HelpText="‰∏éÂéÜÂè≤ÊéíÁè≠ÊñπÊ°àËøõË°åÊØîËæÉ"
                                  ToolTipService.ToolTip="ÊØîËæÉÊéíÁè≠"/>
                    <AppBarToggleButton Icon="Flag" 
                                        Label="ÂÜ≤Á™Å" 
                                        IsChecked="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                                        AutomationProperties.Name="ÂÜ≤Á™ÅÈù¢ÊùøÂºÄÂÖ≥"
                                        AutomationProperties.HelpText="ÊòæÁ§∫ÊàñÈöêËóèÂÜ≤Á™ÅÂíåË≠¶ÂëäÈù¢Êùø"
                                        ToolTipService.ToolTip="ÂÜ≤Á™ÅÂíåË≠¶Âëä"/>
                </CommandBar>
            </StackPanel>

            <!-- Main Content and Conflict Pane -->
            <SplitView Grid.Row="1"
                       IsPaneOpen="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                       PanePlacement="Right"
                       DisplayMode="Inline"
                       OpenPaneLength="360">
                <SplitView.Pane>
                    <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                          BorderThickness="1,0,0,0" 
                          Padding="12"
                          AutomationProperties.Name="Âè≥‰æßÈù¢Êùø"
                          AutomationProperties.LandmarkType="Custom">
                        <!-- TabView for Search Results and Conflict Management -->
                        <TabView x:Name="RightPaneTabView"
                                 SelectedIndex="{x:Bind ViewModel.RightPaneTabIndex, Mode=TwoWay}"
                                 TabWidthMode="Equal"
                                 CanDragTabs="False"
                                 CanReorderTabs="False"
                                 IsAddTabButtonVisible="False"
                                 AutomationProperties.Name="Âè≥‰æßÈù¢ÊùøÊ†áÁ≠æÈ°µ">
                            
                            <!-- Search Results Tab -->
                            <TabView.TabItems>
                                <TabViewItem Header="ÊêúÁ¥¢ÁªìÊûú"
                                             IsClosable="False"
                                             Visibility="{x:Bind ViewModel.IsSearchResultsTabVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                             AutomationProperties.Name="ÊêúÁ¥¢ÁªìÊûúÊ†áÁ≠æÈ°µ">
                                    <Grid Padding="0,12,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Filter Summary and Result Count -->
                                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
                                            <TextBlock Text="ÊêúÁ¥¢ÁªìÊûú" 
                                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                                       AutomationProperties.Name="ÊêúÁ¥¢ÁªìÊûúÊ†áÈ¢ò"
                                                       AutomationProperties.HeadingLevel="Level2"/>
                                            
                                            <!-- Result Count -->
                                            <TextBlock FontSize="14" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="ÊêúÁ¥¢ÁªìÊûúÊï∞Èáè"
                                                       AutomationProperties.LiveSetting="Polite"
                                                       Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter='invert'}">
                                                <Run Text="ÂÖ±"/>
                                                <Run Text="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay}" FontWeight="SemiBold"/>
                                                <Run Text="‰∏™Áè≠Ê¨°"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Loading Indicator -->
                                        <StackPanel Grid.Row="2"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Spacing="12"
                                                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                    AutomationProperties.Name="Âä†ËΩΩ‰∏≠ÊåáÁ§∫Âô®">
                                            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                                                          Width="48"
                                                          Height="48"/>
                                            <TextBlock Text="Ê≠£Âú®ÊêúÁ¥¢..."
                                                       Style="{ThemeResource BodyTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Search Results List (‰ΩøÁî® ListView ÂêØÁî®ËôöÊãüÂåñ) -->
                                        <ListView Grid.Row="2"
                                                  ItemsSource="{x:Bind ViewModel.SearchResults, Mode=OneWay}"
                                                  SelectionMode="Single"
                                                  SelectedItem="{x:Bind ViewModel.SelectedSearchResult, Mode=TwoWay}"
                                                  Margin="0,0,0,12"
                                                  Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter='invert'}"
                                                  AutomationProperties.Name="ÊêúÁ¥¢ÁªìÊûúÂàóË°®"
                                                  AutomationProperties.LandmarkType="Custom"
                                                  AutomationProperties.LiveSetting="Polite">
                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                            <ListView.ItemTemplate>
                                                    <DataTemplate x:DataType="dto:SearchResultItem">
                                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="8"
                                                                Padding="12"
                                                                Margin="0,0,0,8"
                                                                AutomationProperties.Name="{x:Bind DisplayText}">
                                                            <StackPanel Spacing="8">
                                                                <!-- Date and Time Header -->
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <!-- Night/Day Icon -->
                                                                    <FontIcon Grid.Column="0"
                                                                              Glyph="{x:Bind IsNightShift, Converter={StaticResource BoolToGlyphConverter}, ConverterParameter='üåô|‚òÄ'}"
                                                                              FontSize="16"
                                                                              Margin="0,0,8,0"
                                                                              VerticalAlignment="Top"
                                                                              Foreground="{x:Bind IsNightShift, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFB366|#FFD700'}"/>

                                                                    <!-- Date and Time Info -->
                                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                                        <TextBlock FontWeight="SemiBold"
                                                                                   TextWrapping="Wrap"
                                                                                   AutomationProperties.Name="Êó•ÊúüÂíåÊó∂ÊÆµ">
                                                                            <Run Text="{x:Bind Date, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                                                                            <Run Text="{x:Bind DayOfWeek}"/>
                                                                            <Run Text="{x:Bind PeriodName}"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Grid>

                                                                <!-- Position and Personnel Info -->
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <!-- Position -->
                                                                    <StackPanel Grid.Column="0" Spacing="2">
                                                                        <TextBlock Text="Âì®‰Ωç" 
                                                                                   FontSize="10" 
                                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                                        <TextBlock Text="{x:Bind PositionName}" 
                                                                                   FontSize="12"
                                                                                   FontWeight="SemiBold"/>
                                                                    </StackPanel>

                                                                    <!-- Personnel -->
                                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                                        <TextBlock Text="‰∫∫Âëò" 
                                                                                   FontSize="10" 
                                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                                        <TextBlock Text="{x:Bind PersonnelName}" 
                                                                                   FontSize="12"
                                                                                   FontWeight="SemiBold"/>
                                                                    </StackPanel>
                                                                </Grid>

                                                                <!-- Tags (Manual Assignment, Conflict) -->
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <Border Background="{ThemeResource AccentFillColorDefaultBrush}"
                                                                            CornerRadius="4"
                                                                            Padding="6,2"
                                                                            Visibility="{x:Bind IsManualAssignment, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <TextBlock Text="‚úã ÊâãÂä®"
                                                                                   FontSize="10"
                                                                                   Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                    <Border Background="{ThemeResource SystemFillColorCriticalBrush}"
                                                                            CornerRadius="4"
                                                                            Padding="6,2"
                                                                            Visibility="{x:Bind HasConflict, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <TextBlock Text="‚ö† ÂÜ≤Á™Å"
                                                                                   FontSize="10"
                                                                                   Foreground="White"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>

                                        <!-- Navigation Buttons -->
                                        <Grid Grid.Row="3" 
                                              Padding="0,8,0,0"
                                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                              BorderThickness="0,1,0,0"
                                              AutomationProperties.Name="ÂØºËà™ÊåâÈíÆÂå∫Âüü">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Previous Button -->
                                            <Button Grid.Column="0"
                                                    Content="‚óÄ ‰∏ä‰∏Ä‰∏™"
                                                    Command="{x:Bind ViewModel.NavigateToPreviousHighlightCommand}"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="0,8,4,0"
                                                    AutomationProperties.Name="‰∏ä‰∏Ä‰∏™ÊêúÁ¥¢ÁªìÊûú"
                                                    AutomationProperties.HelpText="Ë∑≥ËΩ¨Âà∞‰∏ä‰∏Ä‰∏™ÊêúÁ¥¢ÁªìÊûú"
                                                    ToolTipService.ToolTip="‰∏ä‰∏Ä‰∏™"/>

                                            <!-- Current Position Indicator -->
                                            <TextBlock Grid.Column="1"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Margin="8,8,8,0"
                                                       FontSize="14"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="ÂΩìÂâç‰ΩçÁΩÆÊåáÁ§∫Âô®"
                                                       AutomationProperties.LiveSetting="Polite">
                                                <Run Text="{x:Bind ViewModel.CurrentHighlightIndex, Mode=OneWay, Converter={StaticResource AddOneConverter}}"/>
                                                <Run Text="/"/>
                                                <Run Text="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay}"/>
                                            </TextBlock>

                                            <!-- Next Button -->
                                            <Button Grid.Column="2"
                                                    Content="‰∏ã‰∏Ä‰∏™ ‚ñ∂"
                                                    Command="{x:Bind ViewModel.NavigateToNextHighlightCommand}"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="4,8,0,0"
                                                    AutomationProperties.Name="‰∏ã‰∏Ä‰∏™ÊêúÁ¥¢ÁªìÊûú"
                                                    AutomationProperties.HelpText="Ë∑≥ËΩ¨Âà∞‰∏ã‰∏Ä‰∏™ÊêúÁ¥¢ÁªìÊûú"
                                                    ToolTipService.ToolTip="‰∏ã‰∏Ä‰∏™"/>
                                        </Grid>

                                        <!-- Empty State -->
                                        <StackPanel Grid.Row="2"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Spacing="12"
                                                    Visibility="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay, Converter={StaticResource ZeroToVisibilityConverter}}"
                                                    AutomationProperties.Name="Á©∫Áä∂ÊÄÅÊèêÁ§∫">
                                            <FontIcon Glyph="&#xE721;" 
                                                      FontSize="48" 
                                                      Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                            <TextBlock Text="Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÁè≠Ê¨°"
                                                       Style="{ThemeResource BodyTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                            <TextBlock Text="ËØ∑Â∞ùËØïË∞ÉÊï¥Á≠õÈÄâÊù°‰ª∂"
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </TabViewItem>

                                <!-- Conflict Management Tab -->
                                <TabViewItem Header="ÂÜ≤Á™ÅÁÆ°ÁêÜ"
                                             IsClosable="False"
                                             AutomationProperties.Name="ÂÜ≤Á™ÅÁÆ°ÁêÜÊ†áÁ≠æÈ°µ">
                                    <Grid Padding="0,12,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Conflict Panel Header -->
                                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
                                            <TextBlock Text="ÂÜ≤Á™ÅÁÆ°ÁêÜ" 
                                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                                       AutomationProperties.Name="ÂÜ≤Á™ÅÁÆ°ÁêÜÊ†áÈ¢ò"
                                                       AutomationProperties.HeadingLevel="Level2"/>
                                        </StackPanel>

                        <!-- Conflict Statistics Cards -->
                        <Grid Grid.Row="1" Margin="0,0,0,12" AutomationProperties.Name="ÂÜ≤Á™ÅÁªüËÆ°Âç°Áâá">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Hard Constraint Conflicts Card -->
                            <Border Grid.Row="0" Grid.Column="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource SystemFillColorCriticalBrush}" 
                                    BorderThickness="2" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="0,0,4,4"
                                    AutomationProperties.Name="Á°¨Á∫¶ÊùüÂÜ≤Á™ÅÁªüËÆ°Âç°Áâá">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="‚ö† Á°¨Á∫¶ÊùüÂÜ≤Á™Å" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="Á°¨Á∫¶ÊùüÂÜ≤Á™ÅÊ†áÁ≠æ"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.HardConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                               AutomationProperties.Name="Á°¨Á∫¶ÊùüÂÜ≤Á™ÅÊï∞Èáè"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Soft Constraint Conflicts Card -->
                            <Border Grid.Row="0" Grid.Column="1"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource SystemFillColorCautionBrush}" 
                                    BorderThickness="2" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="4,0,0,4"
                                    AutomationProperties.Name="ËΩØÁ∫¶ÊùüÂÜ≤Á™ÅÁªüËÆ°Âç°Áâá">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="‚ö† ËΩØÁ∫¶ÊùüÂÜ≤Á™Å" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="ËΩØÁ∫¶ÊùüÂÜ≤Á™ÅÊ†áÁ≠æ"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.SoftConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                               AutomationProperties.Name="ËΩØÁ∫¶ÊùüÂÜ≤Á™ÅÊï∞Èáè"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Unassigned Slots Card -->
                            <Border Grid.Row="1" Grid.Column="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="0,4,4,0"
                                    AutomationProperties.Name="Êú™ÂàÜÈÖçÊó∂ÊÆµÁªüËÆ°Âç°Áâá">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="‚Ñπ Êú™ÂàÜÈÖçÊó∂ÊÆµ" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="Êú™ÂàÜÈÖçÊó∂ÊÆµÊ†áÁ≠æ"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.UnassignedSlotCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               AutomationProperties.Name="Êú™ÂàÜÈÖçÊó∂ÊÆµÊï∞Èáè"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Ignored Conflicts Card -->
                            <Border Grid.Row="1" Grid.Column="1"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="4,4,0,0"
                                    AutomationProperties.Name="Â∑≤ÂøΩÁï•ÂÜ≤Á™ÅÁªüËÆ°Âç°Áâá">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="‚úì Â∑≤ÂøΩÁï•" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="Â∑≤ÂøΩÁï•ÂÜ≤Á™ÅÊ†áÁ≠æ"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.IgnoredConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               AutomationProperties.Name="Â∑≤ÂøΩÁï•ÂÜ≤Á™ÅÊï∞Èáè"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Filter and Sort Controls -->
                        <StackPanel Grid.Row="2" Spacing="8" Margin="0,0,0,12" AutomationProperties.Name="Á≠õÈÄâÂíåÊéíÂ∫èÊéß‰ª∂">
                            <!-- Type and Severity Filters -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Type Filter -->
                                <ComboBox Grid.Column="0"
                                          Header="Á±ªÂûã"
                                          SelectedValue="{x:Bind ViewModel.ConflictTypeFilter, Mode=TwoWay}"
                                          PlaceholderText="ÂÖ®ÈÉ®"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="ÂÜ≤Á™ÅÁ±ªÂûãÁ≠õÈÄâÂô®"
                                          AutomationProperties.HelpText="ÊåâÂÜ≤Á™ÅÁ±ªÂûãÁ≠õÈÄâ">
                                    <x:String>ÂÖ®ÈÉ®</x:String>
                                    <x:String>Á°¨Á∫¶Êùü</x:String>
                                    <x:String>ËΩØÁ∫¶Êùü</x:String>
                                    <x:String>‰ø°ÊÅØ</x:String>
                                    <x:String>Êú™ÂàÜÈÖç</x:String>
                                </ComboBox>

                                <!-- Severity Filter -->
                                <ComboBox Grid.Column="1"
                                          Header="‰∏•ÈáçÁ®ãÂ∫¶"
                                          SelectedValue="{x:Bind ViewModel.ConflictSeverityFilter, Mode=TwoWay}"
                                          PlaceholderText="ÂÖ®ÈÉ®"
                                          HorizontalAlignment="Stretch"
                                          Margin="4,0,0,0"
                                          AutomationProperties.Name="‰∏•ÈáçÁ®ãÂ∫¶Á≠õÈÄâÂô®"
                                          AutomationProperties.HelpText="Êåâ‰∏•ÈáçÁ®ãÂ∫¶Á≠õÈÄâ">
                                    <x:String>ÂÖ®ÈÉ®</x:String>
                                    <x:String>5 - ÊúÄÈ´ò</x:String>
                                    <x:String>4 - È´ò</x:String>
                                    <x:String>3 - ‰∏≠</x:String>
                                    <x:String>2 - ‰Ωé</x:String>
                                    <x:String>1 - ÊúÄ‰Ωé</x:String>
                                </ComboBox>
                            </Grid>

                            <!-- Sort and Search -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Sort By -->
                                <ComboBox Grid.Column="0"
                                          Header="ÊéíÂ∫è"
                                          SelectedValue="{x:Bind ViewModel.ConflictSortBy, Mode=TwoWay}"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="ÊéíÂ∫èÈÄâÊã©Âô®"
                                          AutomationProperties.HelpText="ÈÄâÊã©ÊéíÂ∫èÊñπÂºè">
                                    <x:String>ÊåâÁ±ªÂûã</x:String>
                                    <x:String>ÊåâÊó•Êúü</x:String>
                                    <x:String>Êåâ‰∏•ÈáçÁ®ãÂ∫¶</x:String>
                                </ComboBox>

                                <!-- Search Box -->
                                <TextBox Grid.Column="1"
                                         Header="ÊêúÁ¥¢"
                                         Text="{x:Bind ViewModel.ConflictSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="‰∫∫Âëò/Âì®‰Ωç..."
                                         Margin="4,0,0,0"
                                         AutomationProperties.Name="ÂÜ≤Á™ÅÊêúÁ¥¢Ê°Ü"
                                         AutomationProperties.HelpText="Êåâ‰∫∫ÂëòÊàñÂì®‰ΩçÂêçÁß∞ÊêúÁ¥¢ÂÜ≤Á™Å"/>
                            </Grid>
                        </StackPanel>

                        <!-- Statistics Panel (Collapsible) -->
                        <Expander Grid.Row="3"
                                  Header="ÁªüËÆ°‰ø°ÊÅØ"
                                  IsExpanded="False"
                                  Margin="0,0,0,12"
                                  AutomationProperties.Name="ÁªüËÆ°‰ø°ÊÅØÈù¢Êùø"
                                  AutomationProperties.HeadingLevel="Level2">
                            <StackPanel Spacing="12" Margin="0,8,0,0">
                                <!-- Summary Stats -->
                                <Grid AutomationProperties.Name="ÁªüËÆ°ÊëòË¶Å">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Border x:Name="TotalAssignmentsCard"
                                            Grid.Column="0" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="ÊÄªÂàÜÈÖçÊï∞ÁªüËÆ°Âç°Áâá"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="ÊÄªÂàÜÈÖçÊï∞" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="ÊÄªÂàÜÈÖçÊï∞Ê†áÁ≠æ"/>
                                            <TextBlock Text="{x:Bind ViewModel.Statistics.TotalAssignments, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="ÊÄªÂàÜÈÖçÊï∞ÂÄº"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>

                                    <Border x:Name="PersonnelCountCard"
                                            Grid.Column="1" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="ÂèÇ‰∏é‰∫∫ÂëòÊï∞ÁªüËÆ°Âç°Áâá"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="ÂèÇ‰∏é‰∫∫ÂëòÊï∞" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="ÂèÇ‰∏é‰∫∫ÂëòÊï∞Ê†áÁ≠æ"/>
                                            <TextBlock Text="{x:Bind ViewModel.PersonnelWorkloads.Count, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="ÂèÇ‰∏é‰∫∫ÂëòÊï∞ÂÄº"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>

                                    <Border x:Name="PositionCountCard"
                                            Grid.Column="2" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="ÂèÇ‰∏éÂì®‰ΩçÊï∞ÁªüËÆ°Âç°Áâá"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="ÂèÇ‰∏éÂì®‰ΩçÊï∞" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="ÂèÇ‰∏éÂì®‰ΩçÊï∞Ê†áÁ≠æ"/>
                                            <TextBlock Text="{x:Bind ViewModel.PositionCoverages.Count, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="ÂèÇ‰∏éÂì®‰ΩçÊï∞ÂÄº"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <!-- Personnel Workload Table -->
                                <StackPanel>
                                    <TextBlock Text="‰∫∫ÂëòÂ∑•‰ΩúÈáè" 
                                               FontWeight="SemiBold" 
                                               Margin="0,8,0,4"
                                               AutomationProperties.Name="‰∫∫ÂëòÂ∑•‰ΩúÈáèÁªüËÆ°Ê†áÈ¢ò"
                                               AutomationProperties.HeadingLevel="Level3"/>
                                    <ListView ItemsSource="{x:Bind ViewModel.PersonnelWorkloads, Mode=OneWay}" 
                                              MaxHeight="200" 
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              AutomationProperties.Name="‰∫∫ÂëòÂ∑•‰ΩúÈáèÁªüËÆ°Ë°®"
                                              AutomationProperties.LandmarkType="Custom">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding PersonnelName}" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding TotalShifts}" Margin="16,0" VerticalAlignment="Center"/>
                                                    <ProgressBar Grid.Column="2" Width="100" Value="{Binding TotalShifts}" Maximum="20" Margin="8,0"/>
                                                    <TextBlock Grid.Column="3"
                                                               Text="{Binding DayNightSummary}"
                                                               Margin="16,0,0,0"
                                                               VerticalAlignment="Center"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>

                                <!-- Position Coverage Table -->
                                <StackPanel>
                                    <TextBlock Text="Âì®‰ΩçË¶ÜÁõñÁéá" 
                                               FontWeight="SemiBold" 
                                               Margin="0,8,0,4"
                                               AutomationProperties.Name="Âì®‰ΩçË¶ÜÁõñÁéáÁªüËÆ°Ê†áÈ¢ò"
                                               AutomationProperties.HeadingLevel="Level3"/>
                                    <ListView ItemsSource="{x:Bind ViewModel.PositionCoverages, Mode=OneWay}" 
                                              MaxHeight="200" 
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              AutomationProperties.Name="Âì®‰ΩçË¶ÜÁõñÁéáÁªüËÆ°Ë°®"
                                              AutomationProperties.LandmarkType="Custom">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding PositionName}" VerticalAlignment="Center"/>
                                                    <ProgressBar Grid.Column="1" Width="100" Value="{Binding CoverageRate}" Maximum="1" Margin="8,0"/>
                                                    <TextBlock Grid.Column="2"
                                                               Text="{Binding CoverageRateDisplay}"
                                                               Margin="16,0,0,0"
                                                               VerticalAlignment="Center"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <!-- Conflict List with Grouping -->
                        <ScrollViewer Grid.Row="4" 
                                      Margin="0,0,0,0"
                                      AutomationProperties.Name="ÂÜ≤Á™ÅÂàóË°®Âå∫Âüü">
                            <ItemsControl x:Name="ConflictListView"
                                          ItemsSource="{x:Bind ViewModel.FilteredConflicts, Mode=OneWay}"
                                          AutomationProperties.Name="ÂÜ≤Á™ÅÂàóË°®"
                                          AutomationProperties.LandmarkType="Custom"
                                          AutomationProperties.LiveSetting="Polite">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="dto:ConflictDto">
                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="12"
                                                Margin="0,0,0,8"
                                                AutomationProperties.Name="{x:Bind Message}">
                                            <StackPanel Spacing="8">
                                                <!-- Conflict Header -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Icon based on type -->
                                                    <FontIcon Grid.Column="0"
                                                              Glyph="&#xE7BA;"
                                                              FontSize="16"
                                                              Margin="0,0,8,0"
                                                              VerticalAlignment="Top"
                                                              Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>

                                                    <!-- Conflict Type and Description -->
                                                    <StackPanel Grid.Column="1" Spacing="4">
                                                        <TextBlock Text="{x:Bind SubType, Converter={StaticResource ConflictSubTypeToTextConverter}}"
                                                                   FontWeight="SemiBold"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="ÂÜ≤Á™ÅÁ±ªÂûã"/>
                                                        <TextBlock Text="{x:Bind Message}"
                                                                   FontSize="12"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="ÂÜ≤Á™ÅÊèèËø∞"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Conflict Details -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Personnel Info -->
                                                    <StackPanel Grid.Column="0" Spacing="2">
                                                        <TextBlock Text="‰∫∫Âëò" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PersonnelName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>

                                                    <!-- Position Info -->
                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                        <TextBlock Text="Âì®‰Ωç" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PositionName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Date and Time Info -->
                                                <StackPanel Spacing="2">
                                                    <TextBlock Text="Êó∂Èó¥" 
                                                               FontSize="10" 
                                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                    <TextBlock FontSize="12">
                                                        <Run Text="{x:Bind StartTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd HH:mm', FallbackValue='-'}"/>
                                                        <Run Text=" - "/>
                                                        <Run Text="{x:Bind EndTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='HH:mm', FallbackValue='-'}"/>
                                                    </TextBlock>
                                                </StackPanel>

                                                <!-- Action Buttons -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Button Grid.Column="0"
                                                            Content="ÂÆö‰Ωç" 
                                                            Tag="{x:Bind}"
                                                            Click="LocateConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="0,0,4,0"
                                                            AutomationProperties.Name="ÂÆö‰ΩçÂÜ≤Á™Å"
                                                            AutomationProperties.HelpText="Âú®Ë°®Ê†º‰∏≠ÂÆö‰ΩçÂπ∂È´ò‰∫ÆÊòæÁ§∫Ê≠§ÂÜ≤Á™Å"
                                                            ToolTipService.ToolTip="ÂÆö‰ΩçÂÜ≤Á™Å"/>

                                                    <Button Grid.Column="1"
                                                            Content="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='ÂèñÊ∂àÂøΩÁï•|ÂøΩÁï•'}"
                                                            Tag="{x:Bind}"
                                                            Click="IgnoreConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,4,0"
                                                            AutomationProperties.Name="ÂøΩÁï•ÊàñÂèñÊ∂àÂøΩÁï•ÂÜ≤Á™Å"
                                                            AutomationProperties.HelpText="Â∞ÜÊ≠§ÂÜ≤Á™ÅÊ†áËÆ∞‰∏∫Â∑≤ÂøΩÁï•ÊàñÂèñÊ∂àÂøΩÁï•"
                                                            ToolTipService.ToolTip="ÂøΩÁï•/ÂèñÊ∂àÂøΩÁï•"/>

                                                    <Button Grid.Column="2"
                                                            Content="‰øÆÂ§ç" 
                                                            Tag="{x:Bind}"
                                                            Click="FixConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,0,0"
                                                            IsEnabled="{x:Bind IsFixable}"
                                                            AutomationProperties.Name="‰øÆÂ§çÂÜ≤Á™Å"
                                                            AutomationProperties.HelpText="ÊâìÂºÄ‰øÆÂ§çÂØπËØùÊ°Ü‰ª•Ëß£ÂÜ≥Ê≠§ÂÜ≤Á™Å"
                                                            ToolTipService.ToolTip="‰øÆÂ§çÂÜ≤Á™Å"/>
                                                </Grid>

                                                <!-- Ignored Badge -->
                                                <Border Background="{ThemeResource SystemFillColorSuccessBrush}"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Left"
                                                        Visibility="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="‚úì Â∑≤ÂøΩÁï•"
                                                               FontSize="10"
                                                               Foreground="White"
                                                               FontWeight="SemiBold"/>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Bottom Action Buttons -->
                        <StackPanel Grid.Row="5" 
                                    Orientation="Vertical" 
                                    Spacing="8" 
                                    Margin="0,12,0,0"
                                    AutomationProperties.Name="ÂÜ≤Á™ÅÊìç‰ΩúÊåâÈíÆ">
                            <Button Content="ÂÖ®ÈÉ®ÂøΩÁï•ËΩØÁ∫¶Êùü"
                                    Command="{x:Bind ViewModel.IgnoreAllSoftConflictsCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="ÂÖ®ÈÉ®ÂøΩÁï•ËΩØÁ∫¶ÊùüÂÜ≤Á™Å"
                                    AutomationProperties.HelpText="Â∞ÜÊâÄÊúâËΩØÁ∫¶ÊùüÂÜ≤Á™ÅÊ†áËÆ∞‰∏∫Â∑≤ÂøΩÁï•"
                                    ToolTipService.ToolTip="ÂøΩÁï•ÊâÄÊúâËΩØÁ∫¶ÊùüÂÜ≤Á™Å"/>

                            <Button Content="ÂØºÂá∫ÂÜ≤Á™ÅÊä•Âëä"
                                    Command="{x:Bind ViewModel.ExportConflictReportCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="ÂØºÂá∫ÂÜ≤Á™ÅÊä•Âëä"
                                    AutomationProperties.HelpText="ÂØºÂá∫ÂÜ≤Á™ÅÊä•Âëä‰∏∫ExcelÊàñPDFÊñá‰ª∂"
                                    ToolTipService.ToolTip="ÂØºÂá∫ÂÜ≤Á™ÅÊä•Âëä"/>

                            <Button Content="ÂÜ≤Á™ÅË∂ãÂäø"
                                    Command="{x:Bind ViewModel.ShowConflictTrendCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="Êü•ÁúãÂÜ≤Á™ÅË∂ãÂäø"
                                    AutomationProperties.HelpText="Êü•ÁúãÂÜ≤Á™ÅË∂ãÂäøÂàÜÊûêÂíåÁªüËÆ°"
                                    ToolTipService.ToolTip="Êü•ÁúãÂÜ≤Á™ÅË∂ãÂäø"/>
                        </StackPanel>
                                    </Grid>
                                </TabViewItem>
                            </TabView.TabItems>
                        </TabView>
                    </Grid>
                </SplitView.Pane>
                <SplitView.Content>
                    <Grid Padding="24,0,24,0"
                          AutomationProperties.Name="‰∏ªÂÜÖÂÆπÂå∫Âüü"
                          AutomationProperties.LandmarkType="Main">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Grid View -->
                        <controls:ScheduleGridControl
                            x:Name="ScheduleGrid"
                            Grid.Row="0"
                            GridData="{x:Bind ViewModel.GridData, Mode=OneWay}"
                            HighlightedCellKeys="{x:Bind ViewModel.HighlightedCellKeys, Mode=OneWay}"
                            FocusedShiftId="{x:Bind ViewModel.FocusedShiftId, Mode=OneWay}"
                            Visibility="{x:Bind GridRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="ÁΩëÊ†ºËßÜÂõæÊéíÁè≠Ë°®"
                            AutomationProperties.LandmarkType="Main"/>

                        <!-- List View -->
                        <ListView x:Name="ShiftListView"
                                  Grid.Row="0"
                                  ItemsSource="{x:Bind ViewModel.ShiftList, Mode=OneWay}"
                                  Visibility="{x:Bind ListRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  AutomationProperties.Name="ÂàóË°®ËßÜÂõæÁè≠Ê¨°ÂàóË°®"
                                  AutomationProperties.LandmarkType="Main">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="dto:ShiftListItem">
                                    <Grid Padding="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Date -->
                                        <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                            <TextBlock Text="{x:Bind Date, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='MM-dd'}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{x:Bind DateTimeDescription}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>

                                        <!-- Personnel and Position -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{x:Bind PersonnelName}" FontSize="16" FontWeight="SemiBold"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                                <TextBlock Text="{x:Bind TimeSlot}" FontSize="12"/>
                                                <TextBlock Text="{x:Bind PositionName}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                <!-- Tags -->
                                                <Border Background="{ThemeResource AccentBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind IsManualAssignment, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="ÊâãÂä®" FontSize="10" Foreground="White"/>
                                                </Border>
                                                <Border Background="{ThemeResource WarningBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind HasConflict, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="ÂÜ≤Á™Å" FontSize="10" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                            <Button Content="ËØ¶ÊÉÖ" 
                                                    Tag="{x:Bind}"
                                                    Click="ViewShiftDetailsButton_Click"
                                                    AutomationProperties.Name="Êü•ÁúãÁè≠Ê¨°ËØ¶ÊÉÖ"
                                                    AutomationProperties.HelpText="Êü•ÁúãÊ≠§Áè≠Ê¨°ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ"
                                                    ToolTipService.ToolTip="Êü•ÁúãËØ¶ÊÉÖ"/>
                                            <Button Content="ÁºñËæë" 
                                                    Tag="{x:Bind}"
                                                    Click="EditShiftButton_Click"
                                                    AutomationProperties.Name="ÁºñËæëÁè≠Ê¨°ÂàÜÈÖç"
                                                    AutomationProperties.HelpText="‰øÆÊîπÊ≠§Áè≠Ê¨°ÁöÑ‰∫∫ÂëòÂàÜÈÖç"
                                                    ToolTipService.ToolTip="ÁºñËæëÂàÜÈÖç"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!-- By Position View -->
                        <Grid Grid.Row="0"
                              Visibility="{x:Bind ByPositionRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Âì®‰ΩçÈÄâÊã©Âô® -->
                            <Grid Grid.Row="0" 
                                  Margin="0,0,0,12"
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  Padding="16"
                                  AutomationProperties.Name="Âì®‰ΩçÈÄâÊã©Âå∫Âüü">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="ÈÄâÊã©Âì®‰Ωç:"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           FontWeight="SemiBold"
                                           AutomationProperties.Name="Âì®‰ΩçÈÄâÊã©Ê†áÁ≠æ"/>

                                <AutoSuggestBox Grid.Column="1"
                                                x:Name="PositionSelectorAutoSuggestBox"
                                                PlaceholderText="ËæìÂÖ•Âì®‰ΩçÂêçÁß∞ÊàñÊãºÈü≥È¶ñÂ≠óÊØçÊêúÁ¥¢..."
                                                ItemsSource="{x:Bind ViewModel.PositionSelectorSuggestions, Mode=OneWay}"
                                                Text="{x:Bind ViewModel.PositionSelectorSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Stretch"
                                                MinWidth="300"
                                                QueryIcon="Find"
                                                TextChanged="PositionSelectorAutoSuggestBox_TextChanged"
                                                SuggestionChosen="PositionSelectorAutoSuggestBox_SuggestionChosen"
                                                QuerySubmitted="PositionSelectorAutoSuggestBox_QuerySubmitted"
                                                GotFocus="PositionSelectorAutoSuggestBox_GotFocus"
                                                AutomationProperties.Name="Âì®‰ΩçÈÄâÊã©ÊêúÁ¥¢Ê°Ü"
                                                AutomationProperties.HelpText="ËæìÂÖ•Âì®‰ΩçÂêçÁß∞ÊàñÊãºÈü≥È¶ñÂ≠óÊØçÊêúÁ¥¢Âì®‰ΩçÔºåÊîØÊåÅÊ®°Á≥äÂåπÈÖç"
                                                AutomationProperties.LiveSetting="Polite">
                                    <AutoSuggestBox.ItemTemplate>
                                        <DataTemplate x:DataType="dto:PositionScheduleData">
                                            <Grid Padding="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{x:Bind PositionName}"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1"
                                                            Orientation="Horizontal"
                                                            Spacing="4"
                                                            VerticalAlignment="Center">
                                                    <TextBlock Text="Áè≠Ê¨°:"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                    <TextBlock Text="{x:Bind TotalShifts}"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </AutoSuggestBox.ItemTemplate>
                                </AutoSuggestBox>
                            </Grid>

                            <!-- Âì®‰ΩçÊéíÁè≠ËØ¶ÊÉÖÊéß‰ª∂ -->
                            <controls:PositionScheduleControl
                                x:Name="PositionScheduleControl"
                                Grid.Row="1"
                                ScheduleData="{x:Bind ViewModel.SelectedPositionSchedule, Mode=OneWay}"
                                HighlightedCellKeys="{x:Bind ViewModel.HighlightedCellKeys, Mode=OneWay}"
                                FocusedShiftId="{x:Bind ViewModel.FocusedShiftId, Mode=OneWay}"
                                AutomationProperties.Name="Âì®‰ΩçËßÜÂõæÊéíÁè≠Ë°®"
                                AutomationProperties.LandmarkType="Main"/>
                        </Grid>

                        <!-- By Personnel View -->
                        <Grid Grid.Row="0"
                              Visibility="{x:Bind ByPersonnelRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- ‰∫∫ÂëòÈÄâÊã©Âô® -->
                            <Grid Grid.Row="0" 
                                  Margin="0,0,0,12"
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  Padding="16"
                                  AutomationProperties.Name="‰∫∫ÂëòÈÄâÊã©Âå∫Âüü">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="ÈÄâÊã©‰∫∫Âëò:"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           FontWeight="SemiBold"
                                           AutomationProperties.Name="‰∫∫ÂëòÈÄâÊã©Ê†áÁ≠æ"/>

                                <AutoSuggestBox Grid.Column="1"
                                                x:Name="PersonnelSelectorAutoSuggestBox"
                                                PlaceholderText="ËæìÂÖ•ÂßìÂêçÊàñÊãºÈü≥È¶ñÂ≠óÊØçÊêúÁ¥¢..."
                                                ItemsSource="{x:Bind ViewModel.PersonnelSelectorSuggestions, Mode=OneWay}"
                                                Text="{x:Bind ViewModel.PersonnelSelectorSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Stretch"
                                                MinWidth="300"
                                                QueryIcon="Find"
                                                TextChanged="PersonnelSelectorAutoSuggestBox_TextChanged"
                                                SuggestionChosen="PersonnelSelectorAutoSuggestBox_SuggestionChosen"
                                                QuerySubmitted="PersonnelSelectorAutoSuggestBox_QuerySubmitted"
                                                GotFocus="PersonnelSelectorAutoSuggestBox_GotFocus"
                                                AutomationProperties.Name="‰∫∫ÂëòÈÄâÊã©ÊêúÁ¥¢Ê°Ü"
                                                AutomationProperties.HelpText="ËæìÂÖ•ÂßìÂêçÊàñÊãºÈü≥È¶ñÂ≠óÊØçÊêúÁ¥¢‰∫∫ÂëòÔºåÊîØÊåÅÊ®°Á≥äÂåπÈÖç"
                                                AutomationProperties.LiveSetting="Polite">
                                    <AutoSuggestBox.ItemTemplate>
                                        <DataTemplate x:DataType="dto:PersonnelScheduleData">
                                            <Grid Padding="8"
                                                  AutomationProperties.Name="{x:Bind PersonnelName}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{x:Bind PersonnelName}"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1"
                                                            Orientation="Horizontal"
                                                            Spacing="8">
                                                    <TextBlock Text="{x:Bind Workload.TotalShifts}"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Text="Áè≠Ê¨°"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </AutoSuggestBox.ItemTemplate>
                                </AutoSuggestBox>
                            </Grid>

                            <!-- ‰∫∫ÂëòÊéíÁè≠ËØ¶ÊÉÖÊéß‰ª∂ -->
                            <controls:PersonnelScheduleControl
                                Grid.Row="1"
                                ScheduleData="{x:Bind ViewModel.SelectedPersonnelSchedule, Mode=OneWay}"
                                AutomationProperties.Name="‰∫∫ÂëòËßÜÂõæÊéíÁè≠‰ø°ÊÅØ"
                                AutomationProperties.LandmarkType="Main"/>
                        </Grid>
                    </Grid>
                </SplitView.Content>
            </SplitView>

            <!-- Bottom Action Bar -->
            <Grid Grid.Row="2" 
                  Padding="24" 
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  BorderThickness="0,1,0,0" 
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  AutomationProperties.Name="Â∫ïÈÉ®Êìç‰ΩúÊ†è"
                  AutomationProperties.LandmarkType="Navigation">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Unsaved Changes Warning -->
                <TextBlock Grid.Column="0"
                           Text="ÊÇ®ÊúâÊú™‰øùÂ≠òÁöÑÊõ¥Êîπ"
                           Foreground="{ThemeResource WarningBrush}"
                           VerticalAlignment="Center"
                           Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                           AutomationProperties.Name="Êú™‰øùÂ≠òÊõ¥ÊîπË≠¶Âëä"
                           AutomationProperties.LiveSetting="Assertive"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <!-- Unsaved Changes Actions -->
                    <Button Content="Êí§ÈîÄÊõ¥Êîπ"
                            Command="{x:Bind ViewModel.DiscardChangesCommand}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="Êí§ÈîÄÊõ¥Êîπ"
                            AutomationProperties.HelpText="Êí§ÈîÄÊâÄÊúâÊú™‰øùÂ≠òÁöÑÊõ¥Êîπ"
                            ToolTipService.ToolTip="Êí§ÈîÄÊõ¥Êîπ"/>
                    <Button Content="‰øùÂ≠òÊõ¥Êîπ"
                            Command="{x:Bind ViewModel.SaveChangesCommand}"
                            Style="{ThemeResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="‰øùÂ≠òÊõ¥Êîπ"
                            AutomationProperties.HelpText="‰øùÂ≠òÊâÄÊúâÊõ¥ÊîπÂà∞Êï∞ÊçÆÂ∫ì"
                            ToolTipService.ToolTip="‰øùÂ≠òÊõ¥Êîπ (Ctrl+S)"/>

                    <!-- Primary Actions -->
                    <Button Content="ËøîÂõû" 
                            Command="{x:Bind ViewModel.BackCommand}"
                            AutomationProperties.Name="ËøîÂõû"
                            AutomationProperties.HelpText="ËøîÂõû‰∏ä‰∏ÄÈ°µ"
                            ToolTipService.ToolTip="ËøîÂõû"/>
                    <Button Content="ÈáçÊñ∞ÊéíÁè≠" 
                            Command="{x:Bind ViewModel.RescheduleCommand}"
                            AutomationProperties.Name="ÈáçÊñ∞ÊéíÁè≠"
                            AutomationProperties.HelpText="ÈáçÊñ∞ÁîüÊàêÊéíÁè≠ÊñπÊ°à"
                            ToolTipService.ToolTip="ÈáçÊñ∞ÊéíÁè≠"/>
                    <Button Content="Á°ÆËÆ§ÊéíÁè≠"
                            Style="{ThemeResource AccentButtonStyle}"
                            Command="{x:Bind ViewModel.ConfirmCommand}"
                            IsEnabled="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToBoolConverter}, ConverterParameter='invert'}"
                            AutomationProperties.Name="Á°ÆËÆ§ÊéíÁè≠"
                            AutomationProperties.HelpText="Á°ÆËÆ§Âπ∂Â∫îÁî®Ê≠§ÊéíÁè≠ÊñπÊ°à"
                            ToolTipService.ToolTip="Á°ÆËÆ§ÊéíÁè≠"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Loading Indicator -->
        <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" Width="60" Height="60"
                      HorizontalAlignment="Center" VerticalAlignment="Center"/>

        <!-- Empty State -->
        <TextBlock Text="Êú™Âä†ËΩΩÊéíÁè≠Êï∞ÊçÆ"
                   Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter='invert', Mode=OneWay}"
                   HorizontalAlignment="Center" VerticalAlignment="Center" Style="{ThemeResource SubtitleTextBlockStyle}"/>
    </Grid>
</Page>
