<Page
    x:Class="AutoScheduling3.Views.Scheduling.ScheduleResultPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:AutoScheduling3.ViewModels.Scheduling"
    xmlns:controls="using:AutoScheduling3.Controls"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:dto="using:AutoScheduling3.DTOs"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    d:DataContext="{d:DesignInstance Type=viewmodels:ScheduleResultViewModel, IsDesignTimeCreatable=True}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:BoolToTextConverter x:Key="BoolToTextConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:DateTimeFormatConverter x:Key="DateTimeFormatConverter"/>
        <converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        <converters:AddOneConverter x:Key="AddOneConverter"/>
        <converters:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <converters:BoolToGlyphConverter x:Key="BoolToGlyphConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:ConflictSubTypeToTextConverter x:Key="ConflictSubTypeToTextConverter"/>
    </Page.Resources>

    <!-- é”®ç›˜å¿«æ·é”® -->
    <Page.KeyboardAccelerators>
        <!-- Ctrl+F: æ‰“å¼€ç­›é€‰ -->
        <KeyboardAccelerator Key="F" Modifiers="Control" Invoked="FilterAccelerator_Invoked"/>
        <!-- Ctrl+E: å¯¼å‡º -->
        <KeyboardAccelerator Key="E" Modifiers="Control" Invoked="ExportAccelerator_Invoked"/>
        <!-- Ctrl+S: ä¿å­˜æ›´æ”¹ -->
        <KeyboardAccelerator Key="S" Modifiers="Control" Invoked="SaveAccelerator_Invoked"/>
        <!-- Esc: å…³é—­å†²çªé¢æ¿ -->
        <KeyboardAccelerator Key="Escape" Invoked="EscapeAccelerator_Invoked"/>
    </Page.KeyboardAccelerators>

    <Grid>
        <!-- Main content visible when Schedule not null -->
        <Grid Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header and Toolbar -->
            <StackPanel Grid.Row="0" Margin="24,24,24,12" Spacing="12">
                <!-- Title Section -->
                <StackPanel AutomationProperties.Name="æŽ’ç­ç»“æžœæ ‡é¢˜åŒºåŸŸ" AutomationProperties.HeadingLevel="Level1">
                    <!-- æ ‡é¢˜å’ŒçŠ¶æ€æ ‡è¯† -->
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <TextBlock Text="{x:Bind ViewModel.Schedule.Title, Mode=OneWay, FallbackValue='æŽ’ç­ç»“æžœ'}" 
                                   Style="{ThemeResource TitleTextBlockStyle}"
                                   AutomationProperties.Name="æŽ’ç­æ ‡é¢˜"
                                   AutomationProperties.HeadingLevel="Level1"/>
                        <!-- è‰ç¨¿/åŽ†å²æ ‡è¯† -->
                        <Border VerticalAlignment="Center"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Visibility="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter='invert'}">
                            <TextBlock Text="è‰ç¨¿" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                       AutomationProperties.Name="è‰ç¨¿æ ‡è¯†"/>
                        </Border>
                        <Border VerticalAlignment="Center"
                                Background="{ThemeResource SystemFillColorSuccessBrush}"
                                CornerRadius="4"
                                Padding="8,4"
                                Visibility="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                            <TextBlock Text="å·²ç¡®è®¤" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="White"
                                       AutomationProperties.Name="å·²ç¡®è®¤æ ‡è¯†"/>
                        </Border>
                    </StackPanel>
                    <!-- æ—¥æœŸèŒƒå›´ -->
                    <TextBlock Style="{ThemeResource BodyTextBlockStyle}" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               AutomationProperties.Name="æŽ’ç­æ—¥æœŸèŒƒå›´">
                        <Run Text="{x:Bind ViewModel.Schedule.StartDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                        <Run Text=" è‡³ "/>
                        <Run Text="{x:Bind ViewModel.Schedule.EndDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                    </TextBlock>
                </StackPanel>

                <!-- View Mode and Actions Toolbar -->
                <CommandBar Background="Transparent" 
                            DefaultLabelPosition="Right" 
                            HorizontalAlignment="Stretch"
                            AutomationProperties.Name="è§†å›¾æ¨¡å¼å’Œæ“ä½œå·¥å…·æ "
                            AutomationProperties.LandmarkType="Navigation">
                    <CommandBar.Content>
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <!-- View Mode Selector -->
                            <StackPanel Orientation="Horizontal" 
                                        Spacing="8" 
                                        AutomationProperties.Name="è§†å›¾æ¨¡å¼é€‰æ‹©"
                                        AutomationProperties.LandmarkType="Navigation">
                                <RadioButton x:Name="GridRadioButton" 
                                             Content="ç½‘æ ¼" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='Grid'}"
                                             AutomationProperties.Name="ç½‘æ ¼è§†å›¾æ¨¡å¼"
                                             AutomationProperties.HelpText="ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæŽ’ç­ç»“æžœï¼Œè¡Œä¸ºæ—¥æœŸåŠ æ—¶æ®µï¼Œåˆ—ä¸ºå“¨ä½"
                                             ToolTipService.ToolTip="ç½‘æ ¼è§†å›¾"/>
                                <RadioButton x:Name="ListRadioButton" 
                                             Content="åˆ—è¡¨" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='List'}"
                                             AutomationProperties.Name="åˆ—è¡¨è§†å›¾æ¨¡å¼"
                                             AutomationProperties.HelpText="ä»¥åˆ—è¡¨å½¢å¼å±•ç¤ºæ‰€æœ‰ç­æ¬¡åˆ†é…"
                                             ToolTipService.ToolTip="åˆ—è¡¨è§†å›¾"/>
                                <RadioButton x:Name="ByPersonnelRadioButton" 
                                             Content="æŒ‰äººå‘˜" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='ByPersonnel'}"
                                             AutomationProperties.Name="äººå‘˜è§†å›¾æ¨¡å¼"
                                             AutomationProperties.HelpText="æŒ‰äººå‘˜åˆ†ç»„å±•ç¤ºæ¯ä¸ªäººçš„ç­æ¬¡å®‰æŽ’"
                                             ToolTipService.ToolTip="äººå‘˜è§†å›¾"/>
                                <RadioButton x:Name="ByPositionRadioButton" 
                                             Content="æŒ‰å“¨ä½" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter='ByPosition'}"
                                             AutomationProperties.Name="å“¨ä½è§†å›¾æ¨¡å¼"
                                             AutomationProperties.HelpText="æŒ‰å“¨ä½åˆ†åˆ«å±•ç¤ºæŽ’ç­è¡¨ï¼Œæ¯ä¸ªå“¨ä½ä¸€å¼ è¡¨"
                                             ToolTipService.ToolTip="å“¨ä½è§†å›¾"/>
                            </StackPanel>
                        </StackPanel>
                    </CommandBar.Content>
                    <AppBarButton Icon="Save" 
                                  Label="å¯¼å‡º" 
                                  Command="{x:Bind ViewModel.ExportExcelCommand}"
                                  AutomationProperties.Name="å¯¼å‡ºæŽ’ç­è¡¨"
                                  AutomationProperties.HelpText="å¯¼å‡ºæŽ’ç­ç»“æžœä¸ºExcelã€CSVæˆ–PDFæ–‡ä»¶"
                                  ToolTipService.ToolTip="å¯¼å‡º (Ctrl+E)"/>
                    <AppBarButton x:Name="FullScreenButton" 
                                  Icon="FullScreen" 
                                  Label="å…¨å±" 
                                  Command="{x:Bind ViewModel.ToggleFullScreenCommand}"
                                  AutomationProperties.Name="å…¨å±æŸ¥çœ‹"
                                  AutomationProperties.HelpText="åœ¨å…¨å±æ¨¡å¼ä¸‹æŸ¥çœ‹æŽ’ç­è¡¨æ ¼"
                                  ToolTipService.ToolTip="å…¨å±æŸ¥çœ‹"/>
                    <AppBarButton x:Name="CompareButton" 
                                  Icon="TwoPage" 
                                  Label="æ¯”è¾ƒ" 
                                  Command="{x:Bind ViewModel.CompareSchedulesCommand}"
                                  AutomationProperties.Name="æ¯”è¾ƒæŽ’ç­"
                                  AutomationProperties.HelpText="ä¸ŽåŽ†å²æŽ’ç­æ–¹æ¡ˆè¿›è¡Œæ¯”è¾ƒ"
                                  ToolTipService.ToolTip="æ¯”è¾ƒæŽ’ç­"/>
                    <AppBarToggleButton Icon="Find" 
                                        Label="æœç´¢" 
                                        IsChecked="{x:Bind ViewModel.IsSearchPaneOpen, Mode=TwoWay}"
                                        AutomationProperties.Name="æœç´¢é¢æ¿å¼€å…³"
                                        AutomationProperties.HelpText="æ˜¾ç¤ºæˆ–éšè—æœç´¢ç­›é€‰é¢æ¿"
                                        ToolTipService.ToolTip="æœç´¢ç­›é€‰ (Ctrl+F)"/>
                    <AppBarToggleButton Icon="Flag" 
                                        Label="å†²çª" 
                                        IsChecked="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                                        AutomationProperties.Name="å†²çªé¢æ¿å¼€å…³"
                                        AutomationProperties.HelpText="æ˜¾ç¤ºæˆ–éšè—å†²çªå’Œè­¦å‘Šé¢æ¿"
                                        ToolTipService.ToolTip="å†²çªå’Œè­¦å‘Š"/>
                </CommandBar>
            </StackPanel>

            <!-- Main Content and Conflict Pane -->
            <SplitView Grid.Row="1"
                       IsPaneOpen="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                       PanePlacement="Right"
                       DisplayMode="Inline"
                       OpenPaneLength="360">
                <SplitView.Pane>
                    <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                          BorderThickness="1,0,0,0" 
                          Padding="12"
                          AutomationProperties.Name="å³ä¾§é¢æ¿"
                          AutomationProperties.LandmarkType="Custom">
                        <!-- TabView for Search Filter, Search Results and Conflict Management -->
                        <TabView x:Name="RightPaneTabView"
                                 SelectedIndex="{x:Bind ViewModel.RightPaneTabIndex, Mode=TwoWay}"
                                 TabWidthMode="Equal"
                                 CanDragTabs="False"
                                 CanReorderTabs="False"
                                 IsAddTabButtonVisible="False"
                                 AutomationProperties.Name="å³ä¾§é¢æ¿æ ‡ç­¾é¡µ">
                            
                            <TabView.TabItems>
                                <!-- Search Filter Tab -->
                                <TabViewItem Header="æœç´¢ç­›é€‰"
                                             IsClosable="False"
                                             Visibility="{x:Bind ViewModel.IsSearchPaneOpen, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                             AutomationProperties.Name="æœç´¢ç­›é€‰æ ‡ç­¾é¡µ">
                                    <Grid Padding="0,12,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Header -->
                                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
                                            <TextBlock Text="æœç´¢ç­›é€‰" 
                                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                                       AutomationProperties.Name="æœç´¢ç­›é€‰æ ‡é¢˜"
                                                       AutomationProperties.HeadingLevel="Level2"/>
                                            <TextBlock Text="è®¾ç½®ç­›é€‰æ¡ä»¶ä»¥å¿«é€Ÿå®šä½ç­æ¬¡" 
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>

                                        <!-- Filter Controls -->
                                        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                                            <StackPanel Spacing="16">
                                                <!-- Date Range Filter -->
                                                <StackPanel Spacing="8">
                                                    <TextBlock Text="æ—¥æœŸèŒƒå›´" 
                                                               FontWeight="SemiBold"
                                                               AutomationProperties.Name="æ—¥æœŸèŒƒå›´ç­›é€‰æ ‡ç­¾"/>
                                                    <CalendarDatePicker x:Name="FilterStartDatePicker"
                                                                        Header="å¼€å§‹æ—¥æœŸ"
                                                                        PlaceholderText="é€‰æ‹©å¼€å§‹æ—¥æœŸ"
                                                                        DateChanged="FilterStartDatePicker_DateChanged"
                                                                        HorizontalAlignment="Stretch"
                                                                        AutomationProperties.Name="ç­›é€‰å¼€å§‹æ—¥æœŸ"
                                                                        AutomationProperties.HelpText="é€‰æ‹©ç­›é€‰çš„å¼€å§‹æ—¥æœŸ"/>
                                                    <CalendarDatePicker x:Name="FilterEndDatePicker"
                                                                        Header="ç»“æŸæ—¥æœŸ"
                                                                        PlaceholderText="é€‰æ‹©ç»“æŸæ—¥æœŸ"
                                                                        DateChanged="FilterEndDatePicker_DateChanged"
                                                                        HorizontalAlignment="Stretch"
                                                                        AutomationProperties.Name="ç­›é€‰ç»“æŸæ—¥æœŸ"
                                                                        AutomationProperties.HelpText="é€‰æ‹©ç­›é€‰çš„ç»“æŸæ—¥æœŸ"/>
                                                </StackPanel>

                                                <!-- Position Filter -->
                                                <StackPanel Spacing="8">
                                                    <TextBlock Text="å“¨ä½" 
                                                               FontWeight="SemiBold"
                                                               AutomationProperties.Name="å“¨ä½ç­›é€‰æ ‡ç­¾"/>
                                                    <ComboBox x:Name="PositionFilterComboBox"
                                                              Header="é€‰æ‹©å“¨ä½"
                                                              ItemsSource="{x:Bind ViewModel.SelectedPositionIds}"
                                                              IsEditable="False"
                                                              PlaceholderText="å…¨éƒ¨å“¨ä½"
                                                              HorizontalAlignment="Stretch"
                                                              AutomationProperties.Name="å“¨ä½ç­›é€‰ä¸‹æ‹‰æ¡†"
                                                              AutomationProperties.HelpText="é€‰æ‹©è¦ç­›é€‰çš„å“¨ä½ï¼Œå¯å¤šé€‰"/>
                                                </StackPanel>

                                                <!-- Personnel Search -->
                                                <StackPanel Spacing="8">
                                                    <TextBlock Text="äººå‘˜" 
                                                               FontWeight="SemiBold"
                                                               AutomationProperties.Name="äººå‘˜æœç´¢æ ‡ç­¾"/>
                                                    <AutoSuggestBox x:Name="PersonnelSearchBox"
                                                                    Header="æœç´¢äººå‘˜"
                                                                    Text="{x:Bind ViewModel.PersonnelSearchText, Mode=TwoWay}"
                                                                    ItemsSource="{x:Bind ViewModel.PersonnelSuggestions, Mode=OneWay}"
                                                                    PlaceholderText="è¾“å…¥å§“åæˆ–æ‹¼éŸ³é¦–å­—æ¯"
                                                                    QueryIcon="Find"
                                                                    TextChanged="PersonnelSearchBox_TextChanged"
                                                                    GotFocus="PersonnelSearchBox_GotFocus"
                                                                    SuggestionChosen="PersonnelSearchBox_SuggestionChosen"
                                                                    QuerySubmitted="PersonnelSearchBox_QuerySubmitted"
                                                                    HorizontalAlignment="Stretch"
                                                                    AutomationProperties.Name="äººå‘˜æœç´¢æ¡†"
                                                                    AutomationProperties.HelpText="è¾“å…¥äººå‘˜å§“åè¿›è¡Œæ¨¡ç³Šæœç´¢ï¼Œæ”¯æŒæ‹¼éŸ³é¦–å­—æ¯ï¼Œæˆ–ä»Žä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©"
                                                                    ToolTipService.ToolTip="æ”¯æŒæ¨¡ç³Šæœç´¢å’Œæ‹¼éŸ³é¦–å­—æ¯åŒ¹é…">
                                                        <AutoSuggestBox.ItemTemplate>
                                                            <DataTemplate x:DataType="dto:PersonnelDto">
                                                                <TextBlock Text="{x:Bind Name}" 
                                                                          Padding="8,4"
                                                                          VerticalAlignment="Center"/>
                                                            </DataTemplate>
                                                        </AutoSuggestBox.ItemTemplate>
                                                    </AutoSuggestBox>
                                                </StackPanel>

                                                <!-- Filter Actions -->
                                                <StackPanel Spacing="8" Margin="0,16,0,0">
                                                    <Button Content="åº”ç”¨ç­›é€‰" 
                                                            Command="{x:Bind ViewModel.ApplyFiltersCommand}" 
                                                            Style="{ThemeResource AccentButtonStyle}"
                                                            HorizontalAlignment="Stretch"
                                                            AutomationProperties.Name="åº”ç”¨ç­›é€‰æŒ‰é’®"
                                                            AutomationProperties.HelpText="åº”ç”¨å½“å‰è®¾ç½®çš„ç­›é€‰æ¡ä»¶"
                                                            ToolTipService.ToolTip="åº”ç”¨ç­›é€‰ (Ctrl+F)"/>
                                                    <Button Content="é‡ç½®ç­›é€‰" 
                                                            Command="{x:Bind ViewModel.ResetFiltersCommand}"
                                                            HorizontalAlignment="Stretch"
                                                            AutomationProperties.Name="é‡ç½®ç­›é€‰æŒ‰é’®"
                                                            AutomationProperties.HelpText="æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶å¹¶é‡æ–°åŠ è½½æ•°æ®"
                                                            ToolTipService.ToolTip="é‡ç½®ç­›é€‰"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </Grid>
                                </TabViewItem>

                                <!-- Search Results Tab -->
                                <TabViewItem Header="æœç´¢ç»“æžœ"
                                             IsClosable="False"
                                             Visibility="{x:Bind ViewModel.IsSearchResultsTabVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                             AutomationProperties.Name="æœç´¢ç»“æžœæ ‡ç­¾é¡µ">
                                    <Grid Padding="0,12,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Filter Summary and Result Count -->
                                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
                                            <TextBlock Text="æœç´¢ç»“æžœ" 
                                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                                       AutomationProperties.Name="æœç´¢ç»“æžœæ ‡é¢˜"
                                                       AutomationProperties.HeadingLevel="Level2"/>
                                            
                                            <!-- Result Count -->
                                            <TextBlock FontSize="14" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="æœç´¢ç»“æžœæ•°é‡"
                                                       AutomationProperties.LiveSetting="Polite"
                                                       Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter='invert'}">
                                                <Run Text="å…±"/>
                                                <Run Text="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay}" FontWeight="SemiBold"/>
                                                <Run Text="ä¸ªç­æ¬¡"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <!-- Loading Indicator -->
                                        <StackPanel Grid.Row="2"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Spacing="12"
                                                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                                    AutomationProperties.Name="åŠ è½½ä¸­æŒ‡ç¤ºå™¨">
                                            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                                                          Width="48"
                                                          Height="48"/>
                                            <TextBlock Text="æ­£åœ¨æœç´¢..."
                                                       Style="{ThemeResource BodyTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                        </StackPanel>

                                        <!-- Search Results List (ä½¿ç”¨ ListView å¯ç”¨è™šæ‹ŸåŒ–) -->
                                        <ListView Grid.Row="2"
                                                  ItemsSource="{x:Bind ViewModel.SearchResults, Mode=OneWay}"
                                                  SelectionMode="Single"
                                                  SelectedItem="{x:Bind ViewModel.SelectedSearchResult, Mode=TwoWay}"
                                                  Margin="0,0,0,12"
                                                  Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter='invert'}"
                                                  AutomationProperties.Name="æœç´¢ç»“æžœåˆ—è¡¨"
                                                  AutomationProperties.LandmarkType="Custom"
                                                  AutomationProperties.LiveSetting="Polite">
                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                            <ListView.ItemTemplate>
                                                    <DataTemplate x:DataType="dto:SearchResultItem">
                                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="8"
                                                                Padding="12"
                                                                Margin="0,0,0,8"
                                                                AutomationProperties.Name="{x:Bind DisplayText}">
                                                            <StackPanel Spacing="8">
                                                                <!-- Date and Time Header -->
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <!-- Night/Day Icon -->
                                                                    <FontIcon Grid.Column="0"
                                                                              Glyph="{x:Bind IsNightShift, Converter={StaticResource BoolToGlyphConverter}, ConverterParameter='ðŸŒ™|â˜€'}"
                                                                              FontSize="16"
                                                                              Margin="0,0,8,0"
                                                                              VerticalAlignment="Top"
                                                                              Foreground="{x:Bind IsNightShift, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#FFB366|#FFD700'}"/>

                                                                    <!-- Date and Time Info -->
                                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                                        <TextBlock FontWeight="SemiBold"
                                                                                   TextWrapping="Wrap"
                                                                                   AutomationProperties.Name="æ—¥æœŸå’Œæ—¶æ®µ">
                                                                            <Run Text="{x:Bind Date, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                                                                            <Run Text="{x:Bind DayOfWeek}"/>
                                                                            <Run Text="{x:Bind PeriodName}"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Grid>

                                                                <!-- Position and Personnel Info -->
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <!-- Position -->
                                                                    <StackPanel Grid.Column="0" Spacing="2">
                                                                        <TextBlock Text="å“¨ä½" 
                                                                                   FontSize="10" 
                                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                                        <TextBlock Text="{x:Bind PositionName}" 
                                                                                   FontSize="12"
                                                                                   FontWeight="SemiBold"/>
                                                                    </StackPanel>

                                                                    <!-- Personnel -->
                                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                                        <TextBlock Text="äººå‘˜" 
                                                                                   FontSize="10" 
                                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                                        <TextBlock Text="{x:Bind PersonnelName}" 
                                                                                   FontSize="12"
                                                                                   FontWeight="SemiBold"/>
                                                                    </StackPanel>
                                                                </Grid>

                                                                <!-- Tags (Manual Assignment, Conflict) -->
                                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                                    <Border Background="{ThemeResource AccentFillColorDefaultBrush}"
                                                                            CornerRadius="4"
                                                                            Padding="6,2"
                                                                            Visibility="{x:Bind IsManualAssignment, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <TextBlock Text="âœ‹ æ‰‹åŠ¨"
                                                                                   FontSize="10"
                                                                                   Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                    <Border Background="{ThemeResource SystemFillColorCriticalBrush}"
                                                                            CornerRadius="4"
                                                                            Padding="6,2"
                                                                            Visibility="{x:Bind HasConflict, Converter={StaticResource BoolToVisibilityConverter}}">
                                                                        <TextBlock Text="âš  å†²çª"
                                                                                   FontSize="10"
                                                                                   Foreground="White"
                                                                                   FontWeight="SemiBold"/>
                                                                    </Border>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>

                                        <!-- Navigation Buttons -->
                                        <Grid Grid.Row="3" 
                                              Padding="0,8,0,0"
                                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                              BorderThickness="0,1,0,0"
                                              AutomationProperties.Name="å¯¼èˆªæŒ‰é’®åŒºåŸŸ">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Previous Button -->
                                            <Button Grid.Column="0"
                                                    Content="â—€ ä¸Šä¸€ä¸ª"
                                                    Command="{x:Bind ViewModel.NavigateToPreviousHighlightCommand}"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="0,8,4,0"
                                                    AutomationProperties.Name="ä¸Šä¸€ä¸ªæœç´¢ç»“æžœ"
                                                    AutomationProperties.HelpText="è·³è½¬åˆ°ä¸Šä¸€ä¸ªæœç´¢ç»“æžœ"
                                                    ToolTipService.ToolTip="ä¸Šä¸€ä¸ª"/>

                                            <!-- Current Position Indicator -->
                                            <TextBlock Grid.Column="1"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Margin="8,8,8,0"
                                                       FontSize="14"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="å½“å‰ä½ç½®æŒ‡ç¤ºå™¨"
                                                       AutomationProperties.LiveSetting="Polite">
                                                <Run Text="{x:Bind ViewModel.CurrentHighlightIndex, Mode=OneWay, Converter={StaticResource AddOneConverter}}"/>
                                                <Run Text="/"/>
                                                <Run Text="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay}"/>
                                            </TextBlock>

                                            <!-- Next Button -->
                                            <Button Grid.Column="2"
                                                    Content="ä¸‹ä¸€ä¸ª â–¶"
                                                    Command="{x:Bind ViewModel.NavigateToNextHighlightCommand}"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="4,8,0,0"
                                                    AutomationProperties.Name="ä¸‹ä¸€ä¸ªæœç´¢ç»“æžœ"
                                                    AutomationProperties.HelpText="è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæœç´¢ç»“æžœ"
                                                    ToolTipService.ToolTip="ä¸‹ä¸€ä¸ª"/>
                                        </Grid>

                                        <!-- Empty State -->
                                        <StackPanel Grid.Row="2"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Spacing="12"
                                                    Visibility="{x:Bind ViewModel.SearchResults.Count, Mode=OneWay, Converter={StaticResource ZeroToVisibilityConverter}}"
                                                    AutomationProperties.Name="ç©ºçŠ¶æ€æç¤º">
                                            <FontIcon Glyph="&#xE721;" 
                                                      FontSize="48" 
                                                      Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                            <TextBlock Text="æœªæ‰¾åˆ°åŒ¹é…çš„ç­æ¬¡"
                                                       Style="{ThemeResource BodyTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                            <TextBlock Text="è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶"
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </Grid>
                                </TabViewItem>

                                <!-- Conflict Management Tab -->
                                <TabViewItem Header="å†²çªç®¡ç†"
                                             IsClosable="False"
                                             AutomationProperties.Name="å†²çªç®¡ç†æ ‡ç­¾é¡µ">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                                  Padding="0,12,0,0">
                                        <StackPanel Spacing="12">
                                            <!-- Conflict Panel Header -->
                                            <StackPanel Spacing="8" Margin="0,0,0,0">
                                                <TextBlock Text="å†²çªç®¡ç†" 
                                                           Style="{ThemeResource SubtitleTextBlockStyle}"
                                                           AutomationProperties.Name="å†²çªç®¡ç†æ ‡é¢˜"
                                                           AutomationProperties.HeadingLevel="Level2"/>
                                            </StackPanel>

                                            <!-- Conflict Statistics Cards and Detailed Statistics -->
                                            <StackPanel Spacing="8" Margin="0,0,0,0">
                            <!-- Conflict Statistics Cards -->
                            <Grid AutomationProperties.Name="å†²çªç»Ÿè®¡å¡ç‰‡">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Hard Constraint Conflicts Card -->
                                <Border Grid.Row="0" Grid.Column="0"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                        BorderBrush="{ThemeResource SystemFillColorCriticalBrush}" 
                                        BorderThickness="1.5" 
                                        CornerRadius="6" 
                                        Padding="8,6"
                                        Margin="0,0,3,3"
                                        AutomationProperties.Name="ç¡¬çº¦æŸå†²çªç»Ÿè®¡å¡ç‰‡">
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="âš  ç¡¬çº¦æŸ" 
                                                   FontSize="11" 
                                                   Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                   FontWeight="SemiBold"
                                                   AutomationProperties.Name="ç¡¬çº¦æŸå†²çªæ ‡ç­¾"/>
                                        <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.HardConflictCount, Mode=OneWay, FallbackValue=0}" 
                                                   FontSize="20" 
                                                   FontWeight="Bold"
                                                   Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                   AutomationProperties.Name="ç¡¬çº¦æŸå†²çªæ•°é‡"
                                                   AutomationProperties.LiveSetting="Polite"/>
                                    </StackPanel>
                                </Border>

                                <!-- Soft Constraint Conflicts Card -->
                                <Border Grid.Row="0" Grid.Column="1"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                        BorderBrush="{ThemeResource SystemFillColorCautionBrush}" 
                                        BorderThickness="1.5" 
                                        CornerRadius="6" 
                                        Padding="8,6"
                                        Margin="3,0,0,3"
                                        AutomationProperties.Name="è½¯çº¦æŸå†²çªç»Ÿè®¡å¡ç‰‡">
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="âš  è½¯çº¦æŸ" 
                                                   FontSize="11" 
                                                   Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                                   FontWeight="SemiBold"
                                                   AutomationProperties.Name="è½¯çº¦æŸå†²çªæ ‡ç­¾"/>
                                        <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.SoftConflictCount, Mode=OneWay, FallbackValue=0}" 
                                                   FontSize="20" 
                                                   FontWeight="Bold"
                                                   Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                                   AutomationProperties.Name="è½¯çº¦æŸå†²çªæ•°é‡"
                                                   AutomationProperties.LiveSetting="Polite"/>
                                    </StackPanel>
                                </Border>

                                <!-- Unassigned Slots Card -->
                                <Border Grid.Row="1" Grid.Column="0"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                        BorderThickness="1" 
                                        CornerRadius="6" 
                                        Padding="8,6"
                                        Margin="0,3,3,0"
                                        AutomationProperties.Name="æœªåˆ†é…æ—¶æ®µç»Ÿè®¡å¡ç‰‡">
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="â„¹ æœªåˆ†é…" 
                                                   FontSize="11" 
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   FontWeight="SemiBold"
                                                   AutomationProperties.Name="æœªåˆ†é…æ—¶æ®µæ ‡ç­¾"/>
                                        <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.UnassignedSlotCount, Mode=OneWay, FallbackValue=0}" 
                                                   FontSize="20" 
                                                   FontWeight="Bold"
                                                   AutomationProperties.Name="æœªåˆ†é…æ—¶æ®µæ•°é‡"
                                                   AutomationProperties.LiveSetting="Polite"/>
                                    </StackPanel>
                                </Border>

                                <!-- Ignored Conflicts Card -->
                                <Border Grid.Row="1" Grid.Column="1"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                        BorderThickness="1" 
                                        CornerRadius="6" 
                                        Padding="8,6"
                                        Margin="3,3,0,0"
                                        AutomationProperties.Name="å·²å¿½ç•¥å†²çªç»Ÿè®¡å¡ç‰‡">
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="âœ“ å·²å¿½ç•¥" 
                                                   FontSize="11" 
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   FontWeight="SemiBold"
                                                   AutomationProperties.Name="å·²å¿½ç•¥å†²çªæ ‡ç­¾"/>
                                        <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.IgnoredConflictCount, Mode=OneWay, FallbackValue=0}" 
                                                   FontSize="20" 
                                                   FontWeight="Bold"
                                                   AutomationProperties.Name="å·²å¿½ç•¥å†²çªæ•°é‡"
                                                   AutomationProperties.LiveSetting="Polite"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Statistics Panel -->
                            <StackPanel Spacing="12">
                                <!-- Statistics Title -->
                                <TextBlock Text="ç»Ÿè®¡ä¿¡æ¯" 
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           Margin="0,4,0,8"
                                           AutomationProperties.Name="ç»Ÿè®¡ä¿¡æ¯æ ‡é¢˜"
                                           AutomationProperties.HeadingLevel="Level2"/>
                                
                                <StackPanel Spacing="12">
                                    <!-- Summary Stats -->
                                    <Grid AutomationProperties.Name="ç»Ÿè®¡æ‘˜è¦">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <Border x:Name="TotalAssignmentsCard"
                                                Grid.Column="0" 
                                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                                BorderThickness="1" 
                                                CornerRadius="8" 
                                                Padding="12"
                                                AutomationProperties.Name="æ€»åˆ†é…æ•°ç»Ÿè®¡å¡ç‰‡"
                                                PointerEntered="StatCard_PointerEntered"
                                                PointerExited="StatCard_PointerExited">
                                            <StackPanel>
                                                <TextBlock Text="æ€»åˆ†é…æ•°" 
                                                           FontSize="12" 
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                           AutomationProperties.Name="æ€»åˆ†é…æ•°æ ‡ç­¾"/>
                                                <TextBlock Text="{x:Bind ViewModel.Statistics.TotalAssignments, Mode=OneWay, FallbackValue=0}" 
                                                           FontSize="24" 
                                                           FontWeight="Bold"
                                                           AutomationProperties.Name="æ€»åˆ†é…æ•°å€¼"
                                                           AutomationProperties.LiveSetting="Polite"/>
                                            </StackPanel>
                                        </Border>

                                        <Border x:Name="PersonnelCountCard"
                                                Grid.Column="1" 
                                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                                BorderThickness="1" 
                                                CornerRadius="8" 
                                                Padding="12"
                                                AutomationProperties.Name="å‚ä¸Žäººå‘˜æ•°ç»Ÿè®¡å¡ç‰‡"
                                                PointerEntered="StatCard_PointerEntered"
                                                PointerExited="StatCard_PointerExited">
                                            <StackPanel>
                                                <TextBlock Text="å‚ä¸Žäººå‘˜æ•°" 
                                                           FontSize="12" 
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                           AutomationProperties.Name="å‚ä¸Žäººå‘˜æ•°æ ‡ç­¾"/>
                                                <TextBlock Text="{x:Bind ViewModel.PersonnelWorkloads.Count, Mode=OneWay, FallbackValue=0}" 
                                                           FontSize="24" 
                                                           FontWeight="Bold"
                                                           AutomationProperties.Name="å‚ä¸Žäººå‘˜æ•°å€¼"
                                                           AutomationProperties.LiveSetting="Polite"/>
                                            </StackPanel>
                                        </Border>

                                        <Border x:Name="PositionCountCard"
                                                Grid.Column="2" 
                                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                                BorderThickness="1" 
                                                CornerRadius="8" 
                                                Padding="12"
                                                AutomationProperties.Name="å‚ä¸Žå“¨ä½æ•°ç»Ÿè®¡å¡ç‰‡"
                                                PointerEntered="StatCard_PointerEntered"
                                                PointerExited="StatCard_PointerExited">
                                            <StackPanel>
                                                <TextBlock Text="å‚ä¸Žå“¨ä½æ•°" 
                                                           FontSize="12" 
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                           AutomationProperties.Name="å‚ä¸Žå“¨ä½æ•°æ ‡ç­¾"/>
                                                <TextBlock Text="{x:Bind ViewModel.PositionCoverages.Count, Mode=OneWay, FallbackValue=0}" 
                                                           FontSize="24" 
                                                           FontWeight="Bold"
                                                           AutomationProperties.Name="å‚ä¸Žå“¨ä½æ•°å€¼"
                                                           AutomationProperties.LiveSetting="Polite"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>

                                    <!-- Personnel Workload Table -->
                                    <StackPanel>
                                        <Grid Margin="0,8,0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                       Text="äººå‘˜å·¥ä½œé‡" 
                                                       FontWeight="SemiBold" 
                                                       VerticalAlignment="Center"
                                                       AutomationProperties.Name="äººå‘˜å·¥ä½œé‡ç»Ÿè®¡æ ‡é¢˜"
                                                       AutomationProperties.HeadingLevel="Level3"/>
                                            <ComboBox Grid.Column="1"
                                                      SelectedIndex="{x:Bind ViewModel.PersonnelWorkloadSortOrderIndex, Mode=TwoWay}"
                                                      MinWidth="100"
                                                      AutomationProperties.Name="å·¥ä½œé‡æŽ’åºæ–¹å¼"
                                                      AutomationProperties.HelpText="é€‰æ‹©æŒ‰å·¥ä½œé‡å‡åºæˆ–é™åºæŽ’åˆ—">
                                                <ComboBoxItem Content="é™åº"/>
                                                <ComboBoxItem Content="å‡åº"/>
                                            </ComboBox>
                                        </Grid>
                                        <ListView ItemsSource="{x:Bind ViewModel.PersonnelWorkloads, Mode=OneWay}" 
                                                  MaxHeight="200" 
                                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                  AutomationProperties.Name="äººå‘˜å·¥ä½œé‡ç»Ÿè®¡è¡¨"
                                                  AutomationProperties.LandmarkType="Custom">
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding PersonnelName}" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding TotalShifts}" Margin="16,0" VerticalAlignment="Center"/>
                                                        <ProgressBar Grid.Column="2" Width="100" Value="{Binding TotalShifts}" Maximum="20" Margin="8,0"/>
                                                        <TextBlock Grid.Column="3"
                                                                   Text="{Binding DayNightSummary}"
                                                                   Margin="16,0,0,0"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="12"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </StackPanel>

                                    <!-- Position Coverage Table -->
                                    <StackPanel>
                                        <TextBlock Text="å“¨ä½è¦†ç›–çŽ‡" 
                                                   FontWeight="SemiBold" 
                                                   Margin="0,8,0,4"
                                                   AutomationProperties.Name="å“¨ä½è¦†ç›–çŽ‡ç»Ÿè®¡æ ‡é¢˜"
                                                   AutomationProperties.HeadingLevel="Level3"/>
                                        <ListView ItemsSource="{x:Bind ViewModel.PositionCoverages, Mode=OneWay}" 
                                                  MaxHeight="200" 
                                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                  AutomationProperties.Name="å“¨ä½è¦†ç›–çŽ‡ç»Ÿè®¡è¡¨"
                                                  AutomationProperties.LandmarkType="Custom">
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding PositionName}" VerticalAlignment="Center"/>
                                                        <ProgressBar Grid.Column="1" Width="100" Value="{Binding CoverageRate}" Maximum="1" Margin="8,0"/>
                                                        <TextBlock Grid.Column="2"
                                                                   Text="{Binding CoverageRateDisplay}"
                                                                   Margin="16,0,0,0"
                                                                   VerticalAlignment="Center"
                                                                   FontSize="12"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                                            <!-- Filter and Sort Controls -->
                                            <StackPanel Spacing="8" Margin="0,0,0,0" AutomationProperties.Name="ç­›é€‰å’ŒæŽ’åºæŽ§ä»¶">
                            <!-- Type and Severity Filters -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Type Filter -->
                                <ComboBox Grid.Column="0"
                                          Header="ç±»åž‹"
                                          SelectedValue="{x:Bind ViewModel.ConflictTypeFilter, Mode=TwoWay}"
                                          PlaceholderText="å…¨éƒ¨"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="å†²çªç±»åž‹ç­›é€‰å™¨"
                                          AutomationProperties.HelpText="æŒ‰å†²çªç±»åž‹ç­›é€‰">
                                    <x:String>å…¨éƒ¨</x:String>
                                    <x:String>ç¡¬çº¦æŸ</x:String>
                                    <x:String>è½¯çº¦æŸ</x:String>
                                    <x:String>ä¿¡æ¯</x:String>
                                    <x:String>æœªåˆ†é…</x:String>
                                </ComboBox>

                                <!-- Severity Filter -->
                                <ComboBox Grid.Column="1"
                                          Header="ä¸¥é‡ç¨‹åº¦"
                                          SelectedValue="{x:Bind ViewModel.ConflictSeverityFilter, Mode=TwoWay}"
                                          PlaceholderText="å…¨éƒ¨"
                                          HorizontalAlignment="Stretch"
                                          Margin="4,0,0,0"
                                          AutomationProperties.Name="ä¸¥é‡ç¨‹åº¦ç­›é€‰å™¨"
                                          AutomationProperties.HelpText="æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰">
                                    <x:String>å…¨éƒ¨</x:String>
                                    <x:String>5 - æœ€é«˜</x:String>
                                    <x:String>4 - é«˜</x:String>
                                    <x:String>3 - ä¸­</x:String>
                                    <x:String>2 - ä½Ž</x:String>
                                    <x:String>1 - æœ€ä½Ž</x:String>
                                </ComboBox>
                            </Grid>

                            <!-- Sort and Search -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Sort By -->
                                <ComboBox Grid.Column="0"
                                          Header="æŽ’åº"
                                          SelectedValue="{x:Bind ViewModel.ConflictSortBy, Mode=TwoWay}"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="æŽ’åºé€‰æ‹©å™¨"
                                          AutomationProperties.HelpText="é€‰æ‹©æŽ’åºæ–¹å¼">
                                    <x:String>æŒ‰ç±»åž‹</x:String>
                                    <x:String>æŒ‰æ—¥æœŸ</x:String>
                                    <x:String>æŒ‰ä¸¥é‡ç¨‹åº¦</x:String>
                                </ComboBox>

                                <!-- Search Box -->
                                <TextBox Grid.Column="1"
                                         Header="æœç´¢"
                                         Text="{x:Bind ViewModel.ConflictSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="äººå‘˜/å“¨ä½..."
                                         Margin="4,0,0,0"
                                         AutomationProperties.Name="å†²çªæœç´¢æ¡†"
                                         AutomationProperties.HelpText="æŒ‰äººå‘˜æˆ–å“¨ä½åç§°æœç´¢å†²çª"/>
                            </Grid>
                        </StackPanel>

                                            <!-- Conflict List with Grouping -->
                                            <ScrollViewer MaxHeight="400"
                                                          VerticalScrollBarVisibility="Auto"
                                                          Margin="0,0,0,0"
                                                          AutomationProperties.Name="å†²çªåˆ—è¡¨åŒºåŸŸ">
                                                <ItemsControl x:Name="ConflictListView"
                                                              ItemsSource="{x:Bind ViewModel.FilteredConflicts, Mode=OneWay}"
                                                              AutomationProperties.Name="å†²çªåˆ—è¡¨"
                                                              AutomationProperties.LandmarkType="Custom"
                                                              AutomationProperties.LiveSetting="Polite">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="dto:ConflictDto">
                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="12"
                                                Margin="0,0,0,8"
                                                AutomationProperties.Name="{x:Bind Message}">
                                            <StackPanel Spacing="8">
                                                <!-- Conflict Header -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Icon based on type -->
                                                    <FontIcon Grid.Column="0"
                                                              Glyph="&#xE7BA;"
                                                              FontSize="16"
                                                              Margin="0,0,8,0"
                                                              VerticalAlignment="Top"
                                                              Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>

                                                    <!-- Conflict Type and Description -->
                                                    <StackPanel Grid.Column="1" Spacing="4">
                                                        <TextBlock Text="{x:Bind SubType, Converter={StaticResource ConflictSubTypeToTextConverter}}"
                                                                   FontWeight="SemiBold"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="å†²çªç±»åž‹"/>
                                                        <TextBlock Text="{x:Bind Message}"
                                                                   FontSize="12"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="å†²çªæè¿°"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Conflict Details -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Personnel Info -->
                                                    <StackPanel Grid.Column="0" Spacing="2">
                                                        <TextBlock Text="äººå‘˜" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PersonnelName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>

                                                    <!-- Position Info -->
                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                        <TextBlock Text="å“¨ä½" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PositionName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Date and Time Info -->
                                                <StackPanel Spacing="2">
                                                    <TextBlock Text="æ—¶é—´" 
                                                               FontSize="10" 
                                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                    <TextBlock FontSize="12">
                                                        <Run Text="{x:Bind StartTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd HH:mm', FallbackValue='-'}"/>
                                                        <Run Text=" - "/>
                                                        <Run Text="{x:Bind EndTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='HH:mm', FallbackValue='-'}"/>
                                                    </TextBlock>
                                                </StackPanel>

                                                <!-- Action Buttons -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Button Grid.Column="0"
                                                            Content="å®šä½" 
                                                            Tag="{x:Bind}"
                                                            Click="LocateConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="0,0,4,0"
                                                            AutomationProperties.Name="å®šä½å†²çª"
                                                            AutomationProperties.HelpText="åœ¨è¡¨æ ¼ä¸­å®šä½å¹¶é«˜äº®æ˜¾ç¤ºæ­¤å†²çª"
                                                            ToolTipService.ToolTip="å®šä½å†²çª"/>

                                                    <Button Grid.Column="1"
                                                            Content="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='å–æ¶ˆå¿½ç•¥|å¿½ç•¥'}"
                                                            Tag="{x:Bind}"
                                                            Click="IgnoreConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,4,0"
                                                            AutomationProperties.Name="å¿½ç•¥æˆ–å–æ¶ˆå¿½ç•¥å†²çª"
                                                            AutomationProperties.HelpText="å°†æ­¤å†²çªæ ‡è®°ä¸ºå·²å¿½ç•¥æˆ–å–æ¶ˆå¿½ç•¥"
                                                            ToolTipService.ToolTip="å¿½ç•¥/å–æ¶ˆå¿½ç•¥"/>

                                                    <Button Grid.Column="2"
                                                            Content="ä¿®å¤" 
                                                            Tag="{x:Bind}"
                                                            Click="FixConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,0,0"
                                                            IsEnabled="{x:Bind IsFixable}"
                                                            AutomationProperties.Name="ä¿®å¤å†²çª"
                                                            AutomationProperties.HelpText="æ‰“å¼€ä¿®å¤å¯¹è¯æ¡†ä»¥è§£å†³æ­¤å†²çª"
                                                            ToolTipService.ToolTip="ä¿®å¤å†²çª"/>
                                                </Grid>

                                                <!-- Ignored Badge -->
                                                <Border Background="{ThemeResource SystemFillColorSuccessBrush}"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Left"
                                                        Visibility="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="âœ“ å·²å¿½ç•¥"
                                                               FontSize="10"
                                                               Foreground="White"
                                                               FontWeight="SemiBold"/>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                                    </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>

                                            <!-- Bottom Action Buttons -->
                                            <StackPanel Orientation="Vertical" 
                                                        Spacing="8" 
                                                        Margin="0,0,0,0"
                                                        AutomationProperties.Name="å†²çªæ“ä½œæŒ‰é’®">
                                                <Button Content="å…¨éƒ¨å¿½ç•¥è½¯çº¦æŸ"
                                                        Command="{x:Bind ViewModel.IgnoreAllSoftConflictsCommand}"
                                                        HorizontalAlignment="Stretch"
                                                        AutomationProperties.Name="å…¨éƒ¨å¿½ç•¥è½¯çº¦æŸå†²çª"
                                                        AutomationProperties.HelpText="å°†æ‰€æœ‰è½¯çº¦æŸå†²çªæ ‡è®°ä¸ºå·²å¿½ç•¥"
                                                        ToolTipService.ToolTip="å¿½ç•¥æ‰€æœ‰è½¯çº¦æŸå†²çª"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabViewItem>
                            </TabView.TabItems>
                        </TabView>
                    </Grid>
                </SplitView.Pane>
                <SplitView.Content>
                    <Grid Padding="24,0,24,0"
                          AutomationProperties.Name="ä¸»å†…å®¹åŒºåŸŸ"
                          AutomationProperties.LandmarkType="Main">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Grid View -->
                        <controls:ScheduleGridControl
                            x:Name="ScheduleGrid"
                            Grid.Row="0"
                            GridData="{x:Bind ViewModel.GridData, Mode=OneWay}"
                            HighlightedCellKeys="{x:Bind ViewModel.HighlightedCellKeys, Mode=OneWay}"
                            FocusedShiftId="{x:Bind ViewModel.FocusedShiftId, Mode=OneWay}"
                            Visibility="{x:Bind GridRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="ç½‘æ ¼è§†å›¾æŽ’ç­è¡¨"
                            AutomationProperties.LandmarkType="Main"/>

                        <!-- List View -->
                        <ListView x:Name="ShiftListView"
                                  Grid.Row="0"
                                  ItemsSource="{x:Bind ViewModel.ShiftList, Mode=OneWay}"
                                  Visibility="{x:Bind ListRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  AutomationProperties.Name="åˆ—è¡¨è§†å›¾ç­æ¬¡åˆ—è¡¨"
                                  AutomationProperties.LandmarkType="Main">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="dto:ShiftListItem">
                                    <Grid Padding="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Date -->
                                        <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                            <TextBlock Text="{x:Bind Date, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='MM-dd'}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{x:Bind DateTimeDescription}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>

                                        <!-- Personnel and Position -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{x:Bind PersonnelName}" FontSize="16" FontWeight="SemiBold"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                                <TextBlock Text="{x:Bind TimeSlot}" FontSize="12"/>
                                                <TextBlock Text="{x:Bind PositionName}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                <!-- Tags -->
                                                <Border Background="{ThemeResource AccentBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind IsManualAssignment, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="æ‰‹åŠ¨" FontSize="10" Foreground="White"/>
                                                </Border>
                                                <Border Background="{ThemeResource WarningBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind HasConflict, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="å†²çª" FontSize="10" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>


                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!-- By Position View -->
                        <Grid Grid.Row="0"
                              Visibility="{x:Bind ByPositionRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- å“¨ä½é€‰æ‹©å™¨ -->
                            <Grid Grid.Row="0" 
                                  Margin="0,0,0,12"
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  Padding="16"
                                  AutomationProperties.Name="å“¨ä½é€‰æ‹©åŒºåŸŸ">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="é€‰æ‹©å“¨ä½:"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           FontWeight="SemiBold"
                                           AutomationProperties.Name="å“¨ä½é€‰æ‹©æ ‡ç­¾"/>

                                <AutoSuggestBox Grid.Column="1"
                                                x:Name="PositionSelectorAutoSuggestBox"
                                                PlaceholderText="è¾“å…¥å“¨ä½åç§°æˆ–æ‹¼éŸ³é¦–å­—æ¯æœç´¢..."
                                                ItemsSource="{x:Bind ViewModel.PositionSelectorSuggestions, Mode=OneWay}"
                                                Text="{x:Bind ViewModel.PositionSelectorSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Stretch"
                                                MinWidth="300"
                                                QueryIcon="Find"
                                                TextChanged="PositionSelectorAutoSuggestBox_TextChanged"
                                                SuggestionChosen="PositionSelectorAutoSuggestBox_SuggestionChosen"
                                                QuerySubmitted="PositionSelectorAutoSuggestBox_QuerySubmitted"
                                                GotFocus="PositionSelectorAutoSuggestBox_GotFocus"
                                                AutomationProperties.Name="å“¨ä½é€‰æ‹©æœç´¢æ¡†"
                                                AutomationProperties.HelpText="è¾“å…¥å“¨ä½åç§°æˆ–æ‹¼éŸ³é¦–å­—æ¯æœç´¢å“¨ä½ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…"
                                                AutomationProperties.LiveSetting="Polite">
                                    <AutoSuggestBox.ItemTemplate>
                                        <DataTemplate x:DataType="dto:PositionScheduleData">
                                            <Grid Padding="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{x:Bind PositionName}"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1"
                                                            Orientation="Horizontal"
                                                            Spacing="4"
                                                            VerticalAlignment="Center">
                                                    <TextBlock Text="ç­æ¬¡:"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                    <TextBlock Text="{x:Bind TotalShifts}"
                                                               FontSize="12"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </AutoSuggestBox.ItemTemplate>
                                </AutoSuggestBox>
                            </Grid>

                            <!-- å“¨ä½æŽ’ç­è¯¦æƒ…æŽ§ä»¶ -->
                            <controls:PositionScheduleControl
                                x:Name="PositionScheduleControl"
                                Grid.Row="1"
                                ScheduleData="{x:Bind ViewModel.SelectedPositionSchedule, Mode=OneWay}"
                                HighlightedCellKeys="{x:Bind ViewModel.HighlightedCellKeys, Mode=OneWay}"
                                FocusedShiftId="{x:Bind ViewModel.FocusedShiftId, Mode=OneWay}"
                                AutomationProperties.Name="å“¨ä½è§†å›¾æŽ’ç­è¡¨"
                                AutomationProperties.LandmarkType="Main"/>
                        </Grid>

                        <!-- By Personnel View -->
                        <Grid Grid.Row="0"
                              Visibility="{x:Bind ByPersonnelRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- äººå‘˜é€‰æ‹©å™¨ -->
                            <Grid Grid.Row="0" 
                                  Margin="0,0,0,12"
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  Padding="16"
                                  AutomationProperties.Name="äººå‘˜é€‰æ‹©åŒºåŸŸ">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="é€‰æ‹©äººå‘˜:"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           FontWeight="SemiBold"
                                           AutomationProperties.Name="äººå‘˜é€‰æ‹©æ ‡ç­¾"/>

                                <AutoSuggestBox Grid.Column="1"
                                                x:Name="PersonnelSelectorAutoSuggestBox"
                                                PlaceholderText="è¾“å…¥å§“åæˆ–æ‹¼éŸ³é¦–å­—æ¯æœç´¢..."
                                                ItemsSource="{x:Bind ViewModel.PersonnelSelectorSuggestions, Mode=OneWay}"
                                                Text="{x:Bind ViewModel.PersonnelSelectorSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Stretch"
                                                MinWidth="300"
                                                QueryIcon="Find"
                                                TextChanged="PersonnelSelectorAutoSuggestBox_TextChanged"
                                                SuggestionChosen="PersonnelSelectorAutoSuggestBox_SuggestionChosen"
                                                QuerySubmitted="PersonnelSelectorAutoSuggestBox_QuerySubmitted"
                                                GotFocus="PersonnelSelectorAutoSuggestBox_GotFocus"
                                                AutomationProperties.Name="äººå‘˜é€‰æ‹©æœç´¢æ¡†"
                                                AutomationProperties.HelpText="è¾“å…¥å§“åæˆ–æ‹¼éŸ³é¦–å­—æ¯æœç´¢äººå‘˜ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…"
                                                AutomationProperties.LiveSetting="Polite">
                                    <AutoSuggestBox.ItemTemplate>
                                        <DataTemplate x:DataType="dto:PersonnelScheduleData">
                                            <Grid Padding="8"
                                                  AutomationProperties.Name="{x:Bind PersonnelName}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{x:Bind PersonnelName}"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1"
                                                            Orientation="Horizontal"
                                                            Spacing="8">
                                                    <TextBlock Text="{x:Bind Workload.TotalShifts}"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Text="ç­æ¬¡"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </AutoSuggestBox.ItemTemplate>
                                </AutoSuggestBox>
                            </Grid>

                            <!-- äººå‘˜æŽ’ç­è¯¦æƒ…æŽ§ä»¶ -->
                            <controls:PersonnelScheduleControl
                                Grid.Row="1"
                                ScheduleData="{x:Bind ViewModel.SelectedPersonnelSchedule, Mode=OneWay}"
                                AutomationProperties.Name="äººå‘˜è§†å›¾æŽ’ç­ä¿¡æ¯"
                                AutomationProperties.LandmarkType="Main"/>
                        </Grid>
                    </Grid>
                </SplitView.Content>
            </SplitView>

            <!-- Bottom Action Bar -->
            <Grid Grid.Row="2" 
                  Padding="24" 
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  BorderThickness="0,1,0,0" 
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  AutomationProperties.Name="åº•éƒ¨æ“ä½œæ "
                  AutomationProperties.LandmarkType="Navigation">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Unsaved Changes Warning -->
                <TextBlock Grid.Column="0"
                           Text="æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹"
                           Foreground="{ThemeResource WarningBrush}"
                           VerticalAlignment="Center"
                           Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                           AutomationProperties.Name="æœªä¿å­˜æ›´æ”¹è­¦å‘Š"
                           AutomationProperties.LiveSetting="Assertive"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <!-- Unsaved Changes Actions -->
                    <Button Content="æ’¤é”€æ›´æ”¹"
                            Command="{x:Bind ViewModel.DiscardChangesCommand}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="æ’¤é”€æ›´æ”¹"
                            AutomationProperties.HelpText="æ’¤é”€æ‰€æœ‰æœªä¿å­˜çš„æ›´æ”¹"
                            ToolTipService.ToolTip="æ’¤é”€æ›´æ”¹"/>
                    <Button Content="ä¿å­˜æ›´æ”¹"
                            Command="{x:Bind ViewModel.SaveChangesCommand}"
                            Style="{ThemeResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="ä¿å­˜æ›´æ”¹"
                            AutomationProperties.HelpText="ä¿å­˜æ‰€æœ‰æ›´æ”¹åˆ°æ•°æ®åº“"
                            ToolTipService.ToolTip="ä¿å­˜æ›´æ”¹ (Ctrl+S)"/>

                    <!-- Primary Actions -->
                    <Button Content="è¿”å›ž" 
                            Command="{x:Bind ViewModel.BackCommand}"
                            AutomationProperties.Name="è¿”å›ž"
                            AutomationProperties.HelpText="è¿”å›žä¸Šä¸€é¡µ"
                            ToolTipService.ToolTip="è¿”å›ž"/>
                    <Button Content="é‡æ–°æŽ’ç­" 
                            Command="{x:Bind ViewModel.RescheduleCommand}"
                            AutomationProperties.Name="é‡æ–°æŽ’ç­"
                            AutomationProperties.HelpText="é‡æ–°ç”ŸæˆæŽ’ç­æ–¹æ¡ˆ"
                            ToolTipService.ToolTip="é‡æ–°æŽ’ç­"/>
                    <Button Content="ç¡®è®¤æŽ’ç­"
                            Style="{ThemeResource AccentButtonStyle}"
                            Command="{x:Bind ViewModel.ConfirmCommand}"
                            IsEnabled="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToBoolConverter}, ConverterParameter='invert'}"
                            AutomationProperties.Name="ç¡®è®¤æŽ’ç­"
                            AutomationProperties.HelpText="ç¡®è®¤å¹¶åº”ç”¨æ­¤æŽ’ç­æ–¹æ¡ˆ"
                            ToolTipService.ToolTip="ç¡®è®¤æŽ’ç­"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Loading Indicator -->
        <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" Width="60" Height="60"
                      HorizontalAlignment="Center" VerticalAlignment="Center"/>

        <!-- Empty State -->
        <TextBlock Text="æœªåŠ è½½æŽ’ç­æ•°æ®"
                   Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter='invert', Mode=OneWay}"
                   HorizontalAlignment="Center" VerticalAlignment="Center" Style="{ThemeResource SubtitleTextBlockStyle}"/>
    </Grid>
</Page>
