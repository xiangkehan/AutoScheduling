<Page
    x:Class="AutoScheduling3.Views.Scheduling.ScheduleResultPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:AutoScheduling3.ViewModels.Scheduling"
    xmlns:controls="using:AutoScheduling3.Controls"
    xmlns:converters="using:AutoScheduling3.Converters"
    xmlns:dto="using:AutoScheduling3.DTOs"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    d:DataContext="{d:DesignInstance Type=viewmodels:ScheduleResultViewModel, IsDesignTimeCreatable=True}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:BoolToTextConverter x:Key="BoolToTextConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <converters:DateTimeFormatConverter x:Key="DateTimeFormatConverter"/>
        <converters:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
    </Page.Resources>

    <!-- 键盘快捷键 -->
    <Page.KeyboardAccelerators>
        <!-- Ctrl+F: 打开筛选 -->
        <KeyboardAccelerator Key="F" Modifiers="Control" Invoked="FilterAccelerator_Invoked"/>
        <!-- Ctrl+E: 导出 -->
        <KeyboardAccelerator Key="E" Modifiers="Control" Invoked="ExportAccelerator_Invoked"/>
        <!-- Ctrl+S: 保存更改 -->
        <KeyboardAccelerator Key="S" Modifiers="Control" Invoked="SaveAccelerator_Invoked"/>
        <!-- Esc: 关闭冲突面板 -->
        <KeyboardAccelerator Key="Escape" Invoked="EscapeAccelerator_Invoked"/>
    </Page.KeyboardAccelerators>

    <Grid>
        <!-- Main content visible when Schedule not null -->
        <Grid Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, Mode=OneWay}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header and Toolbar -->
            <StackPanel Grid.Row="0" Margin="24,24,24,12" Spacing="12">
                <!-- Title Section -->
                <StackPanel AutomationProperties.Name="排班结果标题区域" AutomationProperties.HeadingLevel="Level1">
                    <TextBlock Text="{x:Bind ViewModel.Schedule.Title, Mode=OneWay, FallbackValue='排班结果'}" 
                               Style="{ThemeResource TitleTextBlockStyle}"
                               AutomationProperties.Name="排班标题"
                               AutomationProperties.HeadingLevel="Level1"/>
                    <TextBlock Style="{ThemeResource BodyTextBlockStyle}" 
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               AutomationProperties.Name="排班日期范围">
                        <Run Text="{x:Bind ViewModel.Schedule.StartDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                        <Run Text=" 至 "/>
                        <Run Text="{x:Bind ViewModel.Schedule.EndDate, Mode=OneWay, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd'}"/>
                    </TextBlock>
                </StackPanel>

                <!-- Filter Toolbar -->
                <Grid x:Name="FilterToolbar"
                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                      BorderThickness="1" 
                      CornerRadius="8" 
                      Padding="16"
                      AutomationProperties.Name="筛选工具栏"
                      AutomationProperties.LandmarkType="Search">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Date Range Filter -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="日期:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="日期筛选标签"/>
                        <CalendarDatePicker x:Name="FilterStartDatePicker"
                                            PlaceholderText="开始日期"
                                            DateChanged="FilterStartDatePicker_DateChanged"
                                            AutomationProperties.Name="筛选开始日期"
                                            AutomationProperties.HelpText="选择筛选的开始日期"/>
                        <TextBlock Text="至" VerticalAlignment="Center"/>
                        <CalendarDatePicker x:Name="FilterEndDatePicker"
                                            PlaceholderText="结束日期"
                                            DateChanged="FilterEndDatePicker_DateChanged"
                                            AutomationProperties.Name="筛选结束日期"
                                            AutomationProperties.HelpText="选择筛选的结束日期"/>
                    </StackPanel>

                    <!-- Position Filter -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="哨位:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="哨位筛选标签"/>
                        <ComboBox x:Name="PositionFilterComboBox"
                                  MinWidth="150"
                                  ItemsSource="{x:Bind ViewModel.SelectedPositionIds}"
                                  IsEditable="False"
                                  PlaceholderText="选择哨位"
                                  AutomationProperties.Name="哨位筛选下拉框"
                                  AutomationProperties.HelpText="选择要筛选的哨位，可多选"/>
                    </StackPanel>

                    <!-- Personnel Search -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="0,0,16,0">
                        <TextBlock Text="人员:" 
                                   VerticalAlignment="Center"
                                   AutomationProperties.Name="人员搜索标签"/>
                        <AutoSuggestBox x:Name="PersonnelSearchBox"
                                        Text="{x:Bind ViewModel.PersonnelSearchText, Mode=TwoWay}"
                                        ItemsSource="{x:Bind ViewModel.PersonnelSuggestions, Mode=OneWay}"
                                        PlaceholderText="搜索或选择人员"
                                        MinWidth="200"
                                        QueryIcon="Find"
                                        TextChanged="PersonnelSearchBox_TextChanged"
                                        GotFocus="PersonnelSearchBox_GotFocus"
                                        SuggestionChosen="PersonnelSearchBox_SuggestionChosen"
                                        QuerySubmitted="PersonnelSearchBox_QuerySubmitted"
                                        AutomationProperties.Name="人员搜索框"
                                        AutomationProperties.HelpText="输入人员姓名进行模糊搜索，支持拼音首字母，或从下拉列表选择"
                                        ToolTipService.ToolTip="支持模糊搜索和拼音首字母匹配，点击展开显示所有人员">
                            <AutoSuggestBox.ItemTemplate>
                                <DataTemplate x:DataType="dto:PersonnelDto">
                                    <TextBlock Text="{x:Bind Name}" 
                                              Padding="8,4"
                                              VerticalAlignment="Center"/>
                                </DataTemplate>
                            </AutoSuggestBox.ItemTemplate>
                        </AutoSuggestBox>
                    </StackPanel>

                    <!-- Spacer -->
                    <Grid Grid.Column="4"/>

                    <!-- Filter Actions -->
                    <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="8">
                        <Button Content="应用筛选" 
                                Command="{x:Bind ViewModel.ApplyFiltersCommand}" 
                                Style="{ThemeResource AccentButtonStyle}"
                                AutomationProperties.Name="应用筛选按钮"
                                AutomationProperties.HelpText="应用当前设置的筛选条件"
                                ToolTipService.ToolTip="应用筛选 (Ctrl+F)"/>
                        <Button Content="重置" 
                                Command="{x:Bind ViewModel.ResetFiltersCommand}"
                                AutomationProperties.Name="重置筛选按钮"
                                AutomationProperties.HelpText="清除所有筛选条件并重新加载数据"
                                ToolTipService.ToolTip="重置筛选"/>
                    </StackPanel>
                </Grid>

                <!-- View Mode and Actions Toolbar -->
                <CommandBar Background="Transparent" 
                            DefaultLabelPosition="Right" 
                            HorizontalAlignment="Stretch"
                            AutomationProperties.Name="视图模式和操作工具栏"
                            AutomationProperties.LandmarkType="Navigation">
                    <CommandBar.Content>
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <!-- View Mode Selector -->
                            <StackPanel Orientation="Horizontal" 
                                        Spacing="8" 
                                        AutomationProperties.Name="视图模式选择"
                                        AutomationProperties.LandmarkType="Navigation">
                                <RadioButton x:Name="GridRadioButton" 
                                             Content="网格" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Grid}"
                                             AutomationProperties.Name="网格视图模式"
                                             AutomationProperties.HelpText="以表格形式展示排班结果，行为日期加时段，列为哨位"
                                             ToolTipService.ToolTip="网格视图"/>
                                <RadioButton x:Name="ListRadioButton" 
                                             Content="列表" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=List}"
                                             AutomationProperties.Name="列表视图模式"
                                             AutomationProperties.HelpText="以列表形式展示所有班次分配"
                                             ToolTipService.ToolTip="列表视图"/>
                                <RadioButton x:Name="ByPersonnelRadioButton" 
                                             Content="按人员" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=ByPersonnel}"
                                             AutomationProperties.Name="人员视图模式"
                                             AutomationProperties.HelpText="按人员分组展示每个人的班次安排"
                                             ToolTipService.ToolTip="人员视图"/>
                                <RadioButton x:Name="ByPositionRadioButton" 
                                             Content="按哨位" 
                                             IsChecked="{x:Bind ViewModel.CurrentViewMode, Mode=TwoWay, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=ByPosition}"
                                             AutomationProperties.Name="哨位视图模式"
                                             AutomationProperties.HelpText="按哨位分别展示排班表，每个哨位一张表"
                                             ToolTipService.ToolTip="哨位视图"/>
                            </StackPanel>
                        </StackPanel>
                    </CommandBar.Content>
                    <AppBarButton Icon="Save" 
                                  Label="导出" 
                                  Command="{x:Bind ViewModel.ExportExcelCommand}"
                                  AutomationProperties.Name="导出排班表"
                                  AutomationProperties.HelpText="导出排班结果为Excel、CSV或PDF文件"
                                  ToolTipService.ToolTip="导出 (Ctrl+E)"/>
                    <AppBarButton x:Name="FullScreenButton" 
                                  Icon="FullScreen" 
                                  Label="全屏" 
                                  Command="{x:Bind ViewModel.ToggleFullScreenCommand}"
                                  AutomationProperties.Name="全屏查看"
                                  AutomationProperties.HelpText="在全屏模式下查看排班表格"
                                  ToolTipService.ToolTip="全屏查看"/>
                    <AppBarButton x:Name="CompareButton" 
                                  Icon="TwoPage" 
                                  Label="比较" 
                                  Command="{x:Bind ViewModel.CompareSchedulesCommand}"
                                  AutomationProperties.Name="比较排班"
                                  AutomationProperties.HelpText="与历史排班方案进行比较"
                                  ToolTipService.ToolTip="比较排班"/>
                    <AppBarToggleButton Icon="Flag" 
                                        Label="冲突" 
                                        IsChecked="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                                        AutomationProperties.Name="冲突面板开关"
                                        AutomationProperties.HelpText="显示或隐藏冲突和警告面板"
                                        ToolTipService.ToolTip="冲突和警告"/>
                </CommandBar>
            </StackPanel>

            <!-- Main Content and Conflict Pane -->
            <SplitView Grid.Row="1"
                       IsPaneOpen="{x:Bind ViewModel.IsConflictPaneOpen, Mode=TwoWay}"
                       PanePlacement="Right"
                       DisplayMode="Inline"
                       OpenPaneLength="360">
                <SplitView.Pane>
                      <Grid BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                          BorderThickness="1,0,0,0" 
                          Padding="12"
                          AutomationProperties.Name="冲突管理面板"
                          AutomationProperties.LandmarkType="Custom">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Conflict Panel Header -->
                        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
                            <TextBlock Text="冲突管理" 
                                       Style="{ThemeResource SubtitleTextBlockStyle}"
                                       AutomationProperties.Name="冲突管理标题"
                                       AutomationProperties.HeadingLevel="Level2"/>
                        </StackPanel>

                        <!-- Conflict Statistics Cards -->
                        <Grid Grid.Row="1" Margin="0,0,0,12" AutomationProperties.Name="冲突统计卡片">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Hard Constraint Conflicts Card -->
                            <Border Grid.Row="0" Grid.Column="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource SystemFillColorCriticalBrush}" 
                                    BorderThickness="2" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="0,0,4,4"
                                    AutomationProperties.Name="硬约束冲突统计卡片">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="⚠ 硬约束冲突" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="硬约束冲突标签"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.HardConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                               AutomationProperties.Name="硬约束冲突数量"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Soft Constraint Conflicts Card -->
                            <Border Grid.Row="0" Grid.Column="1"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource SystemFillColorCautionBrush}" 
                                    BorderThickness="2" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="4,0,0,4"
                                    AutomationProperties.Name="软约束冲突统计卡片">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="⚠ 软约束冲突" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="软约束冲突标签"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.SoftConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               Foreground="{ThemeResource SystemFillColorCautionBrush}"
                                               AutomationProperties.Name="软约束冲突数量"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Unassigned Slots Card -->
                            <Border Grid.Row="1" Grid.Column="0"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="0,4,4,0"
                                    AutomationProperties.Name="未分配时段统计卡片">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="ℹ 未分配时段" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="未分配时段标签"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.UnassignedSlotCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               AutomationProperties.Name="未分配时段数量"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>

                            <!-- Ignored Conflicts Card -->
                            <Border Grid.Row="1" Grid.Column="1"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                    BorderThickness="1" 
                                    CornerRadius="8" 
                                    Padding="12"
                                    Margin="4,4,0,0"
                                    AutomationProperties.Name="已忽略冲突统计卡片">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="✓ 已忽略" 
                                               FontSize="12" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontWeight="SemiBold"
                                               AutomationProperties.Name="已忽略冲突标签"/>
                                    <TextBlock Text="{x:Bind ViewModel.ConflictStatistics.IgnoredConflictCount, Mode=OneWay, FallbackValue=0}" 
                                               FontSize="24" 
                                               FontWeight="Bold"
                                               AutomationProperties.Name="已忽略冲突数量"
                                               AutomationProperties.LiveSetting="Polite"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Filter and Sort Controls -->
                        <StackPanel Grid.Row="2" Spacing="8" Margin="0,0,0,12" AutomationProperties.Name="筛选和排序控件">
                            <!-- Type and Severity Filters -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Type Filter -->
                                <ComboBox Grid.Column="0"
                                          Header="类型"
                                          SelectedValue="{x:Bind ViewModel.ConflictTypeFilter, Mode=TwoWay}"
                                          PlaceholderText="全部"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="冲突类型筛选器"
                                          AutomationProperties.HelpText="按冲突类型筛选">
                                    <x:String>全部</x:String>
                                    <x:String>硬约束</x:String>
                                    <x:String>软约束</x:String>
                                    <x:String>信息</x:String>
                                    <x:String>未分配</x:String>
                                </ComboBox>

                                <!-- Severity Filter -->
                                <ComboBox Grid.Column="1"
                                          Header="严重程度"
                                          SelectedValue="{x:Bind ViewModel.ConflictSeverityFilter, Mode=TwoWay}"
                                          PlaceholderText="全部"
                                          HorizontalAlignment="Stretch"
                                          Margin="4,0,0,0"
                                          AutomationProperties.Name="严重程度筛选器"
                                          AutomationProperties.HelpText="按严重程度筛选">
                                    <x:String>全部</x:String>
                                    <x:String>5 - 最高</x:String>
                                    <x:String>4 - 高</x:String>
                                    <x:String>3 - 中</x:String>
                                    <x:String>2 - 低</x:String>
                                    <x:String>1 - 最低</x:String>
                                </ComboBox>
                            </Grid>

                            <!-- Sort and Search -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Sort By -->
                                <ComboBox Grid.Column="0"
                                          Header="排序"
                                          SelectedValue="{x:Bind ViewModel.ConflictSortBy, Mode=TwoWay}"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,0,4,0"
                                          AutomationProperties.Name="排序选择器"
                                          AutomationProperties.HelpText="选择排序方式">
                                    <x:String>按类型</x:String>
                                    <x:String>按日期</x:String>
                                    <x:String>按严重程度</x:String>
                                </ComboBox>

                                <!-- Search Box -->
                                <TextBox Grid.Column="1"
                                         Header="搜索"
                                         Text="{x:Bind ViewModel.ConflictSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         PlaceholderText="人员/哨位..."
                                         Margin="4,0,0,0"
                                         AutomationProperties.Name="冲突搜索框"
                                         AutomationProperties.HelpText="按人员或哨位名称搜索冲突"/>
                            </Grid>
                        </StackPanel>

                        <!-- Statistics Panel (Collapsible) -->
                        <Expander Grid.Row="3"
                                  Header="统计信息"
                                  IsExpanded="False"
                                  Margin="0,0,0,12"
                                  AutomationProperties.Name="统计信息面板"
                                  AutomationProperties.HeadingLevel="Level2">
                            <StackPanel Spacing="12" Margin="0,8,0,0">
                                <!-- Summary Stats -->
                                <Grid AutomationProperties.Name="统计摘要">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Border x:Name="TotalAssignmentsCard"
                                            Grid.Column="0" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="总分配数统计卡片"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="总分配数" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="总分配数标签"/>
                                            <TextBlock Text="{x:Bind ViewModel.Statistics.TotalAssignments, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="总分配数值"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>

                                    <Border x:Name="PersonnelCountCard"
                                            Grid.Column="1" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="参与人员数统计卡片"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="参与人员数" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="参与人员数标签"/>
                                            <TextBlock Text="{x:Bind ViewModel.PersonnelWorkloads.Count, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="参与人员数值"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>

                                    <Border x:Name="PositionCountCard"
                                            Grid.Column="2" 
                                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" 
                                            BorderThickness="1" 
                                            CornerRadius="8" 
                                            Padding="12"
                                            AutomationProperties.Name="参与哨位数统计卡片"
                                            PointerEntered="StatCard_PointerEntered"
                                            PointerExited="StatCard_PointerExited">
                                        <StackPanel>
                                            <TextBlock Text="参与哨位数" 
                                                       FontSize="12" 
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       AutomationProperties.Name="参与哨位数标签"/>
                                            <TextBlock Text="{x:Bind ViewModel.PositionCoverages.Count, Mode=OneWay, FallbackValue=0}" 
                                                       FontSize="24" 
                                                       FontWeight="Bold"
                                                       AutomationProperties.Name="参与哨位数值"
                                                       AutomationProperties.LiveSetting="Polite"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>

                                <!-- Personnel Workload Table -->
                                <StackPanel>
                                    <TextBlock Text="人员工作量" 
                                               FontWeight="SemiBold" 
                                               Margin="0,8,0,4"
                                               AutomationProperties.Name="人员工作量统计标题"
                                               AutomationProperties.HeadingLevel="Level3"/>
                                    <ListView ItemsSource="{x:Bind ViewModel.PersonnelWorkloads, Mode=OneWay}" 
                                              MaxHeight="200" 
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              AutomationProperties.Name="人员工作量统计表"
                                              AutomationProperties.LandmarkType="Custom">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding PersonnelName}" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding TotalShifts}" Margin="16,0" VerticalAlignment="Center"/>
                                                    <ProgressBar Grid.Column="2" Width="100" Value="{Binding TotalShifts}" Maximum="20" Margin="8,0"/>
                                                    <TextBlock Grid.Column="3"
                                                               Text="{Binding DayNightSummary}"
                                                               Margin="16,0,0,0"
                                                               VerticalAlignment="Center"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>

                                <!-- Position Coverage Table -->
                                <StackPanel>
                                    <TextBlock Text="哨位覆盖率" 
                                               FontWeight="SemiBold" 
                                               Margin="0,8,0,4"
                                               AutomationProperties.Name="哨位覆盖率统计标题"
                                               AutomationProperties.HeadingLevel="Level3"/>
                                    <ListView ItemsSource="{x:Bind ViewModel.PositionCoverages, Mode=OneWay}" 
                                              MaxHeight="200" 
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              AutomationProperties.Name="哨位覆盖率统计表"
                                              AutomationProperties.LandmarkType="Custom">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding PositionName}" VerticalAlignment="Center"/>
                                                    <ProgressBar Grid.Column="1" Width="100" Value="{Binding CoverageRate}" Maximum="1" Margin="8,0"/>
                                                    <TextBlock Grid.Column="2"
                                                               Text="{Binding CoverageRateDisplay}"
                                                               Margin="16,0,0,0"
                                                               VerticalAlignment="Center"
                                                               FontSize="12"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <!-- Conflict List with Grouping -->
                        <ScrollViewer Grid.Row="4" 
                                      Margin="0,0,0,0"
                                      AutomationProperties.Name="冲突列表区域">
                            <ItemsControl x:Name="ConflictListView"
                                          ItemsSource="{x:Bind ViewModel.FilteredConflicts, Mode=OneWay}"
                                          AutomationProperties.Name="冲突列表"
                                          AutomationProperties.LandmarkType="Custom"
                                          AutomationProperties.LiveSetting="Polite">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="dto:ConflictDto">
                                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                BorderThickness="1"
                                                CornerRadius="8"
                                                Padding="12"
                                                Margin="0,0,0,8"
                                                AutomationProperties.Name="{x:Bind Message}">
                                            <StackPanel Spacing="8">
                                                <!-- Conflict Header -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Icon based on type -->
                                                    <FontIcon Grid.Column="0"
                                                              Glyph="&#xE7BA;"
                                                              FontSize="16"
                                                              Margin="0,0,8,0"
                                                              VerticalAlignment="Top"
                                                              Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>

                                                    <!-- Conflict Type and Description -->
                                                    <StackPanel Grid.Column="1" Spacing="4">
                                                        <TextBlock Text="{x:Bind SubType, Converter={StaticResource ConflictSubTypeToTextConverter}}"
                                                                   FontWeight="SemiBold"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="冲突类型"/>
                                                        <TextBlock Text="{x:Bind Message}"
                                                                   FontSize="12"
                                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                                   TextWrapping="Wrap"
                                                                   AutomationProperties.Name="冲突描述"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Conflict Details -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Personnel Info -->
                                                    <StackPanel Grid.Column="0" Spacing="2">
                                                        <TextBlock Text="人员" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PersonnelName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>

                                                    <!-- Position Info -->
                                                    <StackPanel Grid.Column="1" Spacing="2">
                                                        <TextBlock Text="哨位" 
                                                                   FontSize="10" 
                                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PositionName, FallbackValue='-'}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </Grid>

                                                <!-- Date and Time Info -->
                                                <StackPanel Spacing="2">
                                                    <TextBlock Text="时间" 
                                                               FontSize="10" 
                                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                                    <TextBlock FontSize="12">
                                                        <Run Text="{x:Bind StartTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy-MM-dd HH:mm', FallbackValue='-'}"/>
                                                        <Run Text=" - "/>
                                                        <Run Text="{x:Bind EndTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='HH:mm', FallbackValue='-'}"/>
                                                    </TextBlock>
                                                </StackPanel>

                                                <!-- Action Buttons -->
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Button Grid.Column="0"
                                                            Content="定位" 
                                                            Tag="{x:Bind}"
                                                            Click="LocateConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="0,0,4,0"
                                                            AutomationProperties.Name="定位冲突"
                                                            AutomationProperties.HelpText="在表格中定位并高亮显示此冲突"
                                                            ToolTipService.ToolTip="定位冲突"/>

                                                    <Button Grid.Column="1"
                                                            Content="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToTextConverter}, ConverterParameter='取消忽略|忽略'}"
                                                            Tag="{x:Bind}"
                                                            Click="IgnoreConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,4,0"
                                                            AutomationProperties.Name="忽略或取消忽略冲突"
                                                            AutomationProperties.HelpText="将此冲突标记为已忽略或取消忽略"
                                                            ToolTipService.ToolTip="忽略/取消忽略"/>

                                                    <Button Grid.Column="2"
                                                            Content="修复" 
                                                            Tag="{x:Bind}"
                                                            Click="FixConflictButton_Click"
                                                            HorizontalAlignment="Stretch"
                                                            Margin="4,0,0,0"
                                                            IsEnabled="{x:Bind IsFixable}"
                                                            AutomationProperties.Name="修复冲突"
                                                            AutomationProperties.HelpText="打开修复对话框以解决此冲突"
                                                            ToolTipService.ToolTip="修复冲突"/>
                                                </Grid>

                                                <!-- Ignored Badge -->
                                                <Border Background="{ThemeResource SystemFillColorSuccessBrush}"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Left"
                                                        Visibility="{x:Bind IsIgnored, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="✓ 已忽略"
                                                               FontSize="10"
                                                               Foreground="White"
                                                               FontWeight="SemiBold"/>
                                                </Border>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Bottom Action Buttons -->
                        <StackPanel Grid.Row="5" 
                                    Orientation="Vertical" 
                                    Spacing="8" 
                                    Margin="0,12,0,0"
                                    AutomationProperties.Name="冲突操作按钮">
                            <Button Content="全部忽略软约束"
                                    Command="{x:Bind ViewModel.IgnoreAllSoftConflictsCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="全部忽略软约束冲突"
                                    AutomationProperties.HelpText="将所有软约束冲突标记为已忽略"
                                    ToolTipService.ToolTip="忽略所有软约束冲突"/>

                            <Button Content="导出冲突报告"
                                    Command="{x:Bind ViewModel.ExportConflictReportCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="导出冲突报告"
                                    AutomationProperties.HelpText="导出冲突报告为Excel或PDF文件"
                                    ToolTipService.ToolTip="导出冲突报告"/>

                            <Button Content="冲突趋势"
                                    Command="{x:Bind ViewModel.ShowConflictTrendCommand}"
                                    HorizontalAlignment="Stretch"
                                    AutomationProperties.Name="查看冲突趋势"
                                    AutomationProperties.HelpText="查看冲突趋势分析和统计"
                                    ToolTipService.ToolTip="查看冲突趋势"/>
                        </StackPanel>
                    </Grid>
                </SplitView.Pane>
                <SplitView.Content>
                    <Grid Padding="24,0,24,0"
                          AutomationProperties.Name="主内容区域"
                          AutomationProperties.LandmarkType="Main">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Grid View -->
                        <controls:ScheduleGridControl
                            Grid.Row="0"
                            GridData="{x:Bind ViewModel.GridData, Mode=OneWay}"
                            Visibility="{x:Bind GridRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="网格视图排班表"
                            AutomationProperties.LandmarkType="Main"/>

                        <!-- List View -->
                        <ListView x:Name="ShiftListView"
                                  Grid.Row="0"
                                  ItemsSource="{x:Bind ViewModel.ShiftList, Mode=OneWay}"
                                  Visibility="{x:Bind ListRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                  AutomationProperties.Name="列表视图班次列表"
                                  AutomationProperties.LandmarkType="Main">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="dto:ShiftListItem">
                                    <Grid Padding="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Date -->
                                        <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                            <TextBlock Text="{x:Bind Date, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='MM-dd'}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{x:Bind DateTimeDescription}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>

                                        <!-- Personnel and Position -->
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{x:Bind PersonnelName}" FontSize="16" FontWeight="SemiBold"/>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,4,0,0">
                                                <TextBlock Text="{x:Bind TimeSlot}" FontSize="12"/>
                                                <TextBlock Text="{x:Bind PositionName}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                <!-- Tags -->
                                                <Border Background="{ThemeResource AccentBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind IsManualAssignment, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="手动" FontSize="10" Foreground="White"/>
                                                </Border>
                                                <Border Background="{ThemeResource WarningBrush}" CornerRadius="4" Padding="4,2" Visibility="{x:Bind HasConflict, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <TextBlock Text="冲突" FontSize="10" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                            <Button Content="详情" 
                                                    Tag="{x:Bind}"
                                                    Click="ViewShiftDetailsButton_Click"
                                                    AutomationProperties.Name="查看班次详情"
                                                    AutomationProperties.HelpText="查看此班次的详细信息"
                                                    ToolTipService.ToolTip="查看详情"/>
                                            <Button Content="编辑" 
                                                    Tag="{x:Bind}"
                                                    Click="EditShiftButton_Click"
                                                    AutomationProperties.Name="编辑班次分配"
                                                    AutomationProperties.HelpText="修改此班次的人员分配"
                                                    ToolTipService.ToolTip="编辑分配"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!-- By Position View -->
                        <controls:PositionScheduleControl
                            Grid.Row="0"
                            ScheduleData="{x:Bind ViewModel.SelectedPositionSchedule, Mode=OneWay}"
                            Visibility="{x:Bind ByPositionRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="哨位视图排班表"
                            AutomationProperties.LandmarkType="Main"/>

                        <!-- By Personnel View -->
                        <Grid Grid.Row="0"
                              Visibility="{x:Bind ByPersonnelRadioButton.IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- 人员选择器 -->
                            <Grid Grid.Row="0" 
                                  Margin="0,0,0,12"
                                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                  BorderThickness="1"
                                  CornerRadius="8"
                                  Padding="16"
                                  AutomationProperties.Name="人员选择区域">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="选择人员:"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0"
                                           FontWeight="SemiBold"
                                           AutomationProperties.Name="人员选择标签"/>

                                <AutoSuggestBox Grid.Column="1"
                                                x:Name="PersonnelSelectorAutoSuggestBox"
                                                PlaceholderText="输入姓名或拼音首字母搜索..."
                                                ItemsSource="{x:Bind ViewModel.PersonnelSelectorSuggestions, Mode=OneWay}"
                                                Text="{x:Bind ViewModel.PersonnelSelectorSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Stretch"
                                                MinWidth="300"
                                                QueryIcon="Find"
                                                TextChanged="PersonnelSelectorAutoSuggestBox_TextChanged"
                                                SuggestionChosen="PersonnelSelectorAutoSuggestBox_SuggestionChosen"
                                                QuerySubmitted="PersonnelSelectorAutoSuggestBox_QuerySubmitted"
                                                GotFocus="PersonnelSelectorAutoSuggestBox_GotFocus"
                                                AutomationProperties.Name="人员选择搜索框"
                                                AutomationProperties.HelpText="输入姓名或拼音首字母搜索人员，支持模糊匹配"
                                                AutomationProperties.LiveSetting="Polite">
                                    <AutoSuggestBox.ItemTemplate>
                                        <DataTemplate x:DataType="dto:PersonnelScheduleData">
                                            <Grid Padding="8"
                                                  AutomationProperties.Name="{x:Bind PersonnelName}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{x:Bind PersonnelName}"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>

                                                <StackPanel Grid.Column="1"
                                                            Orientation="Horizontal"
                                                            Spacing="8">
                                                    <TextBlock Text="{x:Bind Workload.TotalShifts}"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                    <TextBlock Text="班次"
                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                               VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </AutoSuggestBox.ItemTemplate>
                                </AutoSuggestBox>
                            </Grid>

                            <!-- 人员排班详情控件 -->
                            <controls:PersonnelScheduleControl
                                Grid.Row="1"
                                ScheduleData="{x:Bind ViewModel.SelectedPersonnelSchedule, Mode=OneWay}"
                                AutomationProperties.Name="人员视图排班信息"
                                AutomationProperties.LandmarkType="Main"/>
                        </Grid>
                    </Grid>
                </SplitView.Content>
            </SplitView>

            <!-- Bottom Action Bar -->
            <Grid Grid.Row="2" 
                  Padding="24" 
                  Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  BorderThickness="0,1,0,0" 
                  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                  AutomationProperties.Name="底部操作栏"
                  AutomationProperties.LandmarkType="Navigation">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Unsaved Changes Warning -->
                <TextBlock Grid.Column="0"
                           Text="您有未保存的更改"
                           Foreground="{ThemeResource WarningBrush}"
                           VerticalAlignment="Center"
                           Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                           AutomationProperties.Name="未保存更改警告"
                           AutomationProperties.LiveSetting="Assertive"/>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <!-- Unsaved Changes Actions -->
                    <Button Content="撤销更改"
                            Command="{x:Bind ViewModel.DiscardChangesCommand}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="撤销更改"
                            AutomationProperties.HelpText="撤销所有未保存的更改"
                            ToolTipService.ToolTip="撤销更改"/>
                    <Button Content="保存更改"
                            Command="{x:Bind ViewModel.SaveChangesCommand}"
                            Style="{ThemeResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.HasUnsavedChanges, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            AutomationProperties.Name="保存更改"
                            AutomationProperties.HelpText="保存所有更改到数据库"
                            ToolTipService.ToolTip="保存更改 (Ctrl+S)"/>

                    <!-- Primary Actions -->
                    <Button Content="返回" 
                            Command="{x:Bind ViewModel.BackCommand}"
                            AutomationProperties.Name="返回"
                            AutomationProperties.HelpText="返回上一页"
                            ToolTipService.ToolTip="返回"/>
                    <Button Content="重新排班" 
                            Command="{x:Bind ViewModel.RescheduleCommand}"
                            AutomationProperties.Name="重新排班"
                            AutomationProperties.HelpText="重新生成排班方案"
                            ToolTipService.ToolTip="重新排班"/>
                    <Button Content="确认排班"
                            Style="{ThemeResource AccentButtonStyle}"
                            Command="{x:Bind ViewModel.ConfirmCommand}"
                            IsEnabled="{x:Bind ViewModel.Schedule.ConfirmedAt, Mode=OneWay, Converter={StaticResource NullToBoolConverter}, ConverterParameter=invert}"
                            AutomationProperties.Name="确认排班"
                            AutomationProperties.HelpText="确认并应用此排班方案"
                            ToolTipService.ToolTip="确认排班"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Loading Indicator -->
        <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" Width="60" Height="60"
                      HorizontalAlignment="Center" VerticalAlignment="Center"/>

        <!-- Empty State -->
        <TextBlock Text="未加载排班数据"
                   Visibility="{x:Bind ViewModel.Schedule, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert, Mode=OneWay}"
                   HorizontalAlignment="Center" VerticalAlignment="Center" Style="{ThemeResource SubtitleTextBlockStyle}"/>
    </Grid>
</Page>
