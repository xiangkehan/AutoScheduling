<ContentDialog
    x:Class="AutoScheduling3.Views.Scheduling.EditShiftAssignmentDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="修改班次分配"
    PrimaryButtonText="确定"
    SecondaryButtonText="取消"
    DefaultButton="Primary"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    Opened="ContentDialog_Opened"
    AutomationProperties.Name="修改班次分配对话框"
    AutomationProperties.HelpText="选择新的人员来替换当前班次的分配">
    
    <!-- 键盘快捷键 -->
    <ContentDialog.KeyboardAccelerators>
        <!-- Esc: 取消对话框 -->
        <KeyboardAccelerator Key="Escape" Invoked="EscapeAccelerator_Invoked"/>
        <!-- Enter: 确认选择 -->
        <KeyboardAccelerator Key="Enter" Invoked="EnterAccelerator_Invoked"/>
    </ContentDialog.KeyboardAccelerators>

    <ScrollViewer MaxHeight="600" MinWidth="550">
        <StackPanel Spacing="16">
            <!-- 当前分配 -->
            <StackPanel Spacing="8">
                <TextBlock Text="当前分配"
                           FontSize="16"
                           FontWeight="SemiBold"
                           AutomationProperties.Name="当前分配标题"
                           AutomationProperties.HeadingLevel="Level2"/>
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel Spacing="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="日期时间:"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="DateTimeText"
                                       Grid.Column="1"
                                       Text="2025-01-01 08:00-10:00"
                                       FontWeight="Medium"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="哨位:"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="PositionText"
                                       Grid.Column="1"
                                       Text="哨位1"
                                       FontWeight="Medium"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="当前人员:"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="CurrentPersonnelText"
                                       Grid.Column="1"
                                       Text="张三"
                                       FontWeight="Medium"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- 选择新人员 -->
            <StackPanel Spacing="8">
                <TextBlock Text="选择新人员"
                           FontSize="16"
                           FontWeight="SemiBold"
                           AutomationProperties.Name="选择新人员标题"
                           AutomationProperties.HeadingLevel="Level2"/>

                <!-- 搜索框 -->
                <AutoSuggestBox x:Name="SearchBox"
                                PlaceholderText="输入姓名搜索..."
                                QueryIcon="Find"
                                TextChanged="SearchBox_TextChanged"
                                AutomationProperties.Name="人员搜索框"
                                AutomationProperties.HelpText="输入人员姓名进行搜索筛选"
                                ToolTipService.ToolTip="搜索人员"/>

                <!-- 推荐人员提示 -->
                <Border x:Name="RecommendationPanel"
                        Background="{ThemeResource AccentFillColorDefaultBrush}"
                        Opacity="0.1"
                        BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12,8"
                        Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal"
                                Spacing="8">
                        <FontIcon Glyph="&#xE946;"
                                  FontSize="16"
                                  Foreground="{ThemeResource AccentFillColorDefaultBrush}"/>
                        <TextBlock x:Name="RecommendationText"
                                   Text="推荐人员: 李四 (技能匹配, 工作量适中)"
                                   Foreground="{ThemeResource AccentFillColorDefaultBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- 人员列表 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        MaxHeight="350">
                    <ListView x:Name="PersonnelListView"
                              SelectionMode="Single"
                              SelectionChanged="PersonnelListView_SelectionChanged"
                              AutomationProperties.Name="可用人员列表"
                              AutomationProperties.HelpText="选择要分配到此班次的人员"
                              AutomationProperties.LandmarkType="Custom">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8"
                                      ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 人员信息 -->
                                    <StackPanel Grid.Column="0"
                                                Spacing="4">
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="Medium"/>
                                        
                                        <StackPanel Orientation="Horizontal"
                                                    Spacing="12">
                                            <!-- 技能匹配状态 -->
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="4">
                                                <FontIcon Glyph="{Binding SkillMatchIcon}"
                                                          FontSize="12"
                                                          Foreground="{Binding SkillMatchColor}"/>
                                                <TextBlock Text="{Binding SkillMatchText}"
                                                           FontSize="12"
                                                           Foreground="{Binding SkillMatchColor}"/>
                                            </StackPanel>

                                            <!-- 可用性状态 -->
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="4">
                                                <FontIcon Glyph="{Binding AvailabilityIcon}"
                                                          FontSize="12"
                                                          Foreground="{Binding AvailabilityColor}"/>
                                                <TextBlock Text="{Binding AvailabilityText}"
                                                           FontSize="12"
                                                           Foreground="{Binding AvailabilityColor}"/>
                                            </StackPanel>

                                            <!-- 工作量 -->
                                            <TextBlock Text="{Binding WorkloadText}"
                                                       FontSize="12"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- 推荐标记 -->
                                    <Border Grid.Column="1"
                                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                                            CornerRadius="4"
                                            Padding="8,4"
                                            Visibility="{Binding IsRecommended, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBlock Text="推荐"
                                                   FontSize="12"
                                                   Foreground="White"
                                                   FontWeight="SemiBold"/>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
            </StackPanel>

            <!-- 验证错误提示 -->
            <InfoBar x:Name="ValidationErrorBar"
                     Severity="Error"
                     IsOpen="False"
                     IsClosable="True"
                     AutomationProperties.Name="验证错误提示"
                     AutomationProperties.LiveSetting="Assertive"/>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>
