# P1阶段功能完善实现计划

## 1. 筛选与搜索功能

### 1.1 创建筛选搜索栏组件
- 创建 `FilterSearchBar.xaml` 和代码后台
- 实现可折叠设计（默认折叠）
- 添加展开/折叠动画
- 集成到 `MainContentArea.xaml` 中

### 1.2 创建智能搜索框
- 使用AutoSuggestBox控件实现搜索建议
- 实现搜索历史记录（最近10条）
- 添加搜索防抖功能（300ms）

### 1.3 实现搜索逻辑
- 实现人员搜索（完整姓名、拼音首字母、模糊匹配）
- 实现哨位搜索
- 实现日期搜索（具体日期、相对日期）
- 实现关键词搜索（冲突、夜哨、手动）
- 实现组合搜索

### 1.4 创建快速筛选按钮
- 添加预设筛选按钮（日期范围、哨位、人员、时段类型、状态）
- 实现筛选条件的应用和清除
- 显示筛选结果数量

### 1.5 创建自定义筛选对话框
- 创建自定义筛选对话框UI
- 实现多维度筛选条件
- 实现筛选预设的保存和加载

## 2. 视图模式切换

### 2.1 创建列表视图组件
- 创建 `ListView.xaml` 和代码后台
- 使用ItemsRepeater实现虚拟化列表
- 实现排序和筛选功能
- 数据绑定到 `ViewModel.ScheduleList`

### 2.2 创建按人员视图组件
- 创建 `PersonnelView.xaml` 和代码后台
- 实现按人员分组显示
- 显示每个人员的所有班次
- 添加展开/折叠功能

### 2.3 创建按哨位视图组件
- 创建 `PositionView.xaml` 和代码后台
- 实现按哨位分组显示
- 显示每个哨位的所有班次
- 添加展开/折叠功能

### 2.4 实现视图模式切换逻辑
- 在ViewModel中实现 `ChangeViewModeCommand`
- 实现视图切换时保持筛选条件
- 实现视图切换时保持滚动位置
- 添加视图切换动画

### 2.5 实现视图模式模板选择器
- 创建 `ViewModeTemplateSelector.cs`
- 实现根据视图模式选择对应的DataTemplate
- 集成到MainContentArea

## 3. 右侧详情区 - 完整功能

### 3.1 创建班次编辑视图
- 创建 `ShiftEditView.xaml` 和代码后台
- 实现人员分配编辑
- 实现时段编辑
- 实现备注编辑

### 3.2 实现班次编辑保存逻辑
- 在ViewModel中实现 `SaveShiftEditCommand`
- 更新主内容区表格
- 更新左侧统计摘要
- 标记为有未保存更改

### 3.3 创建人员详情视图
- 创建 `PersonnelDetailView.xaml` 和代码后台
- 显示人员的详细排班日历
- 显示人员的统计信息（总班次、日哨/夜哨分布）

### 3.4 创建哨位详情视图
- 创建 `PositionDetailView.xaml` 和代码后台
- 显示哨位的详细排班日历
- 显示哨位的覆盖率统计

## 4. 底部操作栏 - 完整功能

### 4.1 实现更改历史对话框
- 创建更改历史对话框UI
- 显示所有未保存的更改列表
- 实现选择性撤销特定更改

### 4.2 实现返回功能
- 实现 `ReturnCommand`
- 检查未保存更改
- 显示确认对话框
- 导航回上一页面

### 4.3 实现确认排班功能
- 实现 `ConfirmScheduleCommand`
- 检查是否有冲突
- 显示确认对话框
- 更新排班状态为已确认

## 实现顺序建议

1. 首先实现筛选与搜索功能，因为这是用户最常用的功能之一
2. 然后实现视图模式切换，因为这会影响用户的整体体验
3. 接着实现右侧详情区的完整功能，因为这是用户查看和编辑详情的重要区域
4. 最后实现底部操作栏的完整功能，因为这是用户完成操作的最后一步

## 技术要点

- 使用MVVM模式，确保代码的可维护性和可测试性
- 实现虚拟化渲染，确保大数据量下的性能
- 实现防抖和节流，优化用户体验
- 确保各区域之间的同步更新
- 实现响应式设计，确保在不同屏幕尺寸下都能正常工作

## 注意事项

- 严格按照任务列表中的需求实现功能
- 确保代码符合项目的编码规范
- 确保每个组件职责单一，易于测试和维护
- 实现功能的同时，确保性能符合要求
- 确保所有功能都有适当的错误处理和用户反馈