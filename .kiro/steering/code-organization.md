---
inclusion: always
---

# 代码组织规范

## 文件大小限制

- **硬性限制**: 单个文件不超过 1000 行
- **推荐范围**: 300-600 行
- **强制拆分**: 超过 1000 行必须拆分，不得例外

## 文件拆分策略

### ViewModel 拆分

使用 partial class 按功能模块分离到不同文件：

- `{Name}ViewModel.cs` - 主文件（属性、构造函数）
- `{Name}ViewModel.Commands.cs` - 命令定义
- `{Name}ViewModel.Validation.cs` - 验证逻辑
- `{Name}ViewModel.Helpers.cs` - 辅助方法
- `{Name}ViewModel.{Feature}.cs` - 特定功能模块

**示例**: `ScheduleResultViewModel` 已拆分为 `Layout.cs`、`Conflicts.cs`、`Search.cs` 等

**替代方案**: 功能独立时，拆分为独立的 ViewModel 类

### Service 拆分

- 拆分为多个专门的 Service 类，每个负责单一职责
- 使用组合模式：主 Service 依赖注入子 Service
- 避免单个 Service 承担过多职责

**示例**: `DataImportExportService` 下有 `DataExportService`、`DataValidationService`、`DataMappingService` 等

### View (XAML) 拆分

- 拆分为多个 UserControl 组件
- 每个 UserControl 负责独立的 UI 区域或功能
- 通过数据绑定和命令与 ViewModel 交互

**示例**: `PersonnelCard`、`PositionCard`、`ScheduleGridControl` 等自定义控件

## 实现前设计要求

在实现新功能或重构前，必须先提供：

1. **文件结构设计**
   - 列出所有新增、修改、删除的文件
   - 每个文件的预估行数
   - 文件命名和位置

2. **目录结构检查**
   - 确认文件放置位置符合项目结构规范
   - 命名空间与目录结构一致
   - 避免创建不必要的深层嵌套（不超过 4 层）

3. **依赖关系说明**
   - 新增类的依赖注入需求
   - 与现有类的交互方式
   - 是否需要新增接口

## 代码质量最佳实践

### 类设计

- **单一职责原则**: 每个类只负责一个明确的功能
- **避免"上帝类"**: 类承担过多职责时必须拆分
- **Partial class 使用**: 仅用于同一类的不同关注点分离，不用于拆分无关功能

### 方法设计

- **方法长度**: 单个方法不超过 50 行
- **复杂方法**: 超过 30 行应考虑提取子方法
- **命名**: 方法名清晰表达意图，使用动词开头

### 命名空间

- **与目录一致**: 命名空间必须与文件所在目录结构一致
- **层级限制**: 不超过 4 层深度
- **示例**: `AutoScheduling3.ViewModels.Scheduling.ScheduleResultViewModel`

## UI 设计规范

设计或修改 UI 时，必须先使用 ASCII 字符绘制界面布局草稿，包括：

- 整体布局结构
- 主要控件位置
- 交互元素分布

**布局示例**:

```text
┌─────────────────────────────────────────────┐
│  标题栏                          [X]        │
├─────────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │ 按钮 1  │  │ 按钮 2  │  │ 按钮 3  │    │
│  └─────────┘  └─────────┘  └─────────┘    │
├─────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────────┐  │
│  │  左侧列表     │  │  右侧详情区域     │  │
│  │  - 项目 1     │  │                   │  │
│  │  - 项目 2     │  │  [输入框]         │  │
│  │  - 项目 3     │  │                   │  │
│  │               │  │  [下拉框]         │  │
│  └───────────────┘  └───────────────────┘  │
└─────────────────────────────────────────────┘
```

## 项目配置修改

**重要**: 修改 `AutoScheduling3.csproj` 项目文件前必须获得用户明确确认，包括：

- 添加或删除 NuGet 包引用
- 修改目标框架或平台
- 更改编译选项
- 添加或删除项目引用

## 文档管理规范

**禁止随意创建总结文档**: 

- 不要创建不必要的 markdown 总结文件
- 不要创建工作日志或进度记录文档
- 保持项目文件结构干净整洁
- 只在用户明确要求时才创建文档
- 已有的规范文档（如 `.kiro/steering/` 下的文件）除外
