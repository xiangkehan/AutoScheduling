# 任务29测试清单

## 测试目标
验证模板和草稿功能对遗传算法配置的支持是否完整且正常工作。

## 前置条件检查

### ✅ 任务24：模板功能支持遗传算法配置
- [x] `TemplateAlgorithmConfig` 类已创建
- [x] `GeneticAlgorithmConfigDto` 类已创建
- [x] `TemplateService` 支持保存和加载算法配置
- [x] `TemplateConfigCache` 已实现（10分钟过期）
- [x] `OptimizedConfigSerializer` 已实现

### ✅ 任务25：排班进度中断时保存草稿功能
- [x] `ScheduleDto` 包含进度相关字段（`ProgressPercentage`, `CurrentStage`, `IsPartialResult`）
- [x] `ScheduleDto` 包含 `SchedulingMode` 字段
- [ ] `SchedulingProgressViewModel` 实现自动保存功能（需要检查）
- [ ] `SchedulingService` 实现 `SaveProgressAsDraftAsync` 方法（需要检查）

### ✅ 任务26：从草稿恢复排班功能
- [ ] `SchedulingService` 实现 `GetDraftProgressAsync` 方法（需要检查）
- [ ] `SchedulingViewModel` 支持检测未完成草稿（需要检查）
- [ ] 恢复逻辑已实现（需要检查）

### ✅ 任务27：草稿列表页面显示算法信息
- [x] `ScheduleSummaryDto` 包含所需字段（`SchedulingMode`, `ProgressPercentage`, `IsResumable`）
- [x] `DraftsPage.xaml` 显示算法模式标签
- [x] `DraftsPage.xaml` 显示进度条
- [x] `DraftsPage.xaml` 显示可恢复标签
- [x] `DraftsPage.xaml` 实现分页控件
- [x] `DraftsPage.xaml` 实现过滤功能
- [x] `DraftsPage.xaml` 使用虚拟化列表
- [x] `DraftsViewModel` 实现分页逻辑
- [x] `PaginatedDraftLoader` 已实现

### ✅ 任务28：模板和草稿的算法配置验证
- [x] `GeneticConfigValidator` 已创建
- [x] `CachedConfigValidator` 已创建（带缓存）
- [x] `TemplateService` 在保存/使用模板时验证配置
- [x] 验证器已注册到依赖注入

## 功能测试项

### 1. 模板功能测试

#### 1.1 创建包含遗传算法配置的模板
- [ ] 打开模板管理页面
- [ ] 创建新模板
- [ ] 选择"混合模式"
- [ ] 配置遗传算法参数（种群大小、代数等）
- [ ] 保存模板
- [ ] 验证：模板成功保存，配置正确存储

#### 1.2 使用模板创建排班
- [ ] 选择包含遗传算法配置的模板
- [ ] 使用模板创建排班
- [ ] 验证：算法配置正确应用
- [ ] 验证：排班使用混合模式执行

#### 1.3 模板配置验证
- [ ] 尝试创建包含无效配置的模板（如种群大小=5）
- [ ] 验证：系统显示验证错误
- [ ] 验证：模板无法保存

#### 1.4 模板配置缓存
- [ ] 多次加载同一模板
- [ ] 验证：第二次加载速度明显提升
- [ ] 验证：缓存命中率统计正常

### 2. 草稿保存功能测试

#### 2.1 排班过程中保存草稿
- [ ] 开始一个排班任务（选择混合模式）
- [ ] 在排班进行中点击"保存草稿"按钮
- [ ] 验证：草稿成功保存
- [ ] 验证：进度百分比正确记录
- [ ] 验证：当前阶段正确记录

#### 2.2 自动保存功能
- [ ] 开始一个长时间排班任务
- [ ] 等待自动保存触发（2分钟或5%进度变化）
- [ ] 验证：自动保存成功
- [ ] 验证：显示上次保存时间
- [ ] 验证：自动保存不阻塞主线程

#### 2.3 取消排班保存草稿
- [ ] 开始排班任务
- [ ] 在进行中点击"取消"
- [ ] 验证：提示是否保存草稿
- [ ] 选择保存
- [ ] 验证：部分结果保存为草稿

### 3. 草稿恢复功能测试

#### 3.1 从草稿恢复排班
- [ ] 打开草稿列表
- [ ] 选择一个未完成的草稿（IsResumable=true）
- [ ] 点击"继续排班"按钮
- [ ] 验证：排班从中断点继续
- [ ] 验证：算法配置正确恢复
- [ ] 验证：进度正确显示

#### 3.2 智能恢复策略
- [ ] 测试进度<30%的草稿恢复（应该重启）
- [ ] 测试进度>=30%的草稿恢复（应该继续）
- [ ] 验证：恢复策略正确应用

### 4. 草稿列表功能测试

#### 4.1 显示算法信息
- [ ] 打开草稿列表页面
- [ ] 验证：每个草稿显示算法模式标签（GreedyOnly/Hybrid）
- [ ] 验证：未完成草稿显示进度条
- [ ] 验证：可恢复草稿显示"可恢复"标签

#### 4.2 分页功能
- [ ] 创建超过20个草稿
- [ ] 验证：列表分页显示
- [ ] 点击"下一页"
- [ ] 验证：显示第二页数据
- [ ] 验证：页码正确显示

#### 4.3 过滤功能
- [ ] 点击"过滤"按钮
- [ ] 选择"仅贪心"模式
- [ ] 点击"应用"
- [ ] 验证：只显示贪心模式的草稿
- [ ] 勾选"只显示可恢复的草稿"
- [ ] 验证：只显示可恢复的草稿
- [ ] 点击"清除"
- [ ] 验证：过滤条件清除，显示所有草稿

#### 4.4 虚拟化列表性能
- [ ] 创建大量草稿（>50个）
- [ ] 验证：列表滚动流畅
- [ ] 验证：加载速度快（使用虚拟化）

### 5. 配置验证功能测试

#### 5.1 模板配置验证
- [ ] 创建模板时输入无效的种群大小（如300）
- [ ] 验证：显示验证错误
- [ ] 输入无效的交叉率（如1.5）
- [ ] 验证：显示验证错误

#### 5.2 草稿配置验证
- [ ] 尝试恢复包含无效配置的草稿
- [ ] 验证：显示配置兼容性错误
- [ ] 验证：提供修复建议

#### 5.3 验证缓存功能
- [ ] 多次验证相同的配置
- [ ] 验证：第二次验证速度明显提升
- [ ] 验证：缓存命中率>90%

## 性能测试项

### 1. 模板加载性能
- [ ] 测试场景：加载包含复杂配置的模板
- [ ] 目标：缓存命中时提升 3-4倍
- [ ] 测量：首次加载时间 vs 缓存命中时间

### 2. 草稿保存性能
- [ ] 测试场景：保存大型排班草稿（100人×20哨位×7天）
- [ ] 目标：增量保存提升 8-10倍（从1-2秒降至0.1-0.2秒）
- [ ] 测量：保存时间

### 3. 草稿列表加载性能
- [ ] 测试场景：加载包含100个草稿的列表
- [ ] 目标：分页加载提升 8-10倍
- [ ] 测量：列表加载时间

### 4. 配置验证性能
- [ ] 测试场景：重复验证相同配置
- [ ] 目标：缓存命中时提升 90%+
- [ ] 测量：验证时间

## 集成测试项

### 1. 完整工作流测试
- [ ] 创建包含遗传算法配置的模板
- [ ] 使用模板创建排班
- [ ] 在排班过程中保存草稿
- [ ] 从草稿恢复并完成排班
- [ ] 确认排班
- [ ] 验证：整个流程顺畅无错误

### 2. 错误处理测试
- [ ] 测试配置文件损坏的情况
- [ ] 测试数据库连接失败的情况
- [ ] 测试并发保存草稿的情况
- [ ] 验证：错误处理正确，用户体验良好

## 测试结果

### 通过的测试
- [ ] 所有功能测试通过
- [ ] 所有性能测试达标
- [ ] 所有集成测试通过

### 发现的问题
（记录测试过程中发现的问题）

### 待修复的问题
（记录需要修复的问题）

## 测试结论

- [ ] 任务29所有测试通过
- [ ] 可以继续下一个任务

---

**测试日期**: ___________
**测试人员**: ___________
**测试环境**: Windows 10/11, .NET 8.0, WinUI 3
