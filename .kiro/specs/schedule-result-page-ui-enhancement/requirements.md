# 排哨结果页面UI增强 - 需求文档

## 简介

本需求文档定义了排哨结果页面的UI/UX改进方案。当前页面功能强大但信息密度过高，关键信息和冲突不够突出，操作流程略显复杂。本次改进旨在通过**优化布局**、**简化信息层级**和**增强数据可视化**来显著改善用户体验，让排班管理者能够更快速、更直观地洞察问题并进行决策。

**核心设计理念：三栏布局**
- **左侧导航/摘要区**：固定展示，提供稳定的导航锚点和关键统计摘要
- **中间主内容区**：排班表格作为绝对的视觉中心，占据最大面积
- **右侧上下文详情区**：动态显示当前选中项的详细信息和操作

**核心工作流**：`左侧发现问题 -> 中间定位问题 -> 右侧解决问题`

## 术语表

- **排班结果页面（Schedule Result Page）**：显示自动排班或手动排班完成后的结果页面
- **三栏布局（Three-Column Layout）**：左侧导航/摘要区、中间主内容区、右侧上下文详情区的布局结构
- **左侧导航/摘要区（Left Navigation/Summary Panel）**：固定显示的左侧区域，包含排班信息、统计摘要和冲突列表
- **统计摘要（Statistics Summary）**：显示硬约束冲突、软约束冲突、未分配班次等关键指标的可视化区域
- **冲突列表（Conflict List）**：左侧区域的冲突导航列表，点击可定位到表格并显示详情
- **主内容区（Main Content Area）**：中间区域，显示排班表格/列表，是页面的视觉中心
- **上下文详情区（Context Detail Panel）**：右侧动态显示区域，显示当前选中项的详细信息和操作
- **硬约束冲突（Hard Constraint Conflict）**：必须解决的约束违反，如技能不匹配、人员不可用
- **软约束警告（Soft Constraint Warning）**：建议解决的优化建议，如连续上班、工作量不均
- **覆盖率（Coverage Rate）**：已分配时段占总时段的百分比
- **筛选与搜索栏（Filter and Search Bar）**：主内容区顶部的可折叠筛选和搜索功能区
- **视图模式（View Mode）**：不同的数据展示方式，包括网格视图、列表视图、按人员视图、按哨位视图
- **底部操作栏（Bottom Action Bar）**：页面底部固定的操作栏，提供保存、确认等最终操作

## 需求

### 需求 1：左侧导航/摘要区

**用户故事：** 作为排班管理员，我希望在页面左侧始终能看到排班的基本信息、关键统计摘要和冲突列表，以便快速了解排班质量并导航到具体问题。

#### 验收标准

1. WHEN 用户进入排班结果页面 THEN 系统应在页面左侧固定显示导航/摘要区，宽度约占20-25%，始终可见
2. WHEN 左侧区域顶部显示时 THEN 系统应展示排班标题、状态（草稿/已确认）和日期范围
3. WHEN 左侧区域中部显示统计摘要时 THEN 系统应使用醒目的颜色和图标展示三项关键指标：硬约束冲突（🔴红色）、软约束冲突（🟡黄色）、未分配班次（⚫灰色）
4. WHEN 用户点击统计摘要中的任一指标 THEN 系统应在主内容区的表格中高亮显示所有对应项，并在冲突列表中进行筛选
5. WHEN 左侧区域下部显示冲突列表时 THEN 系统应按类型（硬约束/软约束）分组显示所有冲突，并显示冲突总数
6. WHEN 冲突列表显示时 THEN 系统应提供按类型排序和搜索功能
7. WHEN 用户点击冲突列表中的任一冲突项 THEN 系统应在主内容区的表格中自动定位到该冲突所在单元格并高亮
8. WHEN 用户点击冲突列表中的任一冲突项 THEN 系统应在右侧上下文详情区显示该冲突的详细信息和建议操作
9. WHEN 冲突列表中的冲突项被解决或忽略 THEN 系统应立即从列表中移除该项并更新统计摘要
10. WHEN 左侧区域宽度不足时 THEN 系统应支持折叠为图标模式，点击图标展开完整内容

### 需求 2：主内容区 - 筛选与搜索

**用户故事：** 作为排班管理员，我希望在主内容区顶部能够快速筛选和搜索特定的班次，以便专注于需要关注的数据。

#### 验收标准

1. WHEN 主内容区顶部显示时 THEN 系统应提供可折叠的"筛选与搜索"栏，默认折叠状态只显示入口按钮
2. WHEN 用户点击"筛选与搜索"入口按钮 THEN 系统应展开显示完整的筛选和搜索功能区
3. WHEN 筛选与搜索栏展开时 THEN 系统应提供统一搜索框，支持人员、哨位、日期和关键词搜索
4. WHEN 用户在搜索框中输入文本 THEN 系统应在300ms防抖后实时显示搜索建议下拉列表
5. WHEN 用户输入人员姓名（完整或部分）或拼音首字母 THEN 系统应返回匹配的人员及其班次数量
6. WHEN 用户输入哨位名称（完整或部分） THEN 系统应返回匹配的哨位及其班次数量
7. WHEN 用户输入日期或相对日期关键词（如"今天"、"本周"） THEN 系统应返回对应时间范围的班次
8. WHEN 用户输入特殊关键词（如"冲突"、"夜哨"、"手动"） THEN 系统应返回对应类型的班次
9. WHEN 筛选与搜索栏展开时 THEN 系统应提供快速筛选按钮：日期范围、哨位、人员、时段类型、状态
10. WHEN 用户应用筛选条件 THEN 系统应在主内容区表格中只显示符合条件的班次
11. WHEN 用户点击"重置"按钮 THEN 系统应清除所有筛选条件，恢复显示全部数据
12. WHEN 筛选条件生效 THEN 系统应在筛选栏显示当前筛选结果数量
13. WHEN 用户按下Esc键 THEN 系统应折叠筛选与搜索栏

### 需求 3：右侧上下文详情区

**用户故事：** 作为排班管理员，我希望在右侧区域能够查看和操作当前选中项的详细信息，以便快速解决问题或编辑班次。

#### 验收标准

1. WHEN 用户未选中任何项 THEN 系统应在右侧上下文详情区显示欢迎信息或隐藏该区域
2. WHEN 用户在左侧冲突列表中选中一个冲突 THEN 系统应在右侧详情区显示该冲突的详细描述
3. WHEN 冲突详情显示时 THEN 系统应包含涉及的人员、哨位、时间、规则说明和违反原因
4. WHEN 冲突详情显示时 THEN 系统应提供建议的修复操作按钮：替换人员、调整班次、标记为忽略
5. WHEN 用户点击"定位到表格"按钮 THEN 系统应在主内容区表格中高亮显示该冲突所在单元格
6. WHEN 用户在主内容区表格中选中一个班次单元格 THEN 系统应在右侧详情区显示班次编辑界面
7. WHEN 班次编辑界面显示时 THEN 系统应允许用户修改人员分配、时段和备注信息
8. WHEN 用户在主内容区表格中选中一个人员 THEN 系统应在右侧详情区显示该人员的详细排班日历和统计信息
9. WHEN 用户在主内容区表格中选中一个哨位 THEN 系统应在右侧详情区显示该哨位的详细排班日历和覆盖率统计
10. WHEN 用户在右侧详情区执行操作（如修复冲突、编辑班次） THEN 系统应立即更新主内容区表格和左侧统计摘要
11. WHEN 右侧详情区宽度可调整 THEN 系统应支持拖拽调整宽度，默认占25-30%
12. WHEN 用户点击右侧详情区的关闭按钮 THEN 系统应隐藏该区域，主内容区自动扩展

### 需求 4：主内容区 - 视图模式切换

**用户故事：** 作为排班管理员，我希望能够在不同的视图模式之间切换（网格、列表、按人员、按哨位），以便从不同角度查看排班数据。

#### 验收标准

1. WHEN 主内容区工具栏显示时 THEN 系统应提供紧凑的视图模式切换按钮组（SegmentedControl）：网格、列表、按人员、按哨位
2. WHEN 用户选择网格视图 THEN 系统应以表格形式显示，行为日期+时段，列为哨位
3. WHEN 用户选择列表视图 THEN 系统应以列表形式显示所有班次，支持排序和筛选
4. WHEN 用户选择按人员视图 THEN 系统应按人员分组显示，每个人员下显示其所有班次
5. WHEN 用户选择按哨位视图 THEN 系统应按哨位分组显示，每个哨位下显示其所有班次
6. WHEN 用户切换视图模式 THEN 系统应保持当前的筛选条件和搜索状态
7. WHEN 用户切换视图模式 THEN 系统应尽可能保持滚动位置或定位到相同的数据项
8. WHEN 用户按下Ctrl+1/2/3/4 THEN 系统应快速切换到对应的视图模式
9. WHEN 工具栏显示时 THEN 系统应在视图切换器旁边提供全局操作按钮：导出、比较、全屏
10. WHEN 用户点击"全屏"按钮 THEN 系统应隐藏左侧和右侧区域，主内容区占据全屏

### 需求 5：主内容区 - 排班表格展示

**用户故事：** 作为排班管理员，我希望主内容区的排班表格能够清晰地展示所有班次，并直观地标识冲突，以便快速识别问题。

#### 验收标准

1. WHEN 主内容区表格显示时 THEN 系统应占据页面的最大面积，成为视觉中心
2. WHEN 表格单元格包含硬约束冲突 THEN 系统应显示红色边框和🔴图标
3. WHEN 表格单元格包含软约束警告 THEN 系统应显示黄色边框和🟡图标
4. WHEN 用户悬停在冲突单元格上 THEN 系统应显示工具提示，包含冲突类型和简要说明
5. WHEN 用户点击表格单元格 THEN 系统应在右侧上下文详情区显示该单元格的详细信息
6. WHEN 用户点击冲突单元格 THEN 系统应在右侧详情区显示冲突详情和修复建议
7. WHEN 左侧冲突列表中的冲突被选中 THEN 系统应在表格中高亮显示对应的单元格
8. WHEN 左侧统计摘要中的指标被点击 THEN 系统应在表格中高亮显示所有对应的单元格
9. WHEN 表格数据量较大 THEN 系统应使用虚拟滚动技术，只渲染可见行
10. WHEN 用户在表格中右键点击单元格 THEN 系统应显示快速操作菜单：编辑、复制、删除、查看详情

### 需求 6：底部操作栏

**用户故事：** 作为排班管理员，我希望在页面底部能够执行最终的保存、确认等操作，并能看到未保存更改的提示。

#### 验收标准

1. WHEN 页面底部显示时 THEN 系统应固定显示底部操作栏
2. WHEN 用户对排班进行修改 THEN 系统应在底部操作栏显示"您有未保存的更改"提示
3. WHEN 底部操作栏显示未保存更改提示时 THEN 系统应提供撤销、保存、返回、确认排班按钮
4. WHEN 用户点击"撤销"按钮 THEN 系统应撤销最近一次更改并更新显示
5. WHEN 用户点击"保存"按钮 THEN 系统应保存所有更改为草稿状态
6. WHEN 用户点击"返回"按钮 THEN 系统应显示确认对话框，确认后返回上一页面
7. WHEN 用户点击"确认排班"按钮 THEN 系统应显示确认对话框，确认后将排班状态更改为已确认
8. WHEN 用户按下Ctrl+Z THEN 系统应执行撤销操作
9. WHEN 用户按下Ctrl+S THEN 系统应保存所有更改
10. WHEN 排班状态为已确认 THEN 系统应在底部操作栏显示"已确认"状态，并禁用编辑功能

### 需求 7：三栏布局响应式设计

**用户故事：** 作为排班管理员，我希望页面能够适配不同的屏幕尺寸，并能够灵活调整各区域的宽度，以便在不同设备和场景下都能获得良好的使用体验。

#### 验收标准

1. WHEN 屏幕宽度大于等于1920px THEN 系统应显示完整的三栏布局：左侧20%、中间55%、右侧25%
2. WHEN 屏幕宽度在1366px-1920px之间 THEN 系统应显示三栏布局：左侧20%、中间60%、右侧20%
3. WHEN 屏幕宽度在1024px-1366px之间 THEN 系统应默认隐藏右侧详情区，左侧15%、中间85%
4. WHEN 屏幕宽度小于1024px THEN 系统应将左侧区域折叠为图标模式，中间区域占据主要空间
5. WHEN 用户拖拽左侧区域的右边界 THEN 系统应允许调整左侧区域宽度，范围为15%-30%
6. WHEN 用户拖拽右侧区域的左边界 THEN 系统应允许调整右侧区域宽度，范围为20%-40%
7. WHEN 用户调整区域宽度 THEN 系统应保存用户偏好，下次打开时恢复
8. WHEN 用户点击左侧区域的折叠按钮 THEN 系统应将左侧区域折叠为图标模式，中间区域自动扩展
9. WHEN 用户点击右侧区域的关闭按钮 THEN 系统应隐藏右侧区域，中间区域自动扩展
10. WHEN 用户调整窗口大小 THEN 系统应平滑过渡到对应的响应式布局

### 需求 8：交互联动机制

**用户故事：** 作为排班管理员，我希望三个区域之间能够智能联动，以便实现"左侧发现问题 -> 中间定位问题 -> 右侧解决问题"的流畅工作流。

#### 验收标准

1. WHEN 用户在左侧统计摘要中点击硬约束冲突指标 THEN 系统应在中间表格中高亮所有硬约束冲突单元格，并在左侧冲突列表中只显示硬约束冲突
2. WHEN 用户在左侧冲突列表中选中一个冲突 THEN 系统应在中间表格中自动滚动并高亮该冲突所在单元格，并在右侧详情区显示冲突详情
3. WHEN 用户在中间表格中点击一个冲突单元格 THEN 系统应在左侧冲突列表中高亮对应的冲突项，并在右侧详情区显示冲突详情
4. WHEN 用户在右侧详情区执行修复操作 THEN 系统应立即更新中间表格的单元格状态，并从左侧冲突列表中移除该冲突
5. WHEN 用户在右侧详情区编辑班次 THEN 系统应立即更新中间表格的单元格内容
6. WHEN 用户在中间表格中选中一个人员或哨位 THEN 系统应在右侧详情区显示该人员或哨位的详细信息
7. WHEN 用户在筛选与搜索栏中应用筛选条件 THEN 系统应同时更新中间表格的显示和左侧统计摘要的数据
8. WHEN 冲突被解决或忽略 THEN 系统应同步更新左侧统计摘要、左侧冲突列表、中间表格标记和右侧详情区
9. WHEN 用户在任一区域执行操作导致数据变化 THEN 系统应在200ms内完成所有区域的同步更新
10. WHEN 用户在中间表格中使用键盘导航（方向键） THEN 系统应同步更新右侧详情区显示当前选中单元格的信息

### 需求 9：性能优化

**用户故事：** 作为排班管理员，我希望页面能够流畅地处理大量数据，以便在查看包含数百个班次的排班时不会出现卡顿。

#### 验收标准

1. WHEN 中间表格显示大量数据 THEN 系统应使用虚拟滚动技术，只渲染可见行
2. WHEN 左侧冲突列表显示大量数据 THEN 系统应使用虚拟化技术，只渲染可见项
3. WHEN 用户在搜索框中输入 THEN 系统应使用300ms防抖，避免频繁触发搜索
4. WHEN 用户滚动表格 THEN 系统应使用100ms节流，优化滚动性能
5. WHEN 用户调整窗口大小或拖拽区域边界 THEN 系统应使用200ms节流，优化布局计算
6. WHEN 右侧详情区首次显示某类内容 THEN 系统应按需加载内容，而非预加载所有可能的详情
7. WHEN 左侧统计摘要数据更新 THEN 系统应使用缓存机制，避免重复计算
8. WHEN 三个区域需要同步更新 THEN 系统应使用批量更新机制，一次性完成所有更新
9. WHEN 用户快速切换选中项 THEN 系统应使用防抖机制，避免频繁更新右侧详情区

### 需求 10：键盘快捷键支持

**用户故事：** 作为排班管理员，我希望能够使用键盘快捷键快速执行常用操作，以便提高工作效率。

#### 验收标准

1. WHEN 用户按下Ctrl+F THEN 系统应展开筛选与搜索栏并聚焦到搜索框
2. WHEN 用户按下Ctrl+E THEN 系统应打开导出对话框
3. WHEN 用户按下Ctrl+L THEN 系统应切换左侧导航/摘要区的显示/隐藏状态
4. WHEN 用户按下Ctrl+R THEN 系统应切换右侧上下文详情区的显示/隐藏状态
5. WHEN 用户按下Esc THEN 系统应折叠筛选与搜索栏或关闭当前对话框
6. WHEN 用户按下F11 THEN 系统应进入或退出全屏模式（隐藏左右两侧区域）
7. WHEN 用户按下Ctrl+1/2/3/4 THEN 系统应快速切换到对应的视图模式
8. WHEN 用户在表格中按下方向键 THEN 系统应移动选中的单元格，并在右侧详情区显示对应信息
9. WHEN 用户在表格中按下Enter THEN 系统应在右侧详情区打开编辑界面
10. WHEN 用户在表格中按下Space THEN 系统应在右侧详情区显示选中单元格的详情
11. WHEN 用户在左侧冲突列表中按下方向键 THEN 系统应移动选中的冲突项，并同步更新中间表格和右侧详情区
12. WHEN 用户按下Ctrl+Z THEN 系统应执行撤销操作
13. WHEN 用户按下Ctrl+S THEN 系统应保存所有更改

### 需求 11：可访问性支持

**用户故事：** 作为使用辅助技术的排班管理员，我希望页面能够支持屏幕阅读器和键盘导航，以便我能够无障碍地使用系统。

#### 验收标准

1. WHEN 页面加载完成 THEN 系统应为所有交互元素添加AutomationProperties.Name属性
2. WHEN 页面包含重要区域 THEN 系统应添加AutomationProperties.LandmarkType属性
3. WHEN 页面内容动态更新 THEN 系统应添加AutomationProperties.LiveSetting属性，通知屏幕阅读器
4. WHEN 用户使用Tab键导航 THEN 系统应按照合理的顺序移动焦点
5. WHEN 元素获得焦点 THEN 系统应显示清晰的焦点指示器
6. WHEN 页面使用颜色区分信息 THEN 系统应同时使用图标或文字标识，不仅依赖颜色
7. WHEN 页面显示文字 THEN 系统应确保文字和背景的对比度大于等于4.5:1
8. WHEN 用户调整系统字体大小 THEN 系统应支持字体缩放，保持布局可用性
