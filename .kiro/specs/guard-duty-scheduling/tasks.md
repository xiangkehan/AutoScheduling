# 哨位排班系统实施计划

## 任务概述

本实施计划将哨位排班系统的开发分解为一系列可执行的编程任务。每个任务都基于需求文档和设计文档，按照增量开发的方式组织，确保每一步都能构建在前一步的基础上。

## 实施任务

- [x] 1. 建立项目基础架构和依赖注入
  - 配置依赖注入容器，注册所有服务和仓储接口
  - 创建基础的 ViewModelBase 类和通用服务接口
  - 设置项目结构和命名空间
  - _需求: 1.1, 1.2, 1.3_

- [x] 2. 实现数据模型和数据访问层
  - [x] 2.1 创建核心数据模型类
    - 实现 Personal、PositionLocation、Skill、Schedule、SingleShift 等模型类
    - 添加数据验证特性和属性
    - _需求: 1.1, 2.1, 2.2_

  - [x] 2.2 实现 Repository 接口和基础实现
    - 创建 IPersonalRepository、IPositionLocationRepository、ISkillRepository 等接口
    - 实现 SQLite 数据访问的具体 Repository 类
    - 添加基础的 CRUD 操作方法
    - _需求: 1.2, 2.1, 2.2_

  - [x] 2.3 创建数据库初始化和迁移逻辑
    - 实现数据库表创建脚本
    - 添加索引和约束
    - 创建数据库版本管理机制
    - _需求: 1.2, 2.1_

  - [x] 2.4 编写 Repository 层单元测试
    - 测试 CRUD 操作的正确性
    - 测试数据验证和约束
    - _需求: 1.2, 2.1, 2.2_

- [x] 3. 实现 DTO 和映射层





  - [x] 3.1 创建数据传输对象 (DTOs)






    - 实现 PersonnelDto、PositionDto、SkillDto、ScheduleDto 等
    - 添加验证特性和序列化配置
    - _需求: 2.1, 2.2, 3.1_

  - [x] 3.2 实现 Model 到 DTO 的映射器
















    - 创建 PersonnelMapper、PositionMapper、ScheduleMapper 等
    - 实现双向转换方法 (ToDto/ToModel)
    - _需求: 2.1, 2.2, 3.1_

  - [ ]* 3.3 编写映射器单元测试
    - 测试映射的正确性和完整性
    - 测试边界情况和空值处理
    - _需求: 2.1, 2.2, 3.1_



- [x] 4. 实现业务逻辑服务层



  - [x] 4.1 实现人员管理服务

    - 创建 PersonnelService 类，实现 IPersonnelService 接口
    - 实现人员的增删改查业务逻辑
    - 添加业务规则验证（技能匹配、可用性检查等）
    - _需求: 2.1, 2.2_

  - [x] 4.2 实现哨位管理服务


    - 创建 PositionService 类，实现 IPositionService 接口
    - 实现哨位的增删改查业务逻辑
    - 添加哨位技能要求验证
    - _需求: 1.1, 2.2_



  - [x] 4.3 实现技能管理服务



    - 创建 SkillService 类，实现 ISkillService 接口
    - 实现技能的增删改查业务逻辑




    - 添加技能关联检查（删除时检查是否被使用）
    - _需求: 2.2_


  - [x] 4.4 实现约束管理服务



    - 创建 ConstraintService 类，管理休息日配置、定岗规则、手动指定
    - 实现约束的增删改查和验证逻辑
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8_



  - [ ] 4.5 实现排班服务主逻辑

    - 创建 SchedulingService 类，整合排班引擎和历史管理
    - 实现排班请求处理、结果保存、确认流程
    - _需求: 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_

  - [ ]* 4.6 编写服务层单元测试
    - 测试业务逻辑的正确性
    - 使用 Mock 对象测试服务间依赖
    - _需求: 2.1, 2.2, 5.1-5.8_


- [x] 5. 实现排班引擎核心算法






  - [x] 5.1 实现硬约束验证器


    - 创建 ConstraintValidator 类，实现所有硬约束检查
    - 实现夜哨唯一、时段不连续、人员可用、技能匹配等约束
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8_

  - [x] 5.2 实现软约束评分计算器


    - 创建 SoftConstraintCalculator 类，计算充分休息、休息日平衡、时段平衡得分
    - 实现评分算法和权重配置
    - _需求: 6.1, 6.2, 6.3, 6.4_

  - [x] 5.3 实现可行张量管理


    - 创建三维可行张量数据结构
    - 实现二进制存储和逐位与运算
    - 使用 MathNet.Numerics 优化计算性能
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [x] 5.4 实现贪心排班算法


    - 创建 GreedyScheduler 类，实现核心排班算法
    - 按照先哨位再时段的顺序进行人员分配
    - 集成硬约束验证和软约束评分
    - _需求: 3.1, 3.2, 5.1-5.8, 6.1-6.4, 7.1-7.5_

  - [ ]* 5.5 编写排班引擎单元测试
    - 测试约束验证的正确性
    - 测试算法在各种场景下的表现
    - 测试性能和内存使用
    - _需求: 3.1, 3.2, 5.1-5.8, 6.1-6.4, 7.1-7.5_

- [x] 6. 实现历史管理功能
  - [x] 6.1 实现历史管理服务
    - 创建 HistoryService 类，管理排班历史和缓冲区
    - 实现草稿保存、确认排班、历史查询功能
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [x] 6.2 实现排班服务主逻辑
    - 创建 SchedulingService 类，整合排班引擎和历史管理
    - 实现排班请求处理、结果保存、确认流程
    - _需求: 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_

  - [ ]* 6.3 编写历史管理单元测试
    - 测试草稿和历史的正确管理
    - 测试数据一致性和事务处理
    - _需求: 4.1, 4.2, 4.3, 4.4_

- [ ] 7. 实现模板管理功能

  - [ ] 7.1 创建模板数据模型和仓储
    - 实现 SchedulingTemplate 模型和 SchedulingTemplateRepository
    - 添加模板的增删改查功能
    - _需求: 3.1, 3.2_

  - [ ] 7.2 实现模板服务逻辑
    - 创建 TemplateService 类，实现模板管理业务逻辑
    - 实现模板验证、使用统计、复制功能
    - _需求: 3.1, 3.2_

  - [ ]* 7.3 编写模板管理单元测试
    - 测试模板的创建、使用、验证功能
    - 测试模板与排班的集成
    - _需求: 3.1, 3.2_

- [x] 8. 创建基础 UI 框架和导航
  - [x] 8.1 设置主窗口和导航框架
    - 实现 MainWindow 和 NavigationView 结构
    - 配置页面路由和导航服务
    - 应用 Fluent Design 主题和样式
    - _需求: 1.1, 1.2, 1.3_

  - [x] 8.2 创建共享 UI 组件
    - 实现 LoadingIndicator、EmptyState、ErrorState 控件
    - 创建 PersonnelCard、PositionCard 自定义控件
    - _需求: 1.1, 1.2, 1.3_

  - [x] 8.3 实现基础 ViewModel 类
    - 创建 ViewModelBase 基类，实现 INotifyPropertyChanged
    - 创建 RelayCommand 和异步命令支持
    - _需求: 1.1, 1.2, 1.3_

- [x] 9. 实现数据管理页面
  - [x] 9.1 创建人员管理页面
    - 实现 PersonnelPage.xaml 和 PersonnelViewModel
    - 添加人员列表显示、搜索筛选、增删改功能
    - 集成表单验证和错误处理
    - _需求: 2.1, 2.2_

  - [x] 9.2 创建哨位管理页面
    - 实现 PositionPage.xaml 和 PositionViewModel
    - 添加哨位列表显示、技能配置、增删改功能
    - _需求: 1.1, 2.2_

  - [x] 9.3 创建技能管理页面
    - 实现 SkillPage.xaml 和 SkillViewModel
    - 添加技能列表显示和内联编辑功能
    - _需求: 2.2_

  - [ ] 9.4 创建约束配置页面（优先级：高）
    - 实现 ConstraintPage.xaml，包含休息日配置、定岗规则、手动指定标签页
    - 实现相应的 ViewModel 和业务逻辑
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8_

- [x] 10. 实现排班管理页面
  - [x] 10.1 创建排班创建向导页面
    - 实现 CreateSchedulingPage.xaml 和 SchedulingViewModel
    - 实现5步向导流程：时间范围、人员选择、哨位选择、约束配置、确认执行
    - 添加参数验证和步骤导航
    - _需求: 3.1, 3.2_

  - [x] 10.2 实现排班结果显示页面
    - 创建 ScheduleResultPage.xaml 和 ScheduleResultViewModel
    - 实现排班表网格视图，支持冲突显示和交互操作
    - 添加保存草稿、确认排班功能
    - _需求: 3.1, 3.2, 4.1, 4.2, 4.3, 4.4_

  - [x] 10.3 创建排班模板管理页面
    - 实现 TemplatePage.xaml 和 TemplateViewModel
    - 添加模板列表、创建、编辑、使用功能
    - 实现模板验证和统计显示
    - _需求: 3.1, 3.2_

  - [x] 10.4 创建草稿箱页面
    - 实现 DraftsPage.xaml 和 DraftsViewModel
    - 显示未确认的排班草稿，支持查看、确认、删除操作
    - _需求: 4.1, 4.2, 4.3, 4.4_

- [x] 11. 实现历史记录页面
  - [x] 11.1 创建历史列表页面
    - 实现 HistoryListPage.xaml 和 HistoryListViewModel
    - 添加时间线视图和列表视图切换
    - 实现日期范围筛选和搜索功能
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [x] 11.2 创建历史详情页面
    - 实现 HistoryDetailPage.xaml 和 HistoryDetailViewModel
    - 显示排班表详情和统计信息
    - 添加导出功能
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [x] 11.3 实现排班对比功能
    - 创建 ComparisonPage.xaml，支持两个排班表的对比
    - 实现差异高亮和统计对比
    - _需求: 4.1, 4.2, 4.3, 4.4_
- [x] 3. 完善映射器实现（优先级：高）

- [x] 3. 完善映射器实现（优先级：高）




  - [x] 3.2 完成 PersonnelMapper 实现

    - 实现 PersonnelMapper 的 ToDtoAsync 和 ToDtoListAsync 方法
    - 添加技能名称映射和验证逻辑
    - _需求: 2.1, 2.2_

  - [x] 3.3 完成 PositionMapper 实现

    - 实现 PositionMapper 的完整映射逻辑
    - 添加技能要求的双向转换
    - _需求: 1.1, 2.2_

  - [x] 3.4 完成 ScheduleMapper 实现


    - 实现 ScheduleMapper 的复杂对象映射
    - 处理 SingleShift 集合的映射和验证
    - _需求: 3.1, 3.2_

- [ ] 12. 实现核心 UI 组件（优先级：高）
  - [x] 12.1 创建排班网格控件





    - 实现 ScheduleGridControl.xaml，支持大数据量虚拟化渲染
    - 添加拖拽交换、右键菜单、冲突显示功能
    - 实现响应式布局和性能优化
    - _需求: 3.1, 3.2, 5.1-5.8, 7.1-7.5_

- [ ] 13. 实现高级功能（优先级：中）
  - [ ] 13.1 实现数据导出功能
    - 添加 Excel 和 PDF 导出支持
    - 实现导出格式配置和模板定制
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [ ]* 13.2 添加高级筛选和搜索
    - 实现多条件组合筛选
    - 添加保存筛选条件功能
    - _需求: 2.1, 2.2_

- [ ] 14. 性能优化和错误处理
  - [ ] 14.1 实现全局异常处理
    - 创建 ExceptionHandler 类，统一处理各类异常
    - 实现错误日志记录和用户友好的错误提示
    - _需求: 1.1, 1.2, 1.3_

  - [ ] 14.2 优化大数据量性能
    - 实现虚拟化列表和分页加载
    - 优化数据库查询和内存使用
    - 添加性能监控和预警机制
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ] 14.3 实现数据缓存和同步
    - 添加内存缓存机制，提升响应速度
    - 实现数据变更通知和自动刷新
    - _需求: 1.1, 1.2, 1.3_

- [ ] 15. 系统集成和测试
  - [ ] 15.1 集成所有功能模块
    - 确保各模块间的数据流转正确
    - 实现完整的用户工作流程
    - 修复集成过程中发现的问题
    - _需求: 1.1-7.5_

  - [ ]* 15.2 执行端到端测试
    - 测试完整的排班创建到确认流程
    - 测试各种边界情况和异常场景
    - 验证性能指标和用户体验
    - _需求: 1.1-7.5_

  - [ ] 15.3 优化用户体验
    - 添加动画过渡效果和微交互
    - 实现主题切换和个性化设置
    - 优化响应式布局和无障碍支持
    - _需求: 1.1, 1.2, 1.3_

- [ ] 16. 部署准备和文档
  - [ ] 16.1 准备应用部署
    - 配置 MSIX 打包和安装程序
    - 设置应用图标、版本信息和数字签名
    - 创建安装和升级脚本
    - _需求: 1.1, 1.2, 1.3_

  - [ ]* 16.2 编写用户文档
    - 创建用户操作手册和快速入门指南
    - 录制功能演示视频
    - _需求: 1.1-7.5_

  - [ ]* 16.3 创建开发者文档
    - 编写 API 文档和架构说明
    - 创建代码注释和维护指南
    - _需求: 1.1-7.5_