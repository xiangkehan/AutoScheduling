# è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬è®¾è®¡æ–‡æ¡£æè¿°äº†æ’ç­ç»“æœé¡µé¢äººå‘˜ç­›é€‰åŠŸèƒ½çš„å¢å¼ºæ–¹æ¡ˆã€‚è¯¥åŠŸèƒ½é€šè¿‡å¤ç”¨ç°æœ‰çš„é«˜äº®æœºåˆ¶ï¼ˆ`HighlightedCellKeys`ï¼‰å’Œå³ä¾§é¢æ¿ï¼ˆ`SplitView`ï¼‰ï¼Œä¸ºç”¨æˆ·æä¾›ç›´è§‚çš„æœç´¢ç»“æœå±•ç¤ºã€‚æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯åŸºäºç­æ¬¡ ID è€Œéåæ ‡è¿›è¡Œé«˜äº®ç®¡ç†ï¼Œç¡®ä¿è·¨è§†å›¾å…¼å®¹æ€§å’Œæœªæ¥æ‰©å±•æ€§ã€‚

## æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ScheduleResultPage                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Filter Toolbar (äººå‘˜ç­›é€‰å™¨)                            â”‚ â”‚
â”‚  â”‚  [æ—¥æœŸ] [å“¨ä½] [äººå‘˜æœç´¢æ¡†] [åº”ç”¨] [é‡ç½®]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          â”‚  Right Pane (SplitView)   â”‚   â”‚
â”‚  â”‚  Schedule Grid           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  (æ’ç­è¡¨æ ¼)              â”‚  â”‚ TabView             â”‚  â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”        â”‚  â”‚ â”‚æœç´¢ â”‚ å†²çªç®¡ç† â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ ğŸŸ¡ â”‚    â”‚ ğŸŸ¡ â”‚        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤        â”‚  â”‚                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    â”‚ ğŸŸ¢ â”‚    â”‚ â† ç„¦ç‚¹ â”‚  â”‚  Search Results     â”‚  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ ğŸŸ¡ â”‚    â”‚    â”‚        â”‚  â”‚  â”‚ ğŸ“‹ ç­æ¬¡åˆ—è¡¨   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜        â”‚  â”‚  â”‚ â€¢ 2024-01-01  â”‚  â”‚  â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚  â”‚ â€¢ 2024-01-02  â”‚  â”‚  â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚  â”‚ â€¢ 2024-01-03  â”‚  â”‚  â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚                          â”‚  â”‚  [â—€ä¸Šä¸€ä¸ª][ä¸‹ä¸€ä¸ªâ–¶] â”‚  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›¾ä¾‹ï¼š
ğŸŸ¡ = æœç´¢ç»“æœé«˜äº® (Search Result Highlight)
ğŸŸ¢ = ç„¦ç‚¹é«˜äº® (Focus Highlight)
```

### ç»„ä»¶å±‚æ¬¡

```
ScheduleResultPage (View)
â”œâ”€â”€ FilterToolbar (ç°æœ‰)
â”‚   â””â”€â”€ PersonnelSearchBox (å¢å¼º)
â”œâ”€â”€ ScheduleGrid (ç°æœ‰)
â”‚   â””â”€â”€ HighlightedCells (å¤ç”¨ç°æœ‰æœºåˆ¶)
â””â”€â”€ SplitView.Pane (ç°æœ‰)
    â””â”€â”€ TabView (æ–°å¢)
        â”œâ”€â”€ SearchResultsTab (æ–°å¢)
        â”‚   â”œâ”€â”€ FilterSummary
        â”‚   â”œâ”€â”€ ResultCount
        â”‚   â”œâ”€â”€ ShiftResultList
        â”‚   â””â”€â”€ NavigationButtons (æ–°å¢)
        â”‚       â”œâ”€â”€ PreviousButton
        â”‚       â””â”€â”€ NextButton
        â””â”€â”€ ConflictManagementTab (ç°æœ‰ï¼Œé‡æ„)
            â””â”€â”€ ConflictPanel (ç°æœ‰å†…å®¹)
```

## ç»„ä»¶å’Œæ¥å£

### 1. ViewModel æ‰©å±• (ScheduleResultViewModel.Search.cs)

åˆ›å»ºæ–°çš„ partial class æ–‡ä»¶æ¥ç®¡ç†æœç´¢ç›¸å…³åŠŸèƒ½ï¼š

```csharp
namespace AutoScheduling3.ViewModels.Scheduling
{
    /// <summary>
    /// ScheduleResultViewModel çš„æœç´¢åŠŸèƒ½éƒ¨åˆ†
    /// </summary>
    public partial class ScheduleResultViewModel
    {
        #region æœç´¢ç›¸å…³å±æ€§

        /// <summary>
        /// æœç´¢ç»“æœåˆ—è¡¨
        /// </summary>
        private ObservableCollection<SearchResultItem> _searchResults = new();
        public ObservableCollection<SearchResultItem> SearchResults
        {
            get => _searchResults;
            set => SetProperty(ref _searchResults, value);
        }

        /// <summary>
        /// å½“å‰é€‰ä¸­çš„æœç´¢ç»“æœé¡¹
        /// </summary>
        private SearchResultItem? _selectedSearchResult;
        public SearchResultItem? SelectedSearchResult
        {
            get => _selectedSearchResult;
            set
            {
                if (SetProperty(ref _selectedSearchResult, value))
                {
                    _ = OnSearchResultSelectedAsync(value);
                }
            }
        }

        /// <summary>
        /// å½“å‰ç„¦ç‚¹é«˜äº®çš„ç­æ¬¡ ID
        /// </summary>
        private int? _focusedShiftId;
        public int? FocusedShiftId
        {
            get => _focusedShiftId;
            set => SetProperty(ref _focusedShiftId, value);
        }

        /// <summary>
        /// å½“å‰é«˜äº®ç»“æœçš„ç´¢å¼•ï¼ˆç”¨äºå¯¼èˆªï¼‰
        /// </summary>
        private int _currentHighlightIndex = 0;
        public int CurrentHighlightIndex
        {
            get => _currentHighlightIndex;
            set => SetProperty(ref _currentHighlightIndex, value);
        }

        /// <summary>
        /// æ˜¯å¦æœ‰æ´»åŠ¨çš„æœç´¢ç­›é€‰
        /// </summary>
        private bool _hasActiveSearch;
        public bool HasActiveSearch
        {
            get => _hasActiveSearch;
            set => SetProperty(ref _hasActiveSearch, value);
        }

        /// <summary>
        /// å³ä¾§é¢æ¿å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µç´¢å¼•ï¼ˆ0=æœç´¢ç»“æœï¼Œ1=å†²çªç®¡ç†ï¼‰
        /// </summary>
        private int _rightPaneTabIndex = 1; // é»˜è®¤æ˜¾ç¤ºå†²çªç®¡ç†
        public int RightPaneTabIndex
        {
            get => _rightPaneTabIndex;
            set => SetProperty(ref _rightPaneTabIndex, value);
        }

        /// <summary>
        /// æœç´¢ç»“æœæ ‡ç­¾é¡µæ˜¯å¦å¯è§
        /// </summary>
        public bool IsSearchResultsTabVisible => HasActiveSearch;

        #endregion

        #region æœç´¢ç›¸å…³å‘½ä»¤

        /// <summary>
        /// å¯¼èˆªåˆ°ä¸Šä¸€ä¸ªé«˜äº®ç»“æœå‘½ä»¤
        /// </summary>
        public IRelayCommand? NavigateToPreviousHighlightCommand { get; private set; }

        /// <summary>
        /// å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ªé«˜äº®ç»“æœå‘½ä»¤
        /// </summary>
        public IRelayCommand? NavigateToNextHighlightCommand { get; private set; }

        /// <summary>
        /// é€‰æ‹©æœç´¢ç»“æœé¡¹å‘½ä»¤
        /// </summary>
        public IAsyncRelayCommand<SearchResultItem>? SelectSearchResultCommand { get; private set; }

        #endregion

        #region æœç´¢å‘½ä»¤åˆå§‹åŒ–

        /// <summary>
        /// åˆå§‹åŒ–æœç´¢ç›¸å…³å‘½ä»¤
        /// </summary>
        private void InitializeSearchCommands()
        {
            NavigateToPreviousHighlightCommand = new RelayCommand(
                NavigateToPreviousHighlight,
                CanNavigateToPreviousHighlight);
            
            NavigateToNextHighlightCommand = new RelayCommand(
                NavigateToNextHighlight,
                CanNavigateToNextHighlight);
            
            SelectSearchResultCommand = new AsyncRelayCommand<SearchResultItem>(
                SelectSearchResultAsync);
        }

        #endregion

        #region æœç´¢æ ¸å¿ƒé€»è¾‘

        /// <summary>
        /// åº”ç”¨ç­›é€‰ï¼ˆé‡å†™ç°æœ‰æ–¹æ³•ä»¥æ”¯æŒæœç´¢åŠŸèƒ½ï¼‰
        /// </summary>
        private async Task ApplyFiltersAsync()
        {
            if (Schedule == null) return;

            try
            {
                IsLoading = true;

                // æ”¶é›†æ‰€æœ‰ç­›é€‰æ¡ä»¶
                var filters = new SearchFilters
                {
                    PersonnelId = SelectedPersonnel?.Id,
                    StartDate = FilterStartDate != default ? FilterStartDate : null,
                    EndDate = FilterEndDate != default ? FilterEndDate : null,
                    PositionIds = SelectedPositionIds.Any() ? SelectedPositionIds.ToList() : null
                };

                // æ‰§è¡Œæœç´¢
                var matchedShifts = await SearchShiftsAsync(filters);

                // æ›´æ–°æœç´¢ç»“æœ
                SearchResults = new ObservableCollection<SearchResultItem>(
                    matchedShifts.Select(s => new SearchResultItem(s)));

                // æ›´æ–°é«˜äº®
                await UpdateHighlightsAsync(matchedShifts);

                // æ›´æ–°çŠ¶æ€
                HasActiveSearch = matchedShifts.Any();
                
                if (HasActiveSearch)
                {
                    // åˆ‡æ¢åˆ°æœç´¢ç»“æœæ ‡ç­¾é¡µ
                    RightPaneTabIndex = 0;
                    
                    // æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªç»“æœ
                    CurrentHighlightIndex = 0;
                    await ScrollToHighlightAsync(0);
                }

                // é€šçŸ¥å‘½ä»¤çŠ¶æ€å˜åŒ–
                NavigateToPreviousHighlightCommand?.NotifyCanExecuteChanged();
                NavigateToNextHighlightCommand?.NotifyCanExecuteChanged();
            }
            catch (Exception ex)
            {
                await _dialogService.ShowErrorAsync("åº”ç”¨ç­›é€‰å¤±è´¥", ex);
            }
            finally
            {
                IsLoading = false;
            }
        }

        /// <summary>
        /// æœç´¢ç­æ¬¡
        /// </summary>
        private async Task<List<ShiftDto>> SearchShiftsAsync(SearchFilters filters)
        {
            if (Schedule?.Shifts == null) return new List<ShiftDto>();

            await Task.CompletedTask; // å¼‚æ­¥å ä½

            var query = Schedule.Shifts.AsEnumerable();

            // åº”ç”¨äººå‘˜ç­›é€‰
            if (filters.PersonnelId.HasValue)
            {
                query = query.Where(s => s.PersonnelId == filters.PersonnelId.Value);
            }

            // åº”ç”¨æ—¥æœŸèŒƒå›´ç­›é€‰
            if (filters.StartDate.HasValue)
            {
                query = query.Where(s => s.StartTime.Date >= filters.StartDate.Value.Date);
            }
            if (filters.EndDate.HasValue)
            {
                query = query.Where(s => s.StartTime.Date <= filters.EndDate.Value.Date);
            }

            // åº”ç”¨å“¨ä½ç­›é€‰
            if (filters.PositionIds != null && filters.PositionIds.Any())
            {
                query = query.Where(s => filters.PositionIds.Contains(s.PositionId));
            }

            return query.OrderBy(s => s.StartTime).ThenBy(s => s.PeriodIndex).ToList();
        }

        /// <summary>
        /// æ›´æ–°é«˜äº®æ˜¾ç¤º
        /// </summary>
        private async Task UpdateHighlightsAsync(List<ShiftDto> matchedShifts)
        {
            if (matchedShifts == null || !matchedShifts.Any())
            {
                HighlightedCellKeys = new HashSet<string>();
                return;
            }

            await Task.CompletedTask; // å¼‚æ­¥å ä½

            // ç”Ÿæˆé«˜äº®é”®ï¼ˆåŸºäºç­æ¬¡ ID å’Œè§†å›¾ç±»å‹ï¼‰
            var highlightKeys = new HashSet<string>();
            var viewType = GetCurrentViewTypeString();

            foreach (var shift in matchedShifts)
            {
                var key = GenerateCellKey(shift.Id, viewType);
                highlightKeys.Add(key);
            }

            HighlightedCellKeys = highlightKeys;
        }

        /// <summary>
        /// ç”Ÿæˆå•å…ƒæ ¼é”®
        /// </summary>
        private string GenerateCellKey(int shiftId, string viewType)
        {
            return $"shift_{shiftId}_{viewType}";
        }

        /// <summary>
        /// è·å–å½“å‰è§†å›¾ç±»å‹å­—ç¬¦ä¸²
        /// </summary>
        private string GetCurrentViewTypeString()
        {
            return CurrentViewMode.ToString();
        }

        /// <summary>
        /// é‡ç½®ç­›é€‰ï¼ˆé‡å†™ç°æœ‰æ–¹æ³•ï¼‰
        /// </summary>
        private async Task ResetFiltersAsync()
        {
            // æ¸…é™¤ç­›é€‰æ¡ä»¶
            SelectedPersonnel = null;
            PersonnelSearchText = string.Empty;
            FilterStartDate = default;
            FilterEndDate = default;
            SelectedPositionIds.Clear();

            // æ¸…é™¤æœç´¢ç»“æœ
            SearchResults.Clear();
            HasActiveSearch = false;
            FocusedShiftId = null;
            CurrentHighlightIndex = 0;

            // æ¸…é™¤é«˜äº®
            HighlightedCellKeys = new HashSet<string>();

            // åˆ‡æ¢å›å†²çªç®¡ç†æ ‡ç­¾é¡µ
            RightPaneTabIndex = 1;

            await Task.CompletedTask;
        }

        #endregion

        #region å¯¼èˆªé€»è¾‘

        /// <summary>
        /// å¯¼èˆªåˆ°ä¸Šä¸€ä¸ªé«˜äº®ç»“æœ
        /// </summary>
        private void NavigateToPreviousHighlight()
        {
            if (!CanNavigateToPreviousHighlight()) return;

            CurrentHighlightIndex--;
            _ = ScrollToHighlightAsync(CurrentHighlightIndex);
        }

        /// <summary>
        /// å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ªé«˜äº®ç»“æœ
        /// </summary>
        private void NavigateToNextHighlight()
        {
            if (!CanNavigateToNextHighlight()) return;

            CurrentHighlightIndex++;
            _ = ScrollToHighlightAsync(CurrentHighlightIndex);
        }

        /// <summary>
        /// æ˜¯å¦å¯ä»¥å¯¼èˆªåˆ°ä¸Šä¸€ä¸ª
        /// </summary>
        private bool CanNavigateToPreviousHighlight()
        {
            return HasActiveSearch && CurrentHighlightIndex > 0;
        }

        /// <summary>
        /// æ˜¯å¦å¯ä»¥å¯¼èˆªåˆ°ä¸‹ä¸€ä¸ª
        /// </summary>
        private bool CanNavigateToNextHighlight()
        {
            return HasActiveSearch && CurrentHighlightIndex < SearchResults.Count - 1;
        }

        /// <summary>
        /// æ»šåŠ¨åˆ°æŒ‡å®šç´¢å¼•çš„é«˜äº®ç»“æœ
        /// </summary>
        private async Task ScrollToHighlightAsync(int index)
        {
            if (index < 0 || index >= SearchResults.Count) return;

            var result = SearchResults[index];
            
            // æ›´æ–°ç„¦ç‚¹é«˜äº®
            FocusedShiftId = result.ShiftId;

            // è§¦å‘æ»šåŠ¨äº‹ä»¶
            ScrollToCellRequested?.Invoke(this, new ScrollToCellEventArgs(
                result.RowIndex,
                result.ColumnIndex));

            await Task.CompletedTask;
        }

        /// <summary>
        /// é€‰æ‹©æœç´¢ç»“æœé¡¹
        /// </summary>
        private async Task SelectSearchResultAsync(SearchResultItem? item)
        {
            if (item == null) return;

            // æ›´æ–°ç„¦ç‚¹é«˜äº®
            FocusedShiftId = item.ShiftId;

            // æ›´æ–°å½“å‰ç´¢å¼•
            CurrentHighlightIndex = SearchResults.IndexOf(item);

            // æ»šåŠ¨åˆ°å¯¹åº”å•å…ƒæ ¼
            ScrollToCellRequested?.Invoke(this, new ScrollToCellEventArgs(
                item.RowIndex,
                item.ColumnIndex));

            await Task.CompletedTask;
        }

        /// <summary>
        /// å½“æœç´¢ç»“æœè¢«é€‰ä¸­æ—¶
        /// </summary>
        private async Task OnSearchResultSelectedAsync(SearchResultItem? item)
        {
            if (item != null)
            {
                await SelectSearchResultAsync(item);
            }
        }

        #endregion

        #region è§†å›¾åˆ‡æ¢æ”¯æŒ

        /// <summary>
        /// å½“è§†å›¾æ¨¡å¼æ”¹å˜æ—¶ï¼ˆé‡å†™ç°æœ‰æ–¹æ³•ï¼‰
        /// </summary>
        private async Task OnViewModeChangedAsync(ViewMode newMode)
        {
            // è°ƒç”¨åŸæœ‰é€»è¾‘
            // ... ç°æœ‰ä»£ç  ...

            // å¦‚æœæœ‰æ´»åŠ¨æœç´¢ï¼Œé‡æ–°æ˜ å°„é«˜äº®
            if (HasActiveSearch && SearchResults.Any())
            {
                var matchedShifts = SearchResults.Select(r => r.Shift).ToList();
                await UpdateHighlightsAsync(matchedShifts);
            }
        }

        #endregion
    }
}
```

## æ•°æ®æ¨¡å‹

### SearchResultItem

```csharp
namespace AutoScheduling3.DTOs
{
    /// <summary>
    /// æœç´¢ç»“æœé¡¹
    /// </summary>
    public class SearchResultItem
    {
        /// <summary>
        /// ç­æ¬¡æ•°æ®
        /// </summary>
        public ShiftDto Shift { get; set; }

        /// <summary>
        /// ç­æ¬¡ ID
        /// </summary>
        public int ShiftId => Shift.Id;

        /// <summary>
        /// æ—¥æœŸ
        /// </summary>
        public DateTime Date => Shift.StartTime.Date;

        /// <summary>
        /// æ˜ŸæœŸ
        /// </summary>
        public string DayOfWeek => Shift.StartTime.ToString("dddd");

        /// <summary>
        /// æ—¶æ®µåç§°
        /// </summary>
        public string PeriodName => GetPeriodName(Shift.PeriodIndex);

        /// <summary>
        /// å“¨ä½åç§°
        /// </summary>
        public string PositionName => Shift.PositionName;

        /// <summary>
        /// äººå‘˜å§“å
        /// </summary>
        public string PersonnelName => Shift.PersonnelName;

        /// <summary>
        /// æ˜¯å¦ä¸ºå¤œå“¨
        /// </summary>
        public bool IsNightShift => Shift.PeriodIndex is 11 or 0 or 1 or 2;

        /// <summary>
        /// æ˜¯å¦ä¸ºæ‰‹åŠ¨åˆ†é…
        /// </summary>
        public bool IsManualAssignment => Shift.IsManualAssignment;

        /// <summary>
        /// æ˜¯å¦å­˜åœ¨å†²çª
        /// </summary>
        public bool HasConflict { get; set; }

        /// <summary>
        /// åœ¨å½“å‰è§†å›¾ä¸­çš„è¡Œç´¢å¼•
        /// </summary>
        public int RowIndex { get; set; }

        /// <summary>
        /// åœ¨å½“å‰è§†å›¾ä¸­çš„åˆ—ç´¢å¼•
        /// </summary>
        public int ColumnIndex { get; set; }

        /// <summary>
        /// æ˜¾ç¤ºæ–‡æœ¬
        /// </summary>
        public string DisplayText => $"{Date:yyyy-MM-dd} {DayOfWeek} {PeriodName} - {PositionName} - {PersonnelName}";

        public SearchResultItem(ShiftDto shift)
        {
            Shift = shift ?? throw new ArgumentNullException(nameof(shift));
        }

        private string GetPeriodName(int periodIndex)
        {
            return periodIndex switch
            {
                0 => "00:00-02:00",
                1 => "02:00-04:00",
                2 => "04:00-06:00",
                3 => "06:00-08:00",
                4 => "08:00-10:00",
                5 => "10:00-12:00",
                6 => "12:00-14:00",
                7 => "14:00-16:00",
                8 => "16:00-18:00",
                9 => "18:00-20:00",
                10 => "20:00-22:00",
                11 => "22:00-00:00",
                _ => "æœªçŸ¥"
            };
        }
    }
}
```

### SearchFilters

```csharp
namespace AutoScheduling3.DTOs
{
    /// <summary>
    /// æœç´¢ç­›é€‰æ¡ä»¶
    /// </summary>
    public class SearchFilters
    {
        /// <summary>
        /// äººå‘˜ ID
        /// </summary>
        public int? PersonnelId { get; set; }

        /// <summary>
        /// å¼€å§‹æ—¥æœŸ
        /// </summary>
        public DateTime? StartDate { get; set; }

        /// <summary>
        /// ç»“æŸæ—¥æœŸ
        /// </summary>
        public DateTime? EndDate { get; set; }

        /// <summary>
        /// å“¨ä½ ID åˆ—è¡¨
        /// </summary>
        public List<int>? PositionIds { get; set; }

        /// <summary>
        /// æ˜¯å¦æœ‰ä»»ä½•æ´»åŠ¨ç­›é€‰
        /// </summary>
        public bool HasAnyFilter =>
            PersonnelId.HasValue ||
            StartDate.HasValue ||
            EndDate.HasValue ||
            (PositionIds != null && PositionIds.Any());

        /// <summary>
        /// è·å–ç­›é€‰æ¡ä»¶æ‘˜è¦
        /// </summary>
        public string GetSummary()
        {
            var parts = new List<string>();

            if (PersonnelId.HasValue)
                parts.Add($"äººå‘˜ID: {PersonnelId}");
            
            if (StartDate.HasValue)
                parts.Add($"å¼€å§‹: {StartDate:yyyy-MM-dd}");
            
            if (EndDate.HasValue)
                parts.Add($"ç»“æŸ: {EndDate:yyyy-MM-dd}");
            
            if (PositionIds != null && PositionIds.Any())
                parts.Add($"å“¨ä½: {PositionIds.Count}ä¸ª");

            return parts.Any() ? string.Join(", ", parts) : "æ— ç­›é€‰æ¡ä»¶";
        }
    }
}
```

## é”™è¯¯å¤„ç†

### é”™è¯¯åœºæ™¯

1. **æœç´¢è¶…æ—¶**: å½“æ’ç­è¡¨åŒ…å«å¤§é‡ç­æ¬¡æ—¶ï¼Œæœç´¢å¯èƒ½è¶…æ—¶
   - å¤„ç†ï¼šä½¿ç”¨ `Task.Delay` æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œæ·»åŠ è¶…æ—¶æœºåˆ¶
   - ç”¨æˆ·åé¦ˆï¼šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨å’Œè¶…æ—¶æç¤º

2. **è§†å›¾åˆ‡æ¢æ—¶é«˜äº®ä¸¢å¤±**: ä¸åŒè§†å›¾çš„åæ ‡ç³»ç»Ÿä¸åŒ
   - å¤„ç†ï¼šåŸºäºç­æ¬¡ ID é‡æ–°è®¡ç®—åæ ‡
   - é™çº§ï¼šå¦‚æœæ— æ³•æ˜ å°„ï¼Œæ¸…é™¤é«˜äº®å¹¶æç¤ºç”¨æˆ·

3. **æ— æ•ˆçš„ç­æ¬¡ ID**: é«˜äº®é”®å¼•ç”¨çš„ç­æ¬¡ä¸å­˜åœ¨
   - å¤„ç†ï¼šè¿‡æ»¤æ‰æ— æ•ˆçš„é«˜äº®é”®
   - æ—¥å¿—ï¼šè®°å½•è­¦å‘Šä¿¡æ¯

4. **å¹¶å‘æœç´¢**: ç”¨æˆ·å¿«é€Ÿè¿ç»­è§¦å‘å¤šæ¬¡æœç´¢
   - å¤„ç†ï¼šä½¿ç”¨é˜²æŠ–æœºåˆ¶ï¼ˆ300msï¼‰
   - å–æ¶ˆï¼šå–æ¶ˆå‰ä¸€ä¸ªæœªå®Œæˆçš„æœç´¢ä»»åŠ¡

## æ­£ç¡®æ€§å±æ€§

*å±æ€§æ˜¯ä¸€ä¸ªç‰¹å¾æˆ–è¡Œä¸ºï¼Œåº”è¯¥åœ¨ç³»ç»Ÿçš„æ‰€æœ‰æœ‰æ•ˆæ‰§è¡Œä¸­ä¿æŒä¸ºçœŸâ€”â€”æœ¬è´¨ä¸Šæ˜¯å…³äºç³»ç»Ÿåº”è¯¥åšä»€ä¹ˆçš„æ­£å¼é™ˆè¿°ã€‚å±æ€§ä½œä¸ºäººç±»å¯è¯»è§„èŒƒå’Œæœºå™¨å¯éªŒè¯æ­£ç¡®æ€§ä¿è¯ä¹‹é—´çš„æ¡¥æ¢ã€‚*

### å±æ€§ 1: ç­›é€‰ç»“æœä¸€è‡´æ€§
*å¯¹äºä»»æ„*æ’ç­æ•°æ®å’Œç­›é€‰æ¡ä»¶ï¼Œæœç´¢è¿”å›çš„ç­æ¬¡é›†åˆåº”è¯¥ä¸é«˜äº®é”®é›†åˆè¡¨ç¤ºçš„ç­æ¬¡é›†åˆå®Œå…¨ä¸€è‡´
**éªŒè¯éœ€æ±‚: 1.1, 2.2**

### å±æ€§ 2: é«˜äº®çŠ¶æ€è½¬æ¢
*å¯¹äºä»»æ„*ä¸¤ä¸ªä¸åŒçš„äººå‘˜ç­›é€‰ï¼Œåˆ‡æ¢é€‰æ‹©åº”è¯¥å¯¼è‡´é«˜äº®é›†åˆå®Œå…¨æ›¿æ¢ï¼Œä¸”æ–°é«˜äº®é›†åˆä»…åŒ…å«æ–°é€‰ä¸­äººå‘˜çš„ç­æ¬¡
**éªŒè¯éœ€æ±‚: 1.2**

### å±æ€§ 3: é‡ç½®å¹‚ç­‰æ€§
*å¯¹äºä»»æ„*ç­›é€‰çŠ¶æ€ï¼Œæ‰§è¡Œé‡ç½®æ“ä½œåï¼Œæ‰€æœ‰ç­›é€‰æ¡ä»¶ã€é«˜äº®é›†åˆå’Œæœç´¢ç»“æœåº”è¯¥ä¸ºç©º
**éªŒè¯éœ€æ±‚: 1.3, 4.6**

### å±æ€§ 4: æ»šåŠ¨äº‹ä»¶è§¦å‘
*å¯¹äºä»»æ„*éç©ºæœç´¢ç»“æœï¼Œåº”ç”¨ç­›é€‰ååº”è¯¥è§¦å‘ ScrollToCellRequested äº‹ä»¶ï¼Œä¸”äº‹ä»¶å‚æ•°æŒ‡å‘ç¬¬ä¸€ä¸ªç»“æœçš„åæ ‡
**éªŒè¯éœ€æ±‚: 1.4**

### å±æ€§ 5: å¯¼èˆªæŒ‰é’®çŠ¶æ€
*å¯¹äºä»»æ„*æœç´¢ç»“æœé›†åˆï¼Œå½“ç»“æœæ•°é‡å¤§äº 1 æ—¶ï¼Œå¯¼èˆªæŒ‰é’®åº”è¯¥å¯ç”¨ï¼›å½“ç´¢å¼•ä¸º 0 æ—¶"ä¸Šä¸€ä¸ª"ç¦ç”¨ï¼Œå½“ç´¢å¼•ä¸ºæœ€åä¸€ä¸ªæ—¶"ä¸‹ä¸€ä¸ª"ç¦ç”¨
**éªŒè¯éœ€æ±‚: 1.5**

### å±æ€§ 6: ç„¦ç‚¹é«˜äº®å”¯ä¸€æ€§
*å¯¹äºä»»æ„*æ—¶åˆ»ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªç­æ¬¡æ‹¥æœ‰ç„¦ç‚¹é«˜äº®ï¼ˆFocusedShiftId ä¸º null æˆ–æŒ‡å‘å•ä¸ªç­æ¬¡ï¼‰
**éªŒè¯éœ€æ±‚: 1.6, 2.4, 2.6**

### å±æ€§ 7: è·¨è§†å›¾é«˜äº®ä¿æŒ
*å¯¹äºä»»æ„*è§†å›¾åˆ‡æ¢ï¼Œé«˜äº®çš„ç­æ¬¡ ID é›†åˆåº”è¯¥ä¿æŒä¸å˜ï¼Œåªæœ‰å•å…ƒæ ¼é”®çš„æ ¼å¼å‘ç”Ÿå˜åŒ–
**éªŒè¯éœ€æ±‚: 1.7**

### å±æ€§ 8: å•å…ƒæ ¼é”®æ ¼å¼
*å¯¹äºä»»æ„*ç­æ¬¡ ID å’Œè§†å›¾ç±»å‹ï¼Œç”Ÿæˆçš„å•å…ƒæ ¼é”®åº”è¯¥åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ `^shift_\d+_(Grid|ByPosition|ByPersonnel|List)$`
**éªŒè¯éœ€æ±‚: 1.8, 7.1**

### å±æ€§ 9: AND é€»è¾‘ç»„åˆ
*å¯¹äºä»»æ„*å¤šä¸ªç­›é€‰æ¡ä»¶çš„ç»„åˆï¼Œæœç´¢ç»“æœåº”è¯¥æ˜¯æ‰€æœ‰å•ä¸ªæ¡ä»¶ç»“æœçš„äº¤é›†
**éªŒè¯éœ€æ±‚: 4.1, 4.2, 4.3**

### å±æ€§ 10: ç­›é€‰æ¡ä»¶æ‘˜è¦å®Œæ•´æ€§
*å¯¹äºä»»æ„*éç©ºç­›é€‰æ¡ä»¶ï¼ŒGetSummary() è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥åŒ…å«æ‰€æœ‰å·²è®¾ç½®æ¡ä»¶çš„æè¿°
**éªŒè¯éœ€æ±‚: 4.4**

### å±æ€§ 11: å®æ—¶æ›´æ–°å“åº”æ€§
*å¯¹äºä»»æ„*ç­›é€‰æ¡ä»¶çš„ä¿®æ”¹ï¼Œåº”è¯¥è§¦å‘æœç´¢æ“ä½œå¹¶æ›´æ–° SearchResults å’Œ HighlightedCellKeys
**éªŒè¯éœ€æ±‚: 4.5**

### å±æ€§ 12: æ˜¾ç¤ºæ–‡æœ¬å®Œæ•´æ€§
*å¯¹äºä»»æ„*ç­æ¬¡ï¼ŒSearchResultItem.DisplayText åº”è¯¥åŒ…å«æ—¥æœŸã€æ˜ŸæœŸã€æ—¶æ®µã€å“¨ä½å’Œäººå‘˜ä¿¡æ¯
**éªŒè¯éœ€æ±‚: 5.1**

### å±æ€§ 13: å¤œå“¨åˆ¤æ–­æ­£ç¡®æ€§
*å¯¹äºä»»æ„*ç­æ¬¡ï¼Œå½“ä¸”ä»…å½“ PeriodIndex ä¸º 11, 0, 1, 2 æ—¶ï¼ŒIsNightShift åº”è¯¥ä¸º true
**éªŒè¯éœ€æ±‚: 5.2**

### å±æ€§ 14: æ‰‹åŠ¨åˆ†é…æ˜ å°„
*å¯¹äºä»»æ„*ç­æ¬¡ï¼ŒSearchResultItem.IsManualAssignment åº”è¯¥ç­‰äº Shift.IsManualAssignment
**éªŒè¯éœ€æ±‚: 5.3**

### å±æ€§ 15: æœç´¢æ€§èƒ½çº¦æŸ
*å¯¹äºä»»æ„*åŒ…å« 1000+ ç­æ¬¡çš„æ’ç­è¡¨ï¼Œæœç´¢å’Œé«˜äº®æ“ä½œåº”è¯¥åœ¨ 500 æ¯«ç§’å†…å®Œæˆ
**éªŒè¯éœ€æ±‚: 6.1**

### å±æ€§ 16: é˜²æŠ–æœºåˆ¶
*å¯¹äºä»»æ„*åœ¨ 300 æ¯«ç§’å†…çš„è¿ç»­æœç´¢è§¦å‘ï¼Œåªæœ‰æœ€åä¸€æ¬¡åº”è¯¥å®é™…æ‰§è¡Œ
**éªŒè¯éœ€æ±‚: 6.2**

### å±æ€§ 17: è§†å›¾åˆ‡æ¢æ€§èƒ½çº¦æŸ
*å¯¹äºä»»æ„*è§†å›¾åˆ‡æ¢æ“ä½œï¼Œé«˜äº®é‡æ˜ å°„åº”è¯¥åœ¨ 300 æ¯«ç§’å†…å®Œæˆ
**éªŒè¯éœ€æ±‚: 6.4**

### å±æ€§ 18: åŠ è½½çŠ¶æ€æŒ‡ç¤º
*å¯¹äºä»»æ„*æœç´¢æ“ä½œï¼Œåœ¨æ“ä½œå¼€å§‹æ—¶ IsLoading åº”è¯¥ä¸º trueï¼Œæ“ä½œå®Œæˆååº”è¯¥ä¸º false
**éªŒè¯éœ€æ±‚: 6.5**

### å±æ€§ 19: ç­æ¬¡ ID åˆ°åæ ‡æ˜ å°„
*å¯¹äºä»»æ„*æœ‰æ•ˆçš„ç­æ¬¡ ID å’Œè§†å›¾ç±»å‹ï¼Œåº”è¯¥èƒ½å¤Ÿè®¡ç®—å‡ºå¯¹åº”çš„è¡Œåˆ—åæ ‡
**éªŒè¯éœ€æ±‚: 7.2**

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ç”¨äºéªŒè¯ç‰¹å®šç¤ºä¾‹å’Œè¾¹ç•Œæƒ…å†µï¼š

1. **SearchFilters æµ‹è¯•**
   - æµ‹è¯•ç©ºç­›é€‰æ¡ä»¶æ—¶ `HasAnyFilter` è¿”å› false
   - æµ‹è¯•å•ä¸ªæ¡ä»¶æ—¶ `HasAnyFilter` è¿”å› true
   - æµ‹è¯• `GetSummary()` åœ¨æ— æ¡ä»¶æ—¶è¿”å›"æ— ç­›é€‰æ¡ä»¶"
   - æµ‹è¯• `GetSummary()` åœ¨æœ‰æ¡ä»¶æ—¶åŒ…å«æ‰€æœ‰æ¡ä»¶æè¿°

2. **SearchResultItem æµ‹è¯•**
   - æµ‹è¯•æ—¶æ®µ 0-11 çš„åç§°æ˜ å°„æ­£ç¡®æ€§
   - æµ‹è¯•è¾¹ç•Œæ—¶æ®µï¼ˆ11, 0, 1, 2ï¼‰çš„å¤œå“¨åˆ¤æ–­
   - æµ‹è¯•éå¤œå“¨æ—¶æ®µï¼ˆ3-10ï¼‰çš„å¤œå“¨åˆ¤æ–­
   - æµ‹è¯• DisplayText æ ¼å¼ç¬¦åˆé¢„æœŸ

3. **å•å…ƒæ ¼é”®ç”Ÿæˆæµ‹è¯•**
   - æµ‹è¯• Grid è§†å›¾çš„é”®æ ¼å¼
   - æµ‹è¯• ByPosition è§†å›¾çš„é”®æ ¼å¼
   - æµ‹è¯• ByPersonnel è§†å›¾çš„é”®æ ¼å¼
   - æµ‹è¯• List è§†å›¾çš„é”®æ ¼å¼

4. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**
   - æµ‹è¯•ç©ºæœç´¢ç»“æœçš„å¤„ç†
   - æµ‹è¯•å•ä¸ªæœç´¢ç»“æœçš„å¯¼èˆªæŒ‰é’®çŠ¶æ€
   - æµ‹è¯•ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªç»“æœçš„å¯¼èˆªé™åˆ¶

### å±æ€§æµ‹è¯•

ä½¿ç”¨å±æ€§æµ‹è¯•æ¡†æ¶ï¼ˆå¦‚ FsCheck æˆ– CsCheckï¼‰éªŒè¯é€šç”¨å±æ€§ï¼š

1. **å±æ€§ 1: ç­›é€‰ç»“æœä¸€è‡´æ€§**
   ```csharp
   // Feature: schedule-result-search-enhancement, Property 1: ç­›é€‰ç»“æœä¸€è‡´æ€§
   [Property(MinimumNumberOfTests = 100)]
   public Property FilterResultConsistency()
   {
       return Prop.ForAll(
           GenerateScheduleAndFilters(),
           async (schedule, filters) =>
           {
               var viewModel = CreateViewModel(schedule);
               await viewModel.ApplyFiltersAsync();
               
               var searchResultShiftIds = viewModel.SearchResults
                   .Select(r => r.ShiftId)
                   .ToHashSet();
               
               var highlightedShiftIds = viewModel.HighlightedCellKeys
                   .Select(k => ExtractShiftIdFromKey(k))
                   .ToHashSet();
               
               return searchResultShiftIds.SetEquals(highlightedShiftIds);
           });
   }
   ```

2. **å±æ€§ 8: å•å…ƒæ ¼é”®æ ¼å¼**
   ```csharp
   // Feature: schedule-result-search-enhancement, Property 8: å•å…ƒæ ¼é”®æ ¼å¼
   [Property(MinimumNumberOfTests = 100)]
   public Property CellKeyFormat()
   {
       return Prop.ForAll(
           Arb.From<int>().Where(id => id > 0),
           Arb.From<ViewMode>(),
           (shiftId, viewMode) =>
           {
               var key = GenerateCellKey(shiftId, viewMode.ToString());
               var regex = new Regex(@"^shift_\d+_(Grid|ByPosition|ByPersonnel|List)$");
               return regex.IsMatch(key);
           });
   }
   ```

3. **å±æ€§ 9: AND é€»è¾‘ç»„åˆ**
   ```csharp
   // Feature: schedule-result-search-enhancement, Property 9: AND é€»è¾‘ç»„åˆ
   [Property(MinimumNumberOfTests = 100)]
   public Property AndLogicCombination()
   {
       return Prop.ForAll(
           GenerateScheduleAndMultipleFilters(),
           async (schedule, filters) =>
           {
               var viewModel = CreateViewModel(schedule);
               
               // åº”ç”¨æ‰€æœ‰ç­›é€‰æ¡ä»¶
               await viewModel.ApplyFiltersAsync();
               var combinedResults = viewModel.SearchResults.Select(r => r.ShiftId).ToHashSet();
               
               // åˆ†åˆ«åº”ç”¨æ¯ä¸ªç­›é€‰æ¡ä»¶å¹¶æ±‚äº¤é›†
               var individualResults = new List<HashSet<int>>();
               foreach (var filter in filters)
               {
                   var vm = CreateViewModel(schedule);
                   await vm.ApplyFiltersAsync();
                   individualResults.Add(vm.SearchResults.Select(r => r.ShiftId).ToHashSet());
               }
               
               var expectedIntersection = individualResults.Aggregate((a, b) => a.Intersect(b).ToHashSet());
               
               return combinedResults.SetEquals(expectedIntersection);
           });
   }
   ```

4. **å±æ€§ 13: å¤œå“¨åˆ¤æ–­æ­£ç¡®æ€§**
   ```csharp
   // Feature: schedule-result-search-enhancement, Property 13: å¤œå“¨åˆ¤æ–­æ­£ç¡®æ€§
   [Property(MinimumNumberOfTests = 100)]
   public Property NightShiftDetection()
   {
       return Prop.ForAll(
           GenerateShift(),
           shift =>
           {
               var item = new SearchResultItem(shift);
               var expectedIsNight = shift.PeriodIndex is 11 or 0 or 1 or 2;
               return item.IsNightShift == expectedIsNight;
           });
   }
   ```

### é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶ä¹‹é—´çš„äº¤äº’ï¼š

1. **ç­›é€‰åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•äººå‘˜ç­›é€‰ + æ—¥æœŸç­›é€‰çš„ç»„åˆ
   - æµ‹è¯•äººå‘˜ç­›é€‰ + å“¨ä½ç­›é€‰çš„ç»„åˆ
   - æµ‹è¯•æ‰€æœ‰ç­›é€‰æ¡ä»¶çš„ç»„åˆ
   - æµ‹è¯•é‡ç½®ç­›é€‰åçŠ¶æ€æ¢å¤

2. **é«˜äº®åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•åº”ç”¨ç­›é€‰åé«˜äº®é”®çš„ç”Ÿæˆ
   - æµ‹è¯•è§†å›¾åˆ‡æ¢åé«˜äº®é”®çš„é‡æ˜ å°„
   - æµ‹è¯•ç„¦ç‚¹é«˜äº®çš„åº”ç”¨å’Œç§»é™¤
   - æµ‹è¯•é«˜äº®ä¸æœç´¢ç»“æœçš„åŒæ­¥

3. **å¯¼èˆªåŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•å¯¼èˆªæŒ‰é’®çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
   - æµ‹è¯•å¯¼èˆªæ—¶ FocusedShiftId çš„æ›´æ–°
   - æµ‹è¯•å¯¼èˆªæ—¶æ»šåŠ¨äº‹ä»¶çš„è§¦å‘
   - æµ‹è¯•è¾¹ç•Œæ¡ä»¶ï¼ˆç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªï¼‰

4. **æ ‡ç­¾é¡µåˆ‡æ¢æµ‹è¯•**
   - æµ‹è¯•åº”ç”¨ç­›é€‰åè‡ªåŠ¨åˆ‡æ¢åˆ°æœç´¢ç»“æœæ ‡ç­¾é¡µ
   - æµ‹è¯•æ— æ´»åŠ¨æœç´¢æ—¶éšè—æœç´¢ç»“æœæ ‡ç­¾é¡µ
   - æµ‹è¯•æ‰‹åŠ¨åˆ‡æ¢æ ‡ç­¾é¡µçš„è¡Œä¸º

### æ€§èƒ½æµ‹è¯•

æ€§èƒ½æµ‹è¯•éªŒè¯ç³»ç»Ÿåœ¨è´Ÿè½½ä¸‹çš„è¡¨ç°ï¼š

1. **å¤§æ•°æ®é‡æµ‹è¯•**
   - ç”Ÿæˆ 1000+ ç­æ¬¡çš„æ’ç­è¡¨
   - æµ‹é‡æœç´¢å’Œé«˜äº®æ“ä½œçš„æ‰§è¡Œæ—¶é—´
   - éªŒè¯æ‰§è¡Œæ—¶é—´ < 500msï¼ˆå±æ€§ 15ï¼‰
   - æµ‹é‡è§†å›¾åˆ‡æ¢æ—¶é«˜äº®é‡æ˜ å°„çš„æ—¶é—´
   - éªŒè¯æ‰§è¡Œæ—¶é—´ < 300msï¼ˆå±æ€§ 17ï¼‰

2. **é˜²æŠ–æµ‹è¯•**
   - åœ¨ 300ms å†…è¿ç»­è§¦å‘ 10 æ¬¡æœç´¢
   - éªŒè¯åªæœ‰æœ€åä¸€æ¬¡å®é™…æ‰§è¡Œï¼ˆå±æ€§ 16ï¼‰
   - ä½¿ç”¨ mock è®¡æ•°å™¨éªŒè¯æ‰§è¡Œæ¬¡æ•°

3. **æ¸²æŸ“æ€§èƒ½æµ‹è¯•**
   - ç”Ÿæˆ 100+ æœç´¢ç»“æœ
   - æµ‹é‡åˆ—è¡¨æ¸²æŸ“æ—¶é—´
   - éªŒè¯ä½¿ç”¨è™šæ‹ŸåŒ–åçš„æ€§èƒ½æå‡

### æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

- **å•å…ƒæµ‹è¯•**: xUnit + Moq
- **å±æ€§æµ‹è¯•**: CsCheck æˆ– FsCheck.Xunit
- **æ€§èƒ½æµ‹è¯•**: BenchmarkDotNet
- **UI æµ‹è¯•**: WinAppDriverï¼ˆå¯é€‰ï¼‰

### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- ä»£ç è¦†ç›–ç‡: > 80%
- å±æ€§æµ‹è¯•è¦†ç›–ç‡: æ‰€æœ‰ 19 ä¸ªå±æ€§éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
- è¾¹ç•Œæƒ…å†µè¦†ç›–ç‡: æ‰€æœ‰å·²è¯†åˆ«çš„è¾¹ç•Œæƒ…å†µéƒ½æœ‰æµ‹è¯•

## æ–‡ä»¶ç»“æ„è®¾è®¡

### æ–°å¢æ–‡ä»¶

```
ViewModels/Scheduling/
â”œâ”€â”€ ScheduleResultViewModel.Search.cs (æ–°å¢, ~400 è¡Œ)
â”‚   â””â”€â”€ æœç´¢åŠŸèƒ½çš„ partial class

DTOs/
â”œâ”€â”€ SearchResultItem.cs (æ–°å¢, ~80 è¡Œ)
â”‚   â””â”€â”€ æœç´¢ç»“æœé¡¹æ•°æ®æ¨¡å‹
â””â”€â”€ SearchFilters.cs (æ–°å¢, ~50 è¡Œ)
    â””â”€â”€ æœç´¢ç­›é€‰æ¡ä»¶æ¨¡å‹

Views/Scheduling/
â””â”€â”€ ScheduleResultPage.xaml (ä¿®æ”¹, +150 è¡Œ)
    â”œâ”€â”€ æ·»åŠ  TabView
    â”œâ”€â”€ æ·»åŠ æœç´¢ç»“æœåˆ—è¡¨
    â”œâ”€â”€ æ·»åŠ å¯¼èˆªæŒ‰é’®ï¼ˆä½äºæœç´¢ç»“æœåº•éƒ¨ï¼‰
    â””â”€â”€ é‡æ„å³ä¾§é¢æ¿ç»“æ„
```

### ä¿®æ”¹æ–‡ä»¶

```
ViewModels/Scheduling/
â”œâ”€â”€ ScheduleResultViewModel.cs (ä¿®æ”¹, ~50 è¡Œ)
â”‚   â”œâ”€â”€ æ·»åŠ  InitializeSearchCommands() è°ƒç”¨
â”‚   â”œâ”€â”€ ä¿®æ”¹ ApplyFiltersAsync() æ–¹æ³•ç­¾å
â”‚   â””â”€â”€ ä¿®æ”¹ ResetFiltersAsync() æ–¹æ³•ç­¾å
â””â”€â”€ ScheduleResultViewModel.Conflicts.cs (ä¿®æ”¹, ~20 è¡Œ)
    â””â”€â”€ è°ƒæ•´å†²çªé¢æ¿åœ¨ TabView ä¸­çš„ä½ç½®

Views/Scheduling/
â””â”€â”€ ScheduleResultPage.xaml.cs (ä¿®æ”¹, ~30 è¡Œ)
    â””â”€â”€ æ·»åŠ å¯¼èˆªæŒ‰é’®äº‹ä»¶å¤„ç†
```

### æ–‡ä»¶å¤§å°é¢„ä¼°

| æ–‡ä»¶ | ç±»å‹ | é¢„ä¼°è¡Œæ•° | è¯´æ˜ |
|------|------|----------|------|
| ScheduleResultViewModel.Search.cs | æ–°å¢ | 400 | æœç´¢åŠŸèƒ½æ ¸å¿ƒé€»è¾‘ |
| SearchResultItem.cs | æ–°å¢ | 80 | æœç´¢ç»“æœæ•°æ®æ¨¡å‹ |
| SearchFilters.cs | æ–°å¢ | 50 | ç­›é€‰æ¡ä»¶æ¨¡å‹ |
| ScheduleResultPage.xaml | ä¿®æ”¹ | +150 | UI ç»“æ„è°ƒæ•´ |
| ScheduleResultViewModel.cs | ä¿®æ”¹ | +50 | é›†æˆæœç´¢åŠŸèƒ½ |
| ScheduleResultViewModel.Conflicts.cs | ä¿®æ”¹ | +20 | TabView é€‚é… |
| ScheduleResultPage.xaml.cs | ä¿®æ”¹ | +30 | äº‹ä»¶å¤„ç† |

**æ€»è®¡**: æ–°å¢ ~530 è¡Œï¼Œä¿®æ”¹ ~250 è¡Œ

æ‰€æœ‰æ–‡ä»¶å‡ç¬¦åˆ 1000 è¡Œé™åˆ¶ï¼Œæœ€å¤§çš„æ–‡ä»¶ï¼ˆScheduleResultViewModel.Search.csï¼‰ä»… 400 è¡Œã€‚

## ä¾èµ–å…³ç³»

```
ScheduleResultViewModel.Search.cs
â”œâ”€â”€ ä¾èµ– ScheduleResultViewModel.cs (åŸºç±»)
â”œâ”€â”€ ä¾èµ– ScheduleResultViewModel.Conflicts.cs (å…±äº«é«˜äº®æœºåˆ¶)
â”œâ”€â”€ ä¾èµ– SearchResultItem.cs (æ•°æ®æ¨¡å‹)
â”œâ”€â”€ ä¾èµ– SearchFilters.cs (ç­›é€‰æ¡ä»¶)
â”œâ”€â”€ ä¾èµ– ShiftDto.cs (ç°æœ‰)
â””â”€â”€ ä¾èµ– DialogService (ç°æœ‰)

ScheduleResultPage.xaml
â”œâ”€â”€ ç»‘å®š ScheduleResultViewModel (ç°æœ‰)
â”œâ”€â”€ ä½¿ç”¨ TabView (WinUI 3 æ§ä»¶)
â”œâ”€â”€ ä½¿ç”¨ SplitView (ç°æœ‰)
â””â”€â”€ ä½¿ç”¨ AutoSuggestBox (ç°æœ‰)
```

## å®ç°é¡ºåº

1. **é˜¶æ®µ 1: æ•°æ®æ¨¡å‹** (~1 å°æ—¶)
   - åˆ›å»º `SearchResultItem.cs`
   - åˆ›å»º `SearchFilters.cs`

2. **é˜¶æ®µ 2: ViewModel æ ¸å¿ƒé€»è¾‘** (~3 å°æ—¶)
   - åˆ›å»º `ScheduleResultViewModel.Search.cs`
   - å®ç°æœç´¢å’Œç­›é€‰é€»è¾‘
   - å®ç°é«˜äº®ç®¡ç†é€»è¾‘

3. **é˜¶æ®µ 3: UI ç»“æ„è°ƒæ•´** (~2 å°æ—¶)
   - ä¿®æ”¹ `ScheduleResultPage.xaml`
   - æ·»åŠ  TabView å’Œå¯¼èˆªæŒ‰é’®
   - é‡æ„å³ä¾§é¢æ¿

4. **é˜¶æ®µ 4: äº‹ä»¶å¤„ç†å’Œé›†æˆ** (~1 å°æ—¶)
   - ä¿®æ”¹ `ScheduleResultPage.xaml.cs`
   - é›†æˆåˆ°ä¸» ViewModel
   - æµ‹è¯•åŸºæœ¬åŠŸèƒ½

5. **é˜¶æ®µ 5: è§†å›¾åˆ‡æ¢æ”¯æŒ** (~2 å°æ—¶)
   - å®ç°è·¨è§†å›¾é«˜äº®æ˜ å°„
   - æµ‹è¯•ä¸åŒè§†å›¾æ¨¡å¼

6. **é˜¶æ®µ 6: ä¼˜åŒ–å’Œæµ‹è¯•** (~2 å°æ—¶)
   - æ€§èƒ½ä¼˜åŒ–
   - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - Bug ä¿®å¤

**æ€»é¢„ä¼°æ—¶é—´**: 11 å°æ—¶
