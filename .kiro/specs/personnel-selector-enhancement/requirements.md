# 需求文档

## 简介

本功能旨在完善应用中的人员选择器控件，使其既支持下拉选择，又支持输入搜索，并提供自动联想推荐功能。目前系统中存在多个人员选择场景，但实现不统一，用户体验不一致。本需求将统一人员选择器的交互模式，提升用户效率。

## 术语表

- **人员选择器（Personnel Selector）**：用于选择人员的UI控件，可以是ComboBox、AutoSuggestBox或自定义控件
- **AutoSuggestBox**：WinUI 3提供的自动建议输入框控件
- **自动联想（Auto-suggestion）**：根据用户输入实时显示匹配的建议项
- **下拉选择（Dropdown Selection）**：点击控件时显示所有可选项的列表
- **模糊搜索（Fuzzy Search）**：支持部分匹配的搜索方式，不区分大小写
- **PersonnelDto**：人员数据传输对象，包含人员的基本信息

## 需求

### 需求 1：统一的人员选择器控件

**用户故事**：作为用户，我希望在所有需要选择人员的场景中都能使用一致的交互方式，这样我可以快速熟悉并高效使用系统。

#### 验收标准

1. WHEN 用户点击人员选择器 THEN 系统应显示所有可用人员的下拉列表
2. WHEN 用户在人员选择器中输入文本 THEN 系统应实时过滤并显示匹配的人员建议
3. WHEN 用户输入的文本与人员姓名部分匹配 THEN 系统应使用模糊匹配算法返回相关结果
4. WHEN 用户输入拼音首字母 THEN 系统应支持拼音首字母模糊匹配（例如：输入"ls"匹配"李四"）
5. WHEN 用户从建议列表中选择一个人员 THEN 系统应将该人员设置为选中状态并触发相应的事件
6. WHEN 用户按下回车键且有匹配的建议项 THEN 系统应自动选择第一个匹配项

### 需求 2：智能搜索和模糊匹配

**用户故事**：作为用户，我希望能够通过输入人员姓名的任意部分快速找到目标人员，即使输入不完整或顺序不完全匹配，这样我可以节省查找时间。

#### 验收标准

1. WHEN 用户输入搜索文本 THEN 系统应对人员姓名进行不区分大小写的模糊匹配
2. WHEN 用户输入人员姓名的连续子串 THEN 系统应返回包含该子串的所有人员（例如：输入"张三"可以匹配"张三"、"张三丰"）
3. WHEN 用户输入人员姓名的非连续字符 THEN 系统应返回包含这些字符且顺序一致的人员（例如：输入"zs"可以匹配"张三"、"赵四"的拼音首字母）
4. WHEN 用户输入的文本为空 THEN 系统应显示所有可用人员
5. WHEN 搜索结果为空 THEN 系统应显示"未找到匹配的人员"提示
6. WHEN 用户清空搜索文本 THEN 系统应恢复显示所有可用人员
7. WHEN 系统执行模糊搜索 THEN 搜索响应时间应不超过200毫秒
8. WHEN 有多个匹配结果 THEN 系统应按照匹配度排序，完全匹配的结果排在前面

### 需求 3：修改班次分配对话框的人员选择增强

**用户故事**：作为用户，我希望在修改班次分配时能够快速选择或搜索人员，这样我可以高效地调整排班安排。

#### 验收标准

1. WHEN 用户打开修改班次分配对话框 THEN 系统应在人员选择器中显示所有可用人员
2. WHEN 用户在搜索框中输入文本 THEN 系统应同时过滤人员列表和更新AutoSuggestBox的建议
3. WHEN 用户从AutoSuggestBox的建议中选择人员 THEN 系统应在下方的人员列表中高亮显示该人员
4. WHEN 用户点击人员列表中的某个人员 THEN 系统应在AutoSuggestBox中显示该人员的姓名
5. WHEN 用户选择的人员不满足技能要求 THEN 系统应显示警告提示但仍允许选择

### 需求 4：可复用的人员选择器组件

**用户故事**：作为开发者，我希望有一个可复用的人员选择器组件，这样我可以在不同的页面和对话框中保持一致的用户体验。

#### 验收标准

1. WHEN 开发者需要添加人员选择功能 THEN 系统应提供一个可复用的UserControl或自定义控件
2. WHEN 组件被使用 THEN 组件应支持通过属性配置占位符文本、最小宽度等UI参数
3. WHEN 组件被使用 THEN 组件应提供SelectedPersonnel属性用于双向绑定
4. WHEN 组件被使用 THEN 组件应提供PersonnelSelected事件通知选择变化
5. WHEN 组件被使用 THEN 组件应支持设置可选人员列表的过滤条件

### 需求 5：无障碍支持

**用户故事**：作为使用辅助技术的用户，我希望人员选择器能够被屏幕阅读器正确识别和操作，这样我可以无障碍地使用系统。

#### 验收标准

1. WHEN 人员选择器获得焦点 THEN 屏幕阅读器应朗读控件的用途和当前状态
2. WHEN 用户使用键盘导航建议列表 THEN 系统应支持上下箭头键选择和回车键确认
3. WHEN 建议列表显示 THEN 每个建议项应包含AutomationProperties.Name属性
4. WHEN 人员选择器状态改变 THEN 系统应通过AutomationProperties.LiveSetting通知辅助技术
5. WHEN 用户使用Tab键导航 THEN 人员选择器应正确参与焦点顺序

### 需求 6：性能优化

**用户故事**：作为用户，我希望人员选择器在处理大量人员数据时仍然保持流畅，这样我可以在任何情况下都能快速完成选择。

#### 验收标准

1. WHEN 可用人员数量超过100人 THEN 系统应使用虚拟化技术渲染列表
2. WHEN 用户快速输入搜索文本 THEN 系统应使用防抖（debounce）技术减少搜索频率
3. WHEN 系统执行搜索过滤 THEN 搜索算法应在单独的线程中执行以避免UI阻塞
4. WHEN 人员数据加载 THEN 系统应显示加载指示器
5. WHEN 人员数据加载失败 THEN 系统应显示错误提示并提供重试选项
