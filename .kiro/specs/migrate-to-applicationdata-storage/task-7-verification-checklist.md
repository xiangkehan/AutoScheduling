# Task 7 Verification Checklist

## 验证设置界面显示

本文档提供了验证任务 7 的详细步骤和检查清单。

### 前置条件

1. 应用程序已完成任务 1-4 的实现
2. DatabaseConfiguration 使用 ApplicationData.Current.LocalFolder
3. ConfigurationService 使用 ApplicationData.Current.LocalFolder
4. StoragePathService 已更新以使用新路径

### 验证步骤

#### 步骤 1: 启动应用程序并打开设置页面

**操作:**
1. 启动 AutoScheduling3 应用程序
2. 导航到设置页面（Settings）

**预期结果:**
- 应用程序成功启动，无错误
- 设置页面正常加载
- 可以看到"存储文件路径"部分

**验证状态:** ⬜ 通过 / ⬜ 失败

**备注:**
```
_____________________________________________
```

---

#### 步骤 2: 验证存储文件路径部分显示正确的路径

**操作:**
1. 在设置页面滚动到"存储文件路径"部分
2. 查看显示的文件列表

**预期结果:**
- 应该显示至少 2 个文件：
  - 数据库文件 (GuardDutyScheduling.db)
  - 配置文件 (config.json)
- 每个文件应显示：
  - 文件名称和描述
  - 完整路径
  - 文件状态（存在/不存在）
  - 文件大小
  - 最后修改时间

**验证状态:** ⬜ 通过 / ⬜ 失败

**实际显示的路径:**
```
数据库文件路径: _____________________________________________

配置文件路径: _____________________________________________
```

---

#### 步骤 3: 确认路径包含 ApplicationData.Current.LocalFolder

**操作:**
1. 检查显示的每个文件路径
2. 验证路径格式

**预期结果:**
- 所有路径应该包含类似以下格式的路径：
  - `C:\Users\[用户名]\AppData\Local\Packages\[PackageFamilyName]\LocalState\`
- 数据库文件应该在 LocalState 根目录：
  - `...\LocalState\GuardDutyScheduling.db`
- 配置文件应该在 Settings 子文件夹：
  - `...\LocalState\Settings\config.json`
- 路径中不应包含 "AutoScheduling3" 子文件夹

**验证状态:** ⬜ 通过 / ⬜ 失败

**路径验证:**
- ⬜ 数据库路径包含 LocalState
- ⬜ 配置文件路径包含 LocalState\Settings
- ⬜ 路径中没有 "AutoScheduling3" 子文件夹

**备注:**
```
_____________________________________________
```

---

#### 步骤 4: 测试"复制路径"功能

**操作:**
1. 点击数据库文件的"复制路径"按钮
2. 打开记事本或其他文本编辑器
3. 粘贴（Ctrl+V）

**预期结果:**
- 点击按钮后应显示成功提示："已复制到剪贴板"
- 粘贴的内容应该是完整的文件路径
- 路径应该与界面显示的路径完全一致

**验证状态:** ⬜ 通过 / ⬜ 失败

**复制的路径:**
```
_____________________________________________
```

**重复测试配置文件:**
1. 点击配置文件的"复制路径"按钮
2. 粘贴并验证

**验证状态:** ⬜ 通过 / ⬜ 失败

**复制的路径:**
```
_____________________________________________
```

---

#### 步骤 5: 测试"打开目录"功能

**操作:**
1. 点击数据库文件的"打开目录"按钮

**预期结果:**
- 应该打开 Windows 文件资源管理器
- 应该导航到文件所在的目录
- 应该选中（高亮）对应的文件
- 目录应该是 ApplicationData.Current.LocalFolder 路径

**验证状态:** ⬜ 通过 / ⬜ 失败

**实际打开的目录:**
```
_____________________________________________
```

**目录中的文件:**
- ⬜ GuardDutyScheduling.db 存在
- ⬜ Settings 文件夹存在
- ⬜ backups 文件夹存在（如果已创建过备份）

**重复测试配置文件:**
1. 点击配置文件的"打开目录"按钮

**预期结果:**
- 应该打开 Settings 子文件夹
- 应该选中 config.json 文件

**验证状态:** ⬜ 通过 / ⬜ 失败

**实际打开的目录:**
```
_____________________________________________
```

---

#### 步骤 6: 测试刷新功能

**操作:**
1. 点击"刷新信息"按钮

**预期结果:**
- 应该显示加载指示器（短暂）
- 文件信息应该重新加载
- 文件大小和最后修改时间应该更新（如果有变化）

**验证状态:** ⬜ 通过 / ⬜ 失败

**备注:**
```
_____________________________________________
```

---

#### 步骤 7: 验证文件不存在的情况

**操作:**
1. 如果某个文件不存在，验证界面显示

**预期结果:**
- 文件状态应显示为"不存在"或类似提示
- "打开目录"按钮应该被禁用
- "复制路径"按钮应该仍然可用

**验证状态:** ⬜ 通过 / ⬜ 失败 / ⬜ 不适用（所有文件都存在）

**备注:**
```
_____________________________________________
```

---

### 额外验证

#### 验证日志输出

**操作:**
1. 在 Visual Studio 中查看输出窗口（Output Window）
2. 查找与存储路径相关的日志消息

**预期日志消息:**
```
[DatabaseConfiguration] LocalFolder path: ...
[DatabaseConfiguration] Database path: ...
StoragePathService initialized - LocalFolder: ...
StoragePathService - Database path: ...
StoragePathService - Configuration path: ...
```

**验证状态:** ⬜ 通过 / ⬜ 失败

**实际日志:**
```
_____________________________________________
```

---

#### 验证路径一致性

**操作:**
1. 比较以下路径是否一致：
   - 设置界面显示的路径
   - 复制到剪贴板的路径
   - 文件资源管理器中的实际路径
   - 日志输出中的路径

**预期结果:**
- 所有路径应该完全一致
- 所有路径都应该使用 ApplicationData.Current.LocalFolder

**验证状态:** ⬜ 通过 / ⬜ 失败

**备注:**
```
_____________________________________________
```

---

### 总结

**所有验证步骤完成:** ⬜ 是 / ⬜ 否

**发现的问题:**
```
1. _____________________________________________
2. _____________________________________________
3. _____________________________________________
```

**任务状态:** ⬜ 完成 / ⬜ 需要修复

**完成日期:** _______________

**验证人员:** _______________

---

### 需求映射

本验证清单覆盖以下需求：

- **Requirement 7.1**: 设置界面显示当前使用的 ApplicationData.Current.LocalFolder 路径
  - 验证步骤: 2, 3
  
- **Requirement 7.2**: 设置界面显示数据库文件的完整路径
  - 验证步骤: 2, 3
  
- **Requirement 7.3**: 设置界面显示备份文件夹的路径
  - 验证步骤: 2, 3（通过数据库路径推断备份路径）
  
- **Requirement 7.4**: 设置界面提供一个按钮来打开数据存储文件夹
  - 验证步骤: 5

---

### 故障排除

如果验证失败，请检查：

1. **路径不正确:**
   - 检查 DatabaseConfiguration.GetDefaultDatabasePath() 实现
   - 检查 StoragePathService.GetConfigurationFilePath() 实现
   - 确认使用 ApplicationData.Current.LocalFolder.Path

2. **复制路径功能失败:**
   - 检查 ClipboardHelper 实现
   - 验证应用程序有剪贴板访问权限

3. **打开目录功能失败:**
   - 检查 ProcessHelper.OpenDirectoryAndSelectFileAsync() 实现
   - 验证文件路径格式正确
   - 确认文件存在

4. **界面不显示文件:**
   - 检查 StoragePathService.GetStorageFilesAsync() 实现
   - 验证 ViewModel 绑定正确
   - 检查是否有异常被捕获但未显示
