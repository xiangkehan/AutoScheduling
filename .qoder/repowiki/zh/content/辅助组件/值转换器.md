# 值转换器

<cite>
**本文档引用文件**  
- [BoolToVisibilityConverter.cs](file://Converters/BoolToVisibilityConverter.cs)
- [DateTimeFormatConverter.cs](file://Converters/DateTimeFormatConverter.cs)
- [ConflictTypeToColorConverter.cs](file://Converters/ConflictTypeToColorConverter.cs)
- [BoolToBrushConverter.cs](file://Converters/BoolToBrushConverter.cs)
- [BoolToTextConverter.cs](file://Converters/BoolToTextConverter.cs)
- [DiffTypeToColorConverter.cs](file://Converters/DiffTypeToColorConverter.cs)
- [EnumEqualsToVisibilityConverter.cs](file://Converters/EnumEqualsToVisibilityConverter.cs)
- [IntToVisibilityConverter.cs](file://Converters/IntToVisibilityConverter.cs)
- [NullToVisibilityConverter.cs](file://Converters/NullToVisibilityConverter.cs)
- [PeriodIndexToTimeConverter.cs](file://Converters/PeriodIndexToTimeConverter.cs)
</cite>

## 目录
1. [引言](#引言)
2. [IValueConverter 接口规范](#ivalueconverter-接口规范)
3. [转换器详细说明](#转换器详细说明)
   - [BoolToVisibilityConverter](#booltovisibilityconverter)
   - [DateTimeFormatConverter](#datetimeformatconverter)
   - [ConflictTypeToColorConverter](#conflicttypetocolorconverter)
   - [BoolToBrushConverter](#booltobrushconverter)
   - [BoolToTextConverter](#booltotextconverter)
   - [DiffTypeToColorConverter](#difftypetocolorconverter)
   - [EnumEqualsToVisibilityConverter](#enumequalstovisibilityconverter)
   - [IntToVisibilityConverter](#inttovisibilityconverter)
   - [NullToVisibilityConverter](#nulltovisibilityconverter)
   - [PeriodIndexToTimeConverter](#periodindextotimeconverter)
4. [XAML 中的使用语法示例](#xaml-中的使用语法示例)
5. [多绑定转换器的应用场景](#多绑定转换器的应用场景)
6. [类型安全与异常处理最佳实践](#类型安全与异常处理最佳实践)
7. [结论](#结论)

## 引言
本项目中的 `Converters` 目录包含多个用于 WPF/UWP 数据绑定的值转换器，实现了 `IValueConverter` 接口。这些转换器在 UI 层与数据模型之间架起桥梁，将原始数据转换为适合展示的形式，例如将布尔值映射为控件可见性、将时间戳格式化为可读字符串等。本文档旨在全面说明每个转换器的功能、输入输出类型、典型业务场景及使用方式。

## IValueConverter 接口规范
所有转换器均实现 `IValueConverter` 接口，该接口定义了两个核心方法：
- `Convert`: 将源数据转换为目标类型，用于从绑定源到目标的转换。
- `ConvertBack`: 将目标数据转换回源类型，用于双向绑定。

**实现要求**：
- 必须处理 `null` 或无效输入，避免运行时异常。
- 若不支持反向转换，应抛出 `NotImplementedException` 或 `NotSupportedException`。
- 参数 `parameter` 可用于传递额外配置（如格式字符串、反转标志等）。
- 类型转换需确保类型安全，避免强制类型转换引发错误。

**Section sources**
- [BoolToVisibilityConverter.cs](file://Converters/BoolToVisibilityConverter.cs#L15-L40)

## 转换器详细说明

### BoolToVisibilityConverter
将布尔值转换为 `Visibility` 枚举值，常用于控制 UI 元素的显示或隐藏。

- **输入类型**：`bool`
- **输出类型**：`Visibility`
- **参数支持**：
  - `"Inverse"`：反转逻辑（`true` → `Collapsed`）
  - 或通过 `Inverted` 属性设置
- **业务场景**：根据开关状态控制按钮、面板的可见性。

**Section sources**
- [BoolToVisibilityConverter.cs](file://Converters/BoolToVisibilityConverter.cs#L15-L40)

### DateTimeFormatConverter
将 `DateTime` 或 `DateTimeOffset` 转换为指定格式的字符串。

- **输入类型**：`DateTime` / `DateTimeOffset`
- **输出类型**：`string`
- **参数支持**：自定义日期时间格式（如 `"yyyy年MM月dd日"`）
- **默认格式**：`yyyy-MM-dd HH:mm`
- **业务场景**：日程时间显示、日志时间戳格式化。

**Section sources**
- [DateTimeFormatConverter.cs](file://Converters/DateTimeFormatConverter.cs#L10-L50)

### ConflictTypeToColorConverter
根据冲突类型返回对应的颜色画刷，用于视觉区分不同级别的冲突。

- **输入类型**：`string`（冲突类型）
- **输出类型**：`SolidColorBrush`
- **支持类型**：
  - `"hard"` → 红色
  - `"soft"` → 橙色
  - `"unassigned"` → 灰色
  - `"info"` → 蓝色
- **业务场景**：排班冲突高亮显示。

**Section sources**
- [ConflictTypeToColorConverter.cs](file://Converters/ConflictTypeToColorConverter.cs#L10-L34)

### BoolToBrushConverter
根据布尔值返回不同的颜色画刷，支持自定义颜色。

- **输入类型**：`bool`
- **输出类型**：`Brush`
- **参数支持**：颜色数组或管道分隔字符串（如 `"Green|Red"`）
- **默认颜色**：`true` → 绿色，`false` → 红色
- **业务场景**：状态指示灯、开关背景色。

**Section sources**
- [BoolToBrushConverter.cs](file://Converters/BoolToBrushConverter.cs#L10-L44)

### BoolToTextConverter
将布尔值转换为自定义文本。

- **输入类型**：`bool`
- **输出类型**：`string`
- **参数支持**：文本数组或管道分隔字符串（如 `"启用|禁用"`）
- **默认输出**：`True` / `False`
- **业务场景**：状态标签显示“开启/关闭”、“是/否”。

**Section sources**
- [BoolToTextConverter.cs](file://Converters/BoolToTextConverter.cs#L10-L27)

### DiffTypeToColorConverter
根据差异类型返回对应的颜色值（`Color` 类型）。

- **输入类型**：`string`（差异类型）
- **输出类型**：`Color`
- **支持类型**：
  - `"新增班次"` → 浅绿
  - `"删除班次"` → 浅红
  - `"人员变更"` → 浅黄
- **业务场景**：变更记录的视觉标记。

**Section sources**
- [DiffTypeToColorConverter.cs](file://Converters/DiffTypeToColorConverter.cs#L10-L23)

### EnumEqualsToVisibilityConverter
判断枚举值是否等于指定参数，决定可见性。

- **输入类型**：`enum` 或 `string`
- **输出类型**：`Visibility`
- **参数支持**：期望的枚举字符串值
- **业务场景**：根据当前模式（如 `SideBySide`）控制 UI 元素显示。

**Section sources**
- [EnumEqualsToVisibilityConverter.cs](file://Converters/EnumEqualsToVisibilityConverter.cs#L15-L28)

### IntToVisibilityConverter
判断整数值是否等于指定参数，决定可见性。

- **输入类型**：`int`
- **输出类型**：`Visibility`
- **参数支持**：目标整数值（字符串形式）
- **业务场景**：根据状态码控制元素显示。

**Section sources**
- [IntToVisibilityConverter.cs](file://Converters/IntToVisibilityConverter.cs#L15-L27)

### NullToVisibilityConverter
判断对象是否为 `null` 或集合是否为空，决定可见性。

- **输入类型**：任意对象或集合
- **输出类型**：`Visibility`
- **参数支持**：`"invert"` 表示逻辑反转
- **业务场景**：空数据提示、加载状态控制。

**Section sources**
- [NullToVisibilityConverter.cs](file://Converters/NullToVisibilityConverter.cs#L15-L40)

### PeriodIndexToTimeConverter
将时段索引（0-11）转换为时间范围文本。

- **输入类型**：`int`（0~11）
- **输出类型**：`string`（如 `"08:00-10:00"`）
- **业务场景**：排班表中时段标题的生成。

**Section sources**
- [PeriodIndexToTimeConverter.cs](file://Converters/PeriodIndexToTimeConverter.cs#L10-L27)

## XAML 中的使用语法示例
以下是在 XAML 中使用转换器的典型语法：

```xml
<TextBlock Text="{Binding StartTime, Converter={StaticResource DateTimeFormatConverter}, ConverterParameter='yyyy年MM月dd日'}"/>
<Border Visibility="{Binding HasError, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
<Rectangle Fill="{Binding ConflictType, Converter={StaticResource ConflictTypeToColorConverter}}"/>
<TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToTextConverter}, ConverterParameter='启用|禁用'}"/>
```

**Section sources**
- [DateTimeFormatConverter.cs](file://Converters/DateTimeFormatConverter.cs#L10-L50)
- [BoolToVisibilityConverter.cs](file://Converters/BoolToVisibilityConverter.cs#L15-L40)

## 多绑定转换器的应用场景
虽然当前项目未实现 `IMultiValueConverter`，但在复杂 UI 场景中，多绑定转换器可用于：
- 组合多个字段生成显示文本（如姓名 + 职位）
- 根据多个条件决定可见性或样式
- 实现动态过滤或排序逻辑

建议在需要组合多个绑定源时扩展此类功能。

## 类型安全与异常处理最佳实践
为确保转换器稳定运行，应遵循以下最佳实践：
- **类型检查**：使用 `is` 操作符进行安全类型判断，避免直接强制转换。
- **默认返回值**：对无效输入返回合理的默认值（如 `Visibility.Collapsed`、空字符串）。
- **参数验证**：检查 `parameter` 是否为预期类型，避免解析失败。
- **异常处理**：`ConvertBack` 方法若不支持，应明确抛出 `NotImplementedException`。
- **避免副作用**：转换器应为纯函数，不修改原始数据或外部状态。

**Section sources**
- [BoolToVisibilityConverter.cs](file://Converters/BoolToVisibilityConverter.cs#L15-L40)
- [DateTimeFormatConverter.cs](file://Converters/DateTimeFormatConverter.cs#L10-L50)
- [NullToVisibilityConverter.cs](file://Converters/NullToVisibilityConverter.cs#L15-L40)

## 结论
`Converters` 目录中的各类转换器为 UI 数据绑定提供了灵活且可复用的解决方案。通过统一实现 `IValueConverter` 接口，各转换器在保持职责单一的同时，支持丰富的参数化配置。建议在新功能开发中优先复用现有转换器，并在必要时扩展新的转换逻辑，同时严格遵守类型安全与异常处理规范，以提升代码健壮性与可维护性。